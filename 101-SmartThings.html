<!--
    Copyright 2020 Samsung Automation Studio Team

    Licensed under the Apache License, Version 2.0 (the "License");
    you may not use this file except in compliance with the License.
    You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.
-->
<style>
    .md_pat{
        display:flex;
        align-items:center;
    }
    .md_pat__input{
        width:65%;
    }
    .md_header{
        text-align:right;
        padding:10px 15px;
        display:flex;
        justify-content:space-between;
        align-items:center;
        background:#ebebeb;
    }
    .md_list{
        min-height:30vh;
        max-height:60vh;
        overflow-y:scroll;
        border: 1px solid #ddd;
        /*border-radius: 5px;*/
        padding: 5px;
    }
    .md_list__item{
        padding:5px 5px 5px 10px;
        cursor:pointer;
        margin:5px 0px;
        border-radius:10px;
        display:none;
    }
    .md_list__location{
        background:#ebebeb;
        font-size:1rem;
    }
    .md_list__room{
        background:#f7f7f7;
        font-size:.9rem;
    }
    .md_list__device{
        background:#ffffff;
        font-size:.9rem;
        font-weight:bold;
        border:1px solid #aaaaaa;
    }
    .md_list__device__cmp{
        padding-left:10px;
        max-height:100px;
        overflow-y:auto;
        font-weight:bold;
    }
    .md_List__device__cps{
        padding-left:20px;
        font-weight:normal;
    }

    .md_list__item > input[type="checkbox"]{
        margin:0px;
        vertical-align:middle;
    }
    .md_list__item--close i{
        transform: rotate(-90deg);
    }
    .md_list__item--close > div{
        display:none;
    }
    .md_list__device.md_list__item--selected{
        border:1px solid #3695dd;
    }
    .md_list__item--show{
        display:block;
    }

    span.cp_type__option{
        cursor:pointer;
        margin-right:10px;
        vertical-align: middle;
    }
    .node-input-label{
        display:inline-block;
        width:100px;
    }
    .dp_cp{
        display:inline-block;
        width:70%;
    }
    .dp_cp input,select{
        width:100%;
    }
    .dp_cp :is(input,select){
        width:90%;
    }
    .my_device__loation--close div{
        display:none;
    }
    .my_Device__room--close div{
        display:none;
    }
    .cp_type--standard .dp_cp__custom{
        display:none;
    }
    .cp_type--custom .dp_cp__standard{
        display:none;
    }
    .cp_type input[type="radio"]{
        width:30px;
    }

    .dp_cp_spec{
        white-space: pre-wrap;
        word-break: break-all;
        max-height:50vh;
        overflow:auto;
    }
    .st_state{
        cursor:pointer;
        display:inline-block;
        margin:5px;
        vertical-align:middle;
        width:19px;
    }
    .st_state i{
        vertical-align:middle;
    }
    .st_state svg{
        width:26px;
        height:26px;
        transform:rotate(-90deg);
        vertical-align:middle;
    }
    .st_state:not(.st_state--loading) svg,.st_state.st_state--loading i{
        display:none;
    }
    .st_state.st_state--loading svg,.st_state:not(.st_state--loading) i{
        display:inline-block;
        font-size:1.3rem;
    }

    .st_state i{color:red;}
    .st_state--valid i{color:green;}

    circle.st_state__back{
        stroke-width:3;
        stroke:lightgray;
        fill:none;
    }
    circle.st_state__front{
        stroke-width:4;
        stroke-dasharray:56;
        stroke-dashoffset:0;
        stroke-linecap:round;
        fill:none;
        stroke:lightgray;
    }
    .st_state--loading circle.st_state__front{
        stroke: #3695dd;
        animation: st_loading 2.5s infinite;
    }
    .st_state--valid circle.st_state__front{
        stroke:green;
        animation:none;
    }
    @keyframes st_loading{
        0%,100% {stroke-dashoffset:0;}
        50% {stroke-dashoffset:-56;}
        50.01% {stroke-dashoffset:56;}
    }
    .optgroup--hide{
        display:none;
    }
</style>

<script type="text/x-red" data-template-name="device-profile">
    <div class="form-row">
        <label for="node-input-name">Name</label>
        <input type="text" id="node-input-name" placeholder="default, '{capabilty ID}'">
    </div>

    <div class="form-row" style="display:flex;align-items:center">
        <span for="node-input-capabilityId" class="node-input-label" style="width:100px;">Capability</span>
        <span class="dp_cp">
            <div class="cp_type">
                <span class="cp_type__option">
                    <input type="radio" name="cpType" value="standard" checked>Standard
                </span>
                <span class="cp_type__option">
                    <input type="radio" name="cpType" value="custom" >Custom
                </span>
            </div>
            <span class="dp_cp__custom">
                <input type="text" list="stAccessToken_datalist" id="node-input-stAccessToken" placeholder="SmartThings AccessToken">
                <span class="st_state" title="refresh">
                    <svg>
                        <circle class="st_state__back" cx="13" cy="13" r="9"></circle>
                        <circle class="st_state__front" cx="13" cy="13" r="9"></circle>
                    </svg>
                    <i class="fa fa-check" aria-hidden="true" id="node-input-stAccessToken-valid"></i>
                </span>
                <select id="node-input-capabilityId_custom" data-cptype="custom">
                </select>
            </span>
            <span class="dp_cp__standard">
                <select id="node-input-capabilityId_standard" data-cptype="standard"></select>
            </span>
        </span>
    </div>
    <datalist id="stAccessToken_datalist"></datalist>
    <div id="cp_spec__result" >
        <span id="capabilities_refresh_result" style="padding:10px;"></span>
    </div>
    <pre class="dp_cp_spec"><code id="dp_cp_spec__code">select capability</code></pre>
</script>
<script type="text/x-red" data-help-name="device-profile">
    <p>This node represents an installed device. In this flow, You need to choose a device for automation.</p>
    <p>Event, Status and Command nodes need to know which devices will subscribe to the SmartThings Cloud or commands.</p>
    <p>This node has a capability that represents device feature. You can find more information about <a href="https://smartthings.developer.samsung.com/docs/api-ref/capabilities.html" target="_blank">the Capabilities of SmartThings</a>.</p>
    <h3>Properties</h3>
    <dl class="message-properties">
        <dt>Name</dt>
        <dd>The label of the Name assigned by the user. It's unique name in flow.</dd>
        <dt>Capability<span class="property-type">required</span></dt>
        <dd>
            <ul>
                <li><b>'Standard'</b> Capability : Standard Capabilities are created and maintained by the SmartThings development team.</li>
                <li><b>'Custom'</b> Capability : Custom capabilities are defined by the developer. A custom capability consists of a namespace and a capability name to uniquely identify it. 'device-profile' node get custom capability that is defined in your device using your SmartThings Personal AccessToken</li>
                <li>The List of Capabilities provided by this Device.</li>
                <li>Determine if this Device supports the specified capability name.</li>
            </ul>
        </dd>
    </dl>
</script>
<script type="text/x-red" data-template-name="installed-device">
     <div class="form-tips" style="margin-bottom:10px;"><b>Note:</b> create token on the SmartThings <b><a href="https://account.smartthings.com/tokens" target="_blank">personal access token page</a></b></div>

    <div class="form-row">
        <label for="node-input-name">Node Name</label>
        <input type="text" id="node-input-name" placeholder="default, 'token:xxxxxxxx'">
    </div>
    <div class="form-row md_pat">
        <label for="node-input-stAccessToken">Personal<br> Access Token</label>
        <input type="text" class="md_pat__input" id="node-input-stAccessToken" list="stAccessToken_datalist" placeholder="SmartThings PAT">
        <span class="st_state" title="refresh">
            <svg>
                <circle class="st_state__back" cx="13" cy="13" r="9"></circle>
                <circle class="st_state__front" cx="13" cy="13" r="9"></circle>
            </svg>
            <i class="fa fa-check" aria-hidden="true" id="node-input-stAccessToken-valid"></i>
        </span>
    </div>
    <div class="form-row"style="text-align:right">
        <span id="my_device__result" style="padding:10px;"></span>
    </div>

    <div class="md_container">
        <div class="md_header">
            <span class="md_header__cnt">0 devices, 0 selected</span>
            <input id="md_header__search" class="md_header__search" type="search" placeholder="Device Search">
        </div>

        <div id="md_list" class="md_list">
            <!-- <div class="my_device__loation my_device__loation--close"></div>
            <div class="my_device__room my_device__room--close"></div>
            <div class="my_device__device my_device__device--close"></div> -->
        </div>
    </div>
    <!-- <div class="my_device_list" class="form-row my_device_list">
    </div> -->
    <div id="my-device-list-div" class="form-row sensor-container-row">
        <ol id="my-device-list-container"></ol>
    </div>
    <datalist id="stAccessToken_datalist"></datalist>
</script>
<script type="text/x-red" data-help-name="installed-device">
    <p>This node represents an your SmartThings device. You can control your SmartThings devices directly without even registering the Automation.</p>
    <p>To do this, you should set your PAT on this node and select one on your device list. Then, you can get a condition or put a command to your installed devices by using 'Status', 'Command' nodes.</p>
    <p>After setting your PAT, get your device list and select device that you want to control.</p>
    <h3>Getting a SmartThings PAT</h3>
        <ul>
            <li>SmartThings Authentication : <a href="https://smartthings.developer.samsung.com/docs/api-ref/st-api.html#section/Authentication">API Reference, Authentication</a></li>
            <li>PATs can be created and managed on the <a href="https://account.smartthings.com/tokens">personal access token page</a>.</li>
        </ul>
    <h3>Properties</h3>
    <dl class="message-properties">
        <dt>Device Name<span class="property-type">read-only</span></dt>
        <dd>The label of the Name assigned by the user. It's unique name in flow.</dd>
        <dt>Device Label<span class="property-type">read-only</span></dt>
        <dd> </dd>
        <dt>Personal Access Token<span class="property-type">required</span></dt>
        <dd></dd>
        <dt>Device List</dt>
        <dd>
            <ul>
                <li>The List of your device that .</li>
                <li>Select device that you want to control, subscribe</li>
            </ul>
        </dd>
    </dl>
</script>
<script type="text/x-red" data-template-name="automation">
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
        <input id="node-input-name" type="text" placeholder="Name"/>
    </div>
    <div class="form-row">
        <label for="node-input-url"><i class="fa fa-cog"></i> Endpoint</label>
        <input id="node-input-url" type="text"  placeholder="/url"/>
    </div>
    <div class="form-row">
        <label for="node-input-copyurl"></label>
        <div style="display: inline-block; position: relative; width: 70%; height: 20.0114px;">
            <div style="position: absolute; left: 0px; right: 40px;">
                <input type="text" id="node-input-copyurl" readonly="true" style="width:100%"></input>
            </div>
            <a id="export-clipboard" class="editor-button" style="position: absolute; right: 0px; top: 0px;">
                <i class="fa fa-copy"></i>
            </a>
        </div>
    </div>
    <div class="form-row" style="margin:20px 0px;">
        <label for="node-input-attributeId" style="vertical-align:top;"><i class="fa fa-align-right"></i> Log</label>
        <div>
            <input id="node-input-loggingEditor" type="checkbox" name="" value="true" style="width:auto;margin:auto;margin-right:3px">Log to editor debug panel<br>
            <input id="node-input-loggingConsole" type="checkbox" name="" value="false" style="width:auto;margin:auto;margin-right:3px">Log to system console
        </div>
    </div>
</script>
<script type="text/x-red" data-help-name="automation">
    <p>This node represents the WebHook Endpoint of SmartApp. the Automation node handles lifecycle of SmartApp.</p>
    <p>A WebHook endpoint in this context is a web services application which can receive incoming HTTP POST requests.</p>
    <p></p>
    <p><a href="https://smartthings.developer.samsung.com/docs/guides/smartapps/webhook-apps.html" target="_blank">more...</a></p>
    <h3>Properties</h3>
    <dl class="message-properties">
        <dt>Name <span class="property-type">required</span></dt>
        <dd>A Name for the WebHook endpoint.</dd>
        <dt>Endpoint <span class="property-type">required</span></dt>
        <dd>A Endpoint that should be invoked during execution.</dd>
    </dl>
    <h3>Outputs</h3>
    <dl class="message-properties">
        <dt>[lifecyle] Event</dt>
        <dd>Next node is the Event node only.</dd>
    </dl>
</script>

<script type="text/x-red" data-template-name="event-device">
    <div class="form-row" style="width:600px;">
        <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="default, '{deviceName}'" style="width:50%">
    </div>
    <input type="hidden" id="node-input-deviceNodeId">
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-cog"></i> Device</label>
        <select type="text" id="node-input-deviceId" style="width:50%"></select>
        <span class="st_state" title="refresh">
            <svg>
                <circle class="st_state__back" cx="13" cy="13" r="9"></circle>
                <circle class="st_state__front" cx="13" cy="13" r="9"></circle>
            </svg>
        </span>
    </div>
    <hr align="middle"/>
    <div class="form-row">
        <label for="node-input-capabilityId"><i class="fa fa-asterisk"></i> Capability</label>
        <select id="node-input-capabilityId" style="width:50%;"></select>
    </div>
    <div class="form-row">
        <label for="node-input-attributeId"><i class="fa fa-sun-o"></i> Attribute</label>
        <select style="width:50%" id="node-input-attributeId"></select>
    </div>
    <div class="form-row sensor-container-row">
        <ol id="attr-list-container"></ol>
    </div>
    <div class="form-row" style="margin:20px 0px;">
        <label for="node-input-attributeId" style="vertical-align:top;"><i class="fa fa-align-right"></i> Log</label>
        <div>
            <input id="node-input-logging" type="checkbox" name="" value="false" style="width:auto;margin:auto;margin-right:3px">Log device response<br>
            <input id="node-input-loggingEditor" type="checkbox" name="" value="true" style="width:auto;margin:auto;margin-right:3px">Log to editor debug panel<br>
            <input id="node-input-loggingConsole" type="checkbox" name="" value="false" style="width:auto;margin:auto;margin-right:3px">Log to system console
        </div>
    </div>
</script>
<script type="text/x-red" data-help-name="event-device">
    <p>This node represents a change of device.</p>
    <p>When a user installs a SmartApp, they typically will select the devices to be used by the SmartApp.</p>
    <p>This event-device node interacts with installed SmartThings device. When the device changes and an event occurs, the event node can receive the event as a subscriber.</p>
    <h3>Properties</h3>
    <dl class="message-properties">
        <dt>Name <span class="property-type">required</span></dt>
        <dd>The label of the Device assigned by the user.</dd>
        <dt>Device </dt>
        <dd>The unique system identifier for this Device.</dd>
        <dt>Capability <span class="property-type">required</span></dt>
        <dd>
            <ul>
                <li>The List of Capabilities provided by this Device.</li>
                <li>Determine if this Device supports the specified capability name.</li>
            </ul>
        </dd>
        <dt>Attribute</dt>
        <dd>
            <ul>
                <li>The list of Attribute s for this Device.</li>
                <li>Determine if this Device has the specified attribute.</li>
            </ul>
        </dd>
     </dl>
</script>

<script type="text/x-red" data-template-name="status-device">
    <div class="form-row" style="width:600px;">
        <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="default, '{deviceName}'" style="width:50%">
    </div>
    <input type="hidden" id="node-input-deviceNodeId">
    <input type="hidden" id="node-input-componentId">
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-cog"></i> Device</label>
        <select type="text" id="node-input-deviceId" style="width:50%"></select>
        <span class="st_state" title="refresh">
            <svg>
                <circle class="st_state__back" cx="13" cy="13" r="9"></circle>
                <circle class="st_state__front" cx="13" cy="13" r="9"></circle>
            </svg>
        </span>
    </div>
    <hr align="middle" />
    <div class="form-row">
        <label for="node-input-capabilityId" style="font-weight:bold"> Filter</label>
    </div>
    <div class="form-row">
        <label for="node-input-capabilityId"><i class="fa fa-asterisk"></i> Capability</label>
        <select id="node-input-capabilityId" style="width:50%;"></select>
    </div>
    <div class="form-row">
        <label for="node-input-attributeId"> <i class="fa fa-sun-o"></i> Attribute</label>
        <select style="width:50%" id="node-input-attributeId"></select>
    </div>
    <div class="form-row sensor-container-row">
        <ol id="attr-list-container"></ol>
    </div>
    <div class="form-row" style="margin:20px 0px;">
        <label for="node-input-attributeId" style="vertical-align:top;"><i class="fa fa-align-right"></i> Log</label>
        <div>
            <input id="node-input-logging" type="checkbox" name="" value="false" style="width:auto;margin:auto;margin-right:3px">Log device response<br>
            <input id="node-input-loggingEditor" type="checkbox" name="" value="true" style="width:auto;margin:auto;margin-right:3px">Log to editor debug panel<br>
            <input id="node-input-loggingConsole" type="checkbox" name="" value="false" style="width:auto;margin:auto;margin-right:3px">Log to system console
        </div>
    </div>
</script>
<script type="text/x-red" data-help-name="status-device">
    <p>This node checks the state of the device.</p>
    <p>When a user installs a SmartApp, A user will select the devices to be used by the SmartApp.</p>
    <p>This status-device node interact with the installed SmartThings device. This node allows you to branch flows based on the state of the device.</p>
    <h3>Properties</h3>
    <dl class="message-properties">
        <dt>Name <span class="property-type">required</span></dt>
        <dd>The label of the Device assigned by the user.</dd>
        <dt>Device </dt>
        <dd>The unique system identifier for this Device.</dd>
        <dt>Capability <span class="property-type">required</span></dt>
        <dd>
            <ul>
                <li>The List of Capabilities provided by this Device.</li>
                <li>Determine if this Device supports the specified capability name.</li>
            </ul>
        </dd>
        <dt>Attribute</dt>
        <dd>
            <ul>
                <li>The list of Attribute s for this Device.</li>
                <li>Determine if this Device has the specified attribute.</li>
            </ul>
        </dd>
     </dl>
</script>

<script type="text/x-red" data-template-name="command-device">
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="default, '{attributeID}:{argValue}'" style="width:50%">
    </div>
    <input type="hidden" id="node-input-deviceNodeId">
    <input type="hidden" id="node-input-componentId">
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-cog"></i> Device</label>
        <select type="text" id="node-input-deviceId" style="width:50%"></select>
        <span class="st_state" title="refresh">
            <svg>
                <circle class="st_state__back" cx="13" cy="13" r="9"></circle>
                <circle class="st_state__front" cx="13" cy="13" r="9"></circle>
            </svg>
        </span>
    </div>
    <hr align="middle" />
    <div class="form-row">
        <label for="node-input-capabilityId"><i class="fa fa-asterisk"></i> Capability</label>
        <select id="node-input-capabilityId" style="width:50%;"></select>
    </div>
    <div class="form-row">
        <label for="node-input-attributeId"> <i class="fa fa-sun-o"></i> Command</label>
        <select style="width:50%" id="node-input-attributeId"></select>
    </div>
    <div class="form-row actuator-container-row">
        <ol id="cmd-list-container"></ol>
    </div>
    <div class="form-row" style="margin:20px 0px;">
        <label for="node-input-attributeId" style="vertical-align:top;"><i class="fa fa-align-right"></i> Log</label>
        <div>
            <input id="node-input-logging" type="checkbox" name="" value="false" style="width:auto;margin:auto;margin-right:3px">Log device response<br>
            <input id="node-input-loggingEditor" type="checkbox" name="" value="true" style="width:auto;margin:auto;margin-right:3px">Log to editor debug panel<br>
            <input id="node-input-loggingConsole" type="checkbox" name="" value="false" style="width:auto;margin:auto;margin-right:3px">Log to system console
        </div>
    </div>
</script>
<script type="text/x-red" data-help-name="command-device">
    <p>This node can command to the device.</p>
    <p>When a user installs a SmartApp, A user will select the devices to be used by the SmartApp.</p>
    <p>This command-device node interact with the installed SmartThings device. As commands you set, this node changes the state of the device.</p>
    <h3>Properties</h3>
    <dl class="message-properties">
        <dt>Name <span class="property-type">required</span></dt>
        <dd>The label of the Device assigned by the user.</dd>
        <dt>Device </dt>
        <dd>The unique system identifier for this Device.</dd>
        <dt>Capability <span class="property-type">required</span></dt>
        <dd>
            <ul>
                <li>The List of Capabilities provided by this Device.</li>
                <li>Determine if this Device supports the specified capability name.</li>
            </ul>
        </dd>
        <dt>Command</dt>
        <dd>
            <ul>
                <li>The list of Commands for this Device.</li>
                <li>Determine if this Device has the specified command name.</li>
            </ul>
        </dd>
     </dl>
</script>
<!-- Node Html End-->

<script type="text/javascript">
    // https://api.smartthings.com/v1/devices
    SmartThingsApi = {
        getLocations: function(token){
            return new Promise((resolve,reject)=>{
                $.ajax({
                    url: "https://api.smartthings.com/v1/locations",
                    headers: {
                        Authorization: 'Bearer ' + token
                    }
                }).then(resolve,reject)
            });
        },
        getLocationsRooms: function(token,locationId){
            return new Promise((resolve,reject)=> {
                $.ajax({
                    url: "https://api.smartthings.com/v1/locations/" + locationId + "/rooms", headers: {
                        Authorization: 'Bearer ' + token
                    }
                }).then(resolve,reject)
            });
        },
        getDevices: function (token) {
            return new Promise((resolve,reject)=> {
                $.ajax({
                    url: "https://api.smartthings.com/v1/devices", headers: {
                        Authorization: 'Bearer ' + token
                    }
                }).then(resolve,reject)
            })
        },
        getDeviceList: function (token, done, fail) {
            return $.ajax({
                url: "https://api.smartthings.com/v1/devices",
                headers: {
                    Authorization: 'Bearer ' + token
                }
            }).done(function (result, textStatus, xhr) {
                if(result.hasOwnProperty('items') && Array.isArray(result.items)){
                    result.items.forEach(device=>{
                        device.capabilities = []
                        device.components.forEach(function (component) {
                            component.capabilities.forEach(function (cp) {
                                cp['vid'] = cp.id+'_v'+cp.version;
                                cp['vname']=cp.version===1?cp.name:cp.name+' v'+cp.version;
                                device.capabilities.push(cp)

                                if(SmartThingsProfiles.hasCapability(cp.vid)===false){
                                    var pr = SmartThingsApi.getCapability(token,cp.id,cp.version)
                                        .then(spec=>{
                                            // cp['spec']=true

                                            /*NPM SOURCE*/
                                            Object.assign(cp,spec)
                                            $('#my-device-list-container span.device-item-capability').attr('spec','true')
                                        }).fail(err=>{
                                            console.error(err)
                                            $('#my-device-list-container span.device-item-capability').attr('spec','false')
                                        })
                                }
                            })
                        })

                        delete device['components']
                        delete device['dth']
                        delete device['deviceNetworkType']
                        delete device['locationsId']
                    })
                }
                done(result.items);
            }).fail(function (e) {
                fail(e);
            });
        },
        getCapability: function(token,capabilityId,capabilityVersion, done, fail){
            return $.ajax({
                url: 'https://api.smartthings.com/v1/capabilities/'+capabilityId+'/'+capabilityVersion,
                headers: {
                        Authorization: 'Bearer '+token
                    }
            }).then((cp)=>{
                cp['vid']=cp.id+'_v'+cp.version //vid : id + version
                cp['vname']=(cp.version===1?cp.name:cp.name+' v'+cp.version)// vname : name + version
                cp['_spec']=true
                SmartThingsProfiles.addCapability(cp)
                return cp;
            })
        }
    };
</script>
<style>
    .device-item-capability{
        color:#000;
    }
    .device-item-capability[spec='false']{
        color:#999;
    }

</style>
<!-- Node Common Script-->
<script type="text/javascript">

    function Profiles() {
        /*
        * capability ver.2020.03.30
        * https://smartthings.developer.samsung.com/docs/api-ref/capabilities.html
        */
        var _raw_capabilities = [{"id":"accelerationSensor","version":1,"status":"live","name":"Acceleration Sensor","attributes":{"acceleration":{"schema":{"type":"object","properties":{"value":{"title":"ActivityState","type":"string","enum":["active","inactive"]}},"additionalProperties":false,"required":["value"]},"enumCommands":[]}},"commands":{}},{"id":"activityLightingMode","version":1,"status":"proposed","name":"Activity Lighting Mode","attributes":{"lightingMode":{"schema":{"type":"object","properties":{"value":{"type":"string","enum":["reading","writing","computer","night","sleepPreparation","day","cozy","soft"]}},"additionalProperties":false,"required":["value"]},"setter":"setLightingMode","enumCommands":[]}},"commands":{"setLightingMode":{"arguments":[{"name":"lightingMode","optional":false,"schema":{"type":"string","enum":["reading","writing","computer","night","sleepPreparation","day","cozy","soft"]}}]}}},{"id":"activitySensor","version":1,"status":"proposed","name":"Activity Sensor","attributes":{"activity":{"schema":{"type":"object","properties":{"value":{"title":"ActivityType","type":"string","enum":["noActivity","falling","lying","sitting","standing","eating"]}},"additionalProperties":false,"required":["value"]},"enumCommands":[]}},"commands":{}},{"id":"actuator","version":1,"status":"deprecated","name":"Actuator","attributes":{},"commands":{}},{"id":"airConditionerFanMode","version":1,"status":"proposed","name":"Air Conditioner Fan Mode","attributes":{"fanMode":{"schema":{"type":"object","properties":{"value":{"title":"String","type":"string","maxLength":255}},"additionalProperties":false,"required":[]},"enumCommands":[]},"supportedAcFanModes":{"schema":{"type":"object","properties":{"value":{"type":"array","items":{"type":"string"}}},"additionalProperties":false,"required":[]},"enumCommands":[]}},"commands":{"setFanMode":{"arguments":[{"name":"fanMode","optional":false,"schema":{"title":"String","type":"string","maxLength":255}}]}}},{"id":"airConditionerMode","version":1,"status":"proposed","name":"Air Conditioner Mode","attributes":{"supportedAcModes":{"schema":{"type":"object","properties":{"value":{"type":"array","items":{"type":"string"}}},"additionalProperties":false,"required":[]},"enumCommands":[]},"airConditionerMode":{"schema":{"type":"object","properties":{"value":{"title":"String","type":"string","maxLength":255}},"additionalProperties":false,"required":["value"]},"setter":"setAirConditionerMode","enumCommands":[]}},"commands":{"setAirConditionerMode":{"arguments":[{"name":"mode","optional":false,"schema":{"title":"String","type":"string","maxLength":255}}]}}},{"id":"airFlowDirection","version":1,"status":"dead","name":"Air Flow Direction","attributes":{"airFlowDirection":{"schema":{"type":"object","properties":{"value":{"title":"AirFlowDirection","type":"string","enum":["fixed","vertical","horizontal","all"]}},"additionalProperties":false,"required":[]},"enumCommands":[]}},"commands":{"setAirFlowDirection":{"arguments":[{"name":"airFlowDirection","optional":false,"schema":{"title":"AirFlowDirection","type":"string","enum":["fixed","vertical","horizontal","all"]}}]}}},{"id":"airPurifierFanMode","version":1,"status":"proposed","name":"Air Purifier Fan Mode","attributes":{"supportedAirPurifierFanModes":{"schema":{"type":"object","properties":{"value":{"type":"array","items":{"type":"string","enum":["auto","sleep","low","medium","high","quiet","windFree"]}}},"additionalProperties":false,"required":[]},"enumCommands":[]},"airPurifierFanMode":{"schema":{"type":"object","properties":{"value":{"title":"AirPurifierFanMode","type":"string","enum":["auto","sleep","low","medium","high","quiet","windFree"]}},"additionalProperties":false,"required":[]},"enumCommands":[]}},"commands":{"setAirPurifierFanMode":{"arguments":[{"name":"airPurifierFanMode","optional":false,"schema":{"title":"AirPurifierFanMode","type":"string","enum":["auto","sleep","low","medium","high","quiet","windFree"]}}]}}},{"id":"airQualitySensor","version":1,"status":"live","name":"Air Quality Sensor","attributes":{"airQuality":{"schema":{"type":"object","properties":{"value":{"type":"integer","minimum":0,"maximum":100},"unit":{"type":"string","enum":["CAQI"],"default":"CAQI"}},"additionalProperties":false,"required":["value"]},"enumCommands":[]}},"commands":{}},{"id":"alarm","version":1,"status":"live","name":"Alarm","attributes":{"alarm":{"schema":{"type":"object","properties":{"value":{"title":"AlertState","type":"string","enum":["both","off","siren","strobe"]}},"additionalProperties":false,"required":["value"]},"enumCommands":[{"command":"both","value":"both"},{"command":"off","value":"off"},{"command":"siren","value":"siren"},{"command":"strobe","value":"strobe"}]}},"commands":{"siren":{"arguments":[]},"strobe":{"arguments":[]},"off":{"arguments":[]},"both":{"arguments":[]}}},{"id":"alarmSystem","version":1,"status":"dead","name":"Alarm System","attributes":{"alarmSystemStatus":{"schema":{"type":"object","properties":{"value":{"title":"AlarmSystemState","type":"string","enum":["away","off","stay"]}},"additionalProperties":false,"required":["value"]},"enumCommands":[{"command":"sendEvent(alarmSystemStatus,off)","value":"off"},{"command":"sendEvent(alarmSystemStatus,stay)","value":"stay"},{"command":"sendEvent(alarmSystemStatus,away)","value":"away"}]}},"commands":{"sendEvent(alarmSystemStatus,off)":{"arguments":[]},"sendEvent(alarmSystemStatus,away)":{"arguments":[]},"sendEvent(alarmSystemStatus,stay)":{"arguments":[]}}},{"id":"alarmSystemArmOnly","version":1,"status":"dead","name":"Alarm System Arm Only","attributes":{"alarmSystemStatus":{"schema":{"type":"object","properties":{"value":{"title":"AlarmSystemState","type":"string","enum":["away","off","stay"]}},"additionalProperties":false,"required":["value"]},"enumCommands":[{"command":"sendEvent(alarmSystemStatus,stay)","value":"stay"},{"command":"sendEvent(alarmSystemStatus,away)","value":"away"}]}},"commands":{"sendEvent(alarmSystemStatus,away)":{"arguments":[]},"sendEvent(alarmSystemStatus,stay)":{"arguments":[]}}},{"id":"astronomicalData","version":1,"status":"dead","name":"Astronomical Data","attributes":{"sunrise":{"schema":{"type":"object","properties":{"value":{"type":"string","enum":["true"]}},"additionalProperties":false,"required":["value"]},"setter":"sendEvent(sunrise)","enumCommands":[]},"sunsetTime":{"schema":{"type":"object","properties":{"value":{"title":"String","type":"string","maxLength":255}},"additionalProperties":false,"required":[]},"setter":"sendEvent(sunsetTime)","enumCommands":[]},"sunset":{"schema":{"type":"object","properties":{"value":{"type":"string","enum":["true"]}},"additionalProperties":false,"required":["value"]},"setter":"sendEvent(sunset)","enumCommands":[]},"sunriseTime":{"schema":{"type":"object","properties":{"value":{"title":"String","type":"string","maxLength":255}},"additionalProperties":false,"required":[]},"setter":"sendEvent(sunriseTime)","enumCommands":[]}},"commands":{"sendEvent(sunriseTime)":{"arguments":[]},"sendEvent(sunrise)":{"arguments":[]},"sendEvent(sunset)":{"arguments":[]},"sendEvent(sunsetTime)":{"arguments":[]}}},{"id":"atmosphericPressureMeasurement","version":1,"status":"proposed","name":"Atmospheric Pressure Measurement","attributes":{"atmosphericPressure":{"schema":{"type":"object","properties":{"value":{"type":"number","minimum":0,"maximum":110},"unit":{"type":"string","enum":["kPa"],"default":"kPa"}},"additionalProperties":false,"required":["value"]},"enumCommands":[]}},"commands":{}},{"id":"audioCapture","version":1,"status":"proposed","name":"Audio Capture","attributes":{"stream":{"schema":{"type":"object","properties":{"value":{"title":"JsonObject","type":"object"}},"additionalProperties":false,"required":["value"]},"enumCommands":[]},"clip":{"schema":{"type":"object","properties":{"value":{"title":"JsonObject","type":"object"}},"additionalProperties":false,"required":["value"]},"enumCommands":[]}},"commands":{"capture":{"arguments":[{"name":"startTime","optional":false,"schema":{"title":"Iso8601Date","type":"string","pattern":"^(?:[1-9]\\d{3}-?(?:(?:0[1-9]|1[0-2])-?(?:0[1-9]|1\\d|2[0-8])|(?:0[13-9]|1[0-2])-?(?:29|30)|(?:0[13578]|1[02])-?31)|(?:[1-9]\\d(?:0[48]|[2468][048]|[13579][26])|(?:[2468][048]|[13579][26])00)-?02-?29)T(?:[01]\\d|2[0-3]):?[0-5]\\d:?[0-5]\\d(?:\\.\\d{3})?(?:Z|[+-][01]\\d(?::?[0-5]\\d)?)$"}},{"name":"captureTime","optional":false,"schema":{"title":"Iso8601Date","type":"string","pattern":"^(?:[1-9]\\d{3}-?(?:(?:0[1-9]|1[0-2])-?(?:0[1-9]|1\\d|2[0-8])|(?:0[13-9]|1[0-2])-?(?:29|30)|(?:0[13578]|1[02])-?31)|(?:[1-9]\\d(?:0[48]|[2468][048]|[13579][26])|(?:[2468][048]|[13579][26])00)-?02-?29)T(?:[01]\\d|2[0-3]):?[0-5]\\d:?[0-5]\\d(?:\\.\\d{3})?(?:Z|[+-][01]\\d(?::?[0-5]\\d)?)$"}},{"name":"endTime","optional":false,"schema":{"title":"Iso8601Date","type":"string","pattern":"^(?:[1-9]\\d{3}-?(?:(?:0[1-9]|1[0-2])-?(?:0[1-9]|1\\d|2[0-8])|(?:0[13-9]|1[0-2])-?(?:29|30)|(?:0[13578]|1[02])-?31)|(?:[1-9]\\d(?:0[48]|[2468][048]|[13579][26])|(?:[2468][048]|[13579][26])00)-?02-?29)T(?:[01]\\d|2[0-3]):?[0-5]\\d:?[0-5]\\d(?:\\.\\d{3})?(?:Z|[+-][01]\\d(?::?[0-5]\\d)?)$"}},{"name":"correlationId","optional":true,"schema":{"title":"String","type":"string","maxLength":255}},{"name":"reason","optional":true,"schema":{"title":"String","type":"string","maxLength":255}}]}}},{"id":"audioMute","version":1,"status":"live","name":"Audio Mute","attributes":{"mute":{"schema":{"type":"object","properties":{"value":{"title":"MuteState","type":"string","enum":["muted","unmuted"]}},"additionalProperties":false,"required":["value"]},"setter":"setMute","enumCommands":[{"command":"mute","value":"muted"},{"command":"unmute","value":"unmuted"}]}},"commands":{"setMute":{"arguments":[{"name":"state","optional":false,"schema":{"title":"MuteState","type":"string","enum":["muted","unmuted"]}}]},"mute":{"arguments":[]},"unmute":{"arguments":[]}}},{"id":"audioNotification","version":1,"status":"live","name":"Audio Notification","attributes":{},"commands":{"playTrackAndResume":{"arguments":[{"name":"uri","optional":false,"schema":{"title":"URI","type":"string","format":"uri"}},{"name":"level","optional":true,"schema":{"type":"integer","minimum":0,"maximum":100}}]},"playTrackAndRestore":{"arguments":[{"name":"uri","optional":false,"schema":{"title":"URI","type":"string","format":"uri"}},{"name":"level","optional":true,"schema":{"type":"integer","minimum":0,"maximum":100}}]},"playTrack":{"arguments":[{"name":"uri","optional":false,"schema":{"title":"URI","type":"string","format":"uri"}},{"name":"level","optional":true,"schema":{"type":"integer","minimum":0,"maximum":100}}]}}},{"id":"audioStream","version":1,"status":"live","name":"Audio Stream","attributes":{"uri":{"schema":{"type":"object","properties":{"value":{"title":"URI","type":"string","format":"uri"}},"additionalProperties":false,"required":[]},"enumCommands":[]}},"commands":{"startAudio":{"arguments":[]},"stopAudio":{"arguments":[]}}},{"id":"audioTrackAddressing","version":1,"status":"proposed","name":"Audio Track Addressing","attributes":{},"commands":{"setAudioTrack":{"arguments":[{"name":"trackToSet","optional":false,"schema":{"title":"AudioTrackAddress","type":"object"}}]}}},{"id":"audioTrackData","version":1,"status":"proposed","name":"Audio Track Data","attributes":{"totalTime":{"schema":{"type":"object","properties":{"value":{"title":"PositiveInteger","type":"integer","minimum":0}},"additionalProperties":false,"required":[]},"enumCommands":[]},"audioTrackData":{"schema":{"type":"object","properties":{"value":{"title":"AudioTrackData","type":"object","additionalProperties":false,"properties":{"title":{"title":"String","type":"string","maxLength":255},"artist":{"title":"String","type":"string","maxLength":255},"album":{"title":"String","type":"string","maxLength":255},"albumArtUrl":{"title":"String","type":"string","maxLength":255},"mediaSource":{"title":"String","type":"string","maxLength":255}},"required":["title"]}},"additionalProperties":false,"required":["value"]},"enumCommands":[]},"elapsedTime":{"schema":{"type":"object","properties":{"value":{"title":"PositiveInteger","type":"integer","minimum":0}},"additionalProperties":false,"required":[]},"enumCommands":[]}},"commands":{}},{"id":"audioVolume","version":1,"status":"live","name":"Audio Volume","attributes":{"volume":{"schema":{"title":"IntegerPercent","type":"object","properties":{"value":{"type":"integer","minimum":0,"maximum":100},"unit":{"type":"string","enum":["%"],"default":"%"}},"additionalProperties":false,"required":["value"]},"setter":"setVolume","enumCommands":[]}},"commands":{"volumeDown":{"arguments":[]},"volumeUp":{"arguments":[]},"setVolume":{"arguments":[{"name":"volume","optional":false,"schema":{"type":"integer","minimum":0,"maximum":100}}]}}},{"id":"battery","version":1,"status":"live","name":"Battery","attributes":{"battery":{"schema":{"title":"IntegerPercent","type":"object","properties":{"value":{"type":"integer","minimum":0,"maximum":100},"unit":{"type":"string","enum":["%"],"default":"%"}},"additionalProperties":false,"required":["value"]},"enumCommands":[]}},"commands":{}},{"id":"beacon","version":1,"status":"deprecated","name":"Beacon","attributes":{"presence":{"schema":{"type":"object","properties":{"value":{"title":"PresenceState","type":"string","enum":["present","not present"]}},"additionalProperties":false,"required":["value"]},"enumCommands":[]}},"commands":{}},{"id":"bodyMassIndexMeasurement","version":1,"status":"proposed","name":"Body Mass Index Measurement","attributes":{"bmiMeasurement":{"schema":{"type":"object","properties":{"value":{"type":"number"},"unit":{"type":"string","enum":["kg/m^2"],"default":"kg/m^2"}},"additionalProperties":false,"required":["value"]},"enumCommands":[]}},"commands":{}},{"id":"bodyWeightMeasurement","version":1,"status":"proposed","name":"Body Weight Measurement","attributes":{"bodyWeightMeasurement":{"schema":{"type":"object","properties":{"value":{"type":"number"},"unit":{"type":"string","enum":["kg","lbs","斤"],"default":"kg"}},"additionalProperties":false,"required":["value","unit"]},"enumCommands":[]}},"commands":{}},{"id":"bridge","version":1,"status":"deprecated","name":"Bridge","attributes":{},"commands":{}},{"id":"bufferedVideoCapture","version":1,"status":"deprecated","name":"Buffered Video Capture","attributes":{"clip":{"schema":{"type":"object","properties":{"value":{"title":"JsonObject","type":"object"}},"additionalProperties":false,"required":["value"]},"enumCommands":[]}},"commands":{"capture":{"arguments":[{"name":"startTime","optional":false,"schema":{"title":"Iso8601Date","type":"string","pattern":"^(?:[1-9]\\d{3}-?(?:(?:0[1-9]|1[0-2])-?(?:0[1-9]|1\\d|2[0-8])|(?:0[13-9]|1[0-2])-?(?:29|30)|(?:0[13578]|1[02])-?31)|(?:[1-9]\\d(?:0[48]|[2468][048]|[13579][26])|(?:[2468][048]|[13579][26])00)-?02-?29)T(?:[01]\\d|2[0-3]):?[0-5]\\d:?[0-5]\\d(?:\\.\\d{3})?(?:Z|[+-][01]\\d(?::?[0-5]\\d)?)$"}},{"name":"captureTime","optional":false,"schema":{"title":"Iso8601Date","type":"string","pattern":"^(?:[1-9]\\d{3}-?(?:(?:0[1-9]|1[0-2])-?(?:0[1-9]|1\\d|2[0-8])|(?:0[13-9]|1[0-2])-?(?:29|30)|(?:0[13578]|1[02])-?31)|(?:[1-9]\\d(?:0[48]|[2468][048]|[13579][26])|(?:[2468][048]|[13579][26])00)-?02-?29)T(?:[01]\\d|2[0-3]):?[0-5]\\d:?[0-5]\\d(?:\\.\\d{3})?(?:Z|[+-][01]\\d(?::?[0-5]\\d)?)$"}},{"name":"endTime","optional":false,"schema":{"title":"Iso8601Date","type":"string","pattern":"^(?:[1-9]\\d{3}-?(?:(?:0[1-9]|1[0-2])-?(?:0[1-9]|1\\d|2[0-8])|(?:0[13-9]|1[0-2])-?(?:29|30)|(?:0[13578]|1[02])-?31)|(?:[1-9]\\d(?:0[48]|[2468][048]|[13579][26])|(?:[2468][048]|[13579][26])00)-?02-?29)T(?:[01]\\d|2[0-3]):?[0-5]\\d:?[0-5]\\d(?:\\.\\d{3})?(?:Z|[+-][01]\\d(?::?[0-5]\\d)?)$"}}]}}},{"id":"bulb","version":1,"status":"dead","name":"Bulb","attributes":{"switch":{"schema":{"type":"object","properties":{"value":{"title":"SwitchState","type":"string","enum":["on","off"]}},"additionalProperties":false,"required":["value"]},"enumCommands":[{"command":"off","value":"off"},{"command":"on","value":"on"}]}},"commands":{"off":{"arguments":[]},"on":{"arguments":[]}}},{"id":"button","version":1,"status":"live","name":"Button","attributes":{"button":{"schema":{"type":"object","properties":{"value":{"title":"ButtonState","type":"string","enum":["pushed","held","double","pushed_2x","pushed_3x","pushed_4x","pushed_5x","pushed_6x","down","down_2x","down_3x","down_4x","down_5x","down_6x","down_hold","up","up_2x","up_3x","up_4x","up_5x","up_6x","up_hold"]}},"additionalProperties":false,"required":["value"]},"enumCommands":[]},"numberOfButtons":{"schema":{"type":"object","properties":{"value":{"title":"PositiveInteger","type":"integer","minimum":0}},"additionalProperties":false,"required":["value"]},"enumCommands":[]},"supportedButtonValues":{"schema":{"type":"object","properties":{"value":{"type":"array","items":{"title":"ButtonState","type":"string","enum":["pushed","held","double","pushed_2x","pushed_3x","pushed_4x","pushed_5x","pushed_6x","down","down_2x","down_3x","down_4x","down_5x","down_6x","down_hold","up","up_2x","up_3x","up_4x","up_5x","up_6x","up_hold"]}}},"additionalProperties":false,"required":[]},"enumCommands":[]}},"commands":{}},{"id":"bypassable","version":1,"status":"live","name":"Bypassable","attributes":{"bypassStatus":{"schema":{"type":"object","properties":{"value":{"title":"BypassState","type":"string","enum":["ready","notReady","bypassed"]}},"additionalProperties":false,"required":["value"]},"enumCommands":[]}},"commands":{}},{"id":"cameraPreset","version":1,"status":"proposed","name":"Camera Preset","attributes":{"presets":{"schema":{"type":"object","properties":{"value":{"type":"array","items":{"title":"Camera Preset","type":"object","additionalProperties":false,"properties":{"name":{"type":"string"},"id":{"type":"string"},"data":{"title":"JsonObject","type":"object"}},"required":["name","id","data"]}}},"additionalProperties":false,"required":["value"]},"enumCommands":[]}},"commands":{"create":{"arguments":[{"name":"name","optional":false,"schema":{"title":"String","type":"string","maxLength":255}},{"name":"id","optional":true,"schema":{"title":"String","type":"string","maxLength":255}},{"name":"data","optional":true,"schema":{"title":"JsonObject","type":"object"}}]},"update":{"arguments":[{"name":"id","optional":false,"schema":{"title":"String","type":"string","maxLength":255}},{"name":"name","optional":true,"schema":{"title":"String","type":"string","maxLength":255}},{"name":"data","optional":true,"schema":{"title":"JsonObject","type":"object"}}]},"execute":{"arguments":[{"name":"id","optional":false,"schema":{"type":"string"}}]},"delete":{"arguments":[{"name":"id","optional":false,"schema":{"type":"string"}}]}}},{"id":"carbonDioxideHealthConcern","version":1,"status":"proposed","name":"Carbon Dioxide Health Concern","attributes":{"carbonDioxideHealthConcern":{"schema":{"type":"object","properties":{"value":{"title":"AirQualityHealthConcern","type":"string","enum":["good","moderate","slightlyUnhealthy","unhealthy","veryUnhealthy","hazardous"]}},"additionalProperties":false,"required":["value"]},"enumCommands":[]}},"commands":{}},{"id":"carbonDioxideMeasurement","version":1,"status":"live","name":"Carbon Dioxide Measurement","attributes":{"carbonDioxide":{"schema":{"type":"object","properties":{"value":{"type":"integer","minimum":0,"maximum":1000000},"unit":{"type":"string","enum":["ppm"],"default":"ppm"}},"additionalProperties":false,"required":["value"]},"enumCommands":[]}},"commands":{}},{"id":"carbonMonoxideDetector","version":1,"status":"live","name":"Carbon Monoxide Detector","attributes":{"carbonMonoxide":{"schema":{"type":"object","properties":{"value":{"title":"CarbonMonoxideState","type":"string","enum":["clear","detected","tested"]}},"additionalProperties":false,"required":["value"]},"enumCommands":[]}},"commands":{}},{"id":"carbonMonoxideMeasurement","version":1,"status":"proposed","name":"Carbon Monoxide Measurement","attributes":{"carbonMonoxideLevel":{"schema":{"type":"object","properties":{"value":{"type":"number","minimum":0,"maximum":1000000},"unit":{"type":"string","enum":["ppm"],"default":"ppm"}},"additionalProperties":false,"required":["value","unit"]},"enumCommands":[]}},"commands":{}},{"id":"chime","version":1,"status":"proposed","name":"Chime","attributes":{"chime":{"schema":{"type":"object","properties":{"value":{"type":"string","enum":["chime","off"]}},"additionalProperties":false,"required":["value"]},"enumCommands":[{"command":"chime","value":"chime"},{"command":"off","value":"off"}]}},"commands":{"off":{"arguments":[]},"chime":{"arguments":[]}}},{"id":"color","version":1,"status":"proposed","name":"Color","attributes":{"colorValue":{"schema":{"type":"object","properties":{"value":{"type":"object","additionalProperties":false,"properties":{"hue":{"type":"number","minimum":0,"maximum":360},"saturation":{"type":"number","minimum":0,"maximum":100}}}},"additionalProperties":false,"required":["value"]},"setter":"setColorValue","enumCommands":[]}},"commands":{"setColorValue":{"arguments":[{"name":"colorValue","optional":false,"schema":{"type":"object","additionalProperties":false,"properties":{"hue":{"type":"number","minimum":0,"maximum":360},"saturation":{"type":"number","minimum":0,"maximum":100}},"required":["hue","saturation"]}},{"name":"switchLevel","optional":true,"schema":{"type":"integer","minimum":0,"maximum":100}}]}}},{"id":"colorControl","version":1,"status":"live","name":"Color Control","attributes":{"saturation":{"schema":{"type":"object","properties":{"value":{"title":"PositiveNumber","type":"number","minimum":0}},"additionalProperties":false,"required":[]},"setter":"setSaturation","enumCommands":[]},"color":{"schema":{"type":"object","properties":{"value":{"title":"String","type":"string","maxLength":255}},"additionalProperties":false,"required":[]},"setter":"setColor","enumCommands":[]},"hue":{"schema":{"type":"object","properties":{"value":{"title":"PositiveNumber","type":"number","minimum":0}},"additionalProperties":false,"required":[]},"setter":"setHue","enumCommands":[]}},"commands":{"setColor":{"arguments":[{"name":"color","optional":false,"schema":{"title":"COLOR_MAP","type":"object","additionalProperties":false,"properties":{"hue":{"type":"number"},"saturation":{"type":"number"},"hex":{"type":"string","maxLength":7},"level":{"type":"integer"},"switch":{"type":"string","maxLength":3}}}}]},"setHue":{"arguments":[{"name":"hue","optional":false,"schema":{"title":"PositiveNumber","type":"number","minimum":0}}]},"setSaturation":{"arguments":[{"name":"saturation","optional":false,"schema":{"title":"PositiveNumber","type":"number","minimum":0}}]}}},{"id":"colorMode","version":1,"status":"proposed","name":"Color Mode","attributes":{"colorMode":{"schema":{"type":"object","properties":{"value":{"type":"string","enum":["color","colorTemperature","other"]}},"additionalProperties":false,"required":[]},"enumCommands":[]}},"commands":{}},{"id":"colorTemperature","version":1,"status":"live","name":"Color Temperature","attributes":{"colorTemperature":{"schema":{"type":"object","properties":{"value":{"type":"integer","minimum":1,"maximum":30000},"unit":{"type":"string","enum":["K"],"default":"K"}},"additionalProperties":false,"required":["value"]},"setter":"setColorTemperature","enumCommands":[]}},"commands":{"setColorTemperature":{"arguments":[{"name":"temperature","optional":false,"schema":{"type":"integer","minimum":1,"maximum":30000}}]}}},{"id":"configuration","version":1,"status":"live","name":"Configuration","attributes":{},"commands":{"configure":{"arguments":[]}}},{"id":"consumable","version":1,"status":"proposed","name":"Consumable","attributes":{"consumableStatus":{"schema":{"type":"object","properties":{"value":{"title":"ConsumableState","type":"string","enum":["good","maintenance_required","missing","order","replace"]}},"additionalProperties":false,"required":["value"]},"setter":"setConsumableStatus","enumCommands":[]}},"commands":{"setConsumableStatus":{"arguments":[{"name":"status","optional":false,"schema":{"title":"ConsumableState","type":"string","enum":["good","maintenance_required","missing","order","replace"]}}]}}},{"id":"contactSensor","version":1,"status":"live","name":"Contact Sensor","attributes":{"contact":{"schema":{"type":"object","properties":{"value":{"title":"ContactState","type":"string","enum":["closed","open"]}},"additionalProperties":false,"required":["value"]},"enumCommands":[]}},"commands":{}},{"id":"demandResponseLoadControl","version":1,"status":"proposed","name":"Demand Response Load Control","attributes":{"drlcStatus":{"schema":{"type":"object","properties":{"value":{"title":"DemandResponseLoadControlStatus","type":"object","additionalProperties":false,"properties":{"drlcType":{"title":"DrlcType","type":"integer","minimum":0,"maximum":1},"drlcLevel":{"title":"DrlcLevel","type":"integer","minimum":-1,"maximum":3},"start":{"title":"Iso8601Date","type":"string","pattern":"^(?:[1-9]\\d{3}-?(?:(?:0[1-9]|1[0-2])-?(?:0[1-9]|1\\d|2[0-8])|(?:0[13-9]|1[0-2])-?(?:29|30)|(?:0[13578]|1[02])-?31)|(?:[1-9]\\d(?:0[48]|[2468][048]|[13579][26])|(?:[2468][048]|[13579][26])00)-?02-?29)T(?:[01]\\d|2[0-3]):?[0-5]\\d:?[0-5]\\d(?:\\.\\d{3})?(?:Z|[+-][01]\\d(?::?[0-5]\\d)?)$"},"duration":{"title":"PositiveInteger","type":"integer","minimum":0},"override":{"type":"boolean"}}}},"additionalProperties":false,"required":["value"]},"enumCommands":[]}},"commands":{"overrideDrlcAction":{"arguments":[{"name":"value","optional":false,"schema":{"type":"boolean"}}]},"requestDrlcAction":{"arguments":[{"name":"drlcType","optional":false,"schema":{"title":"DrlcType","type":"integer","minimum":0,"maximum":1}},{"name":"drlcLevel","optional":false,"schema":{"title":"DrlcLevel","type":"integer","minimum":-1,"maximum":3}},{"name":"start","optional":false,"schema":{"title":"Iso8601Date","type":"string","pattern":"^(?:[1-9]\\d{3}-?(?:(?:0[1-9]|1[0-2])-?(?:0[1-9]|1\\d|2[0-8])|(?:0[13-9]|1[0-2])-?(?:29|30)|(?:0[13578]|1[02])-?31)|(?:[1-9]\\d(?:0[48]|[2468][048]|[13579][26])|(?:[2468][048]|[13579][26])00)-?02-?29)T(?:[01]\\d|2[0-3]):?[0-5]\\d:?[0-5]\\d(?:\\.\\d{3})?(?:Z|[+-][01]\\d(?::?[0-5]\\d)?)$"}},{"name":"duration","optional":false,"schema":{"title":"PositiveInteger","type":"integer","minimum":0}},{"name":"reportingPeriod","optional":true,"schema":{"title":"PositiveInteger","type":"integer","minimum":0}}]}}},{"id":"dewPoint","version":1,"status":"proposed","name":"Dew Point","attributes":{"dewpoint":{"schema":{"type":"object","properties":{"value":{"title":"TemperatureValue","type":"number","minimum":-460,"maximum":10000},"unit":{"type":"string","enum":["F","C"]}},"additionalProperties":false,"required":["value","unit"]},"enumCommands":[]}},"commands":{}},{"id":"dishwasherMode","version":1,"status":"proposed","name":"Dishwasher Mode","attributes":{"dishwasherMode":{"schema":{"type":"object","properties":{"value":{"title":"DishwasherMode","type":"string","enum":["auto","quick","rinse","dry"]}},"additionalProperties":false,"required":["value"]},"setter":"setDishwasherMode","enumCommands":[]}},"commands":{"setDishwasherMode":{"arguments":[{"name":"mode","optional":false,"schema":{"title":"DishwasherMode","type":"string","enum":["auto","quick","rinse","dry"]}}]}}},{"id":"dishwasherOperatingState","version":1,"status":"proposed","name":"Dishwasher Operating State","attributes":{"completionTime":{"schema":{"type":"object","properties":{"value":{"title":"Iso8601Date","type":"string","pattern":"^(?:[1-9]\\d{3}-?(?:(?:0[1-9]|1[0-2])-?(?:0[1-9]|1\\d|2[0-8])|(?:0[13-9]|1[0-2])-?(?:29|30)|(?:0[13578]|1[02])-?31)|(?:[1-9]\\d(?:0[48]|[2468][048]|[13579][26])|(?:[2468][048]|[13579][26])00)-?02-?29)T(?:[01]\\d|2[0-3]):?[0-5]\\d:?[0-5]\\d(?:\\.\\d{3})?(?:Z|[+-][01]\\d(?::?[0-5]\\d)?)$"}},"additionalProperties":false,"required":["value"]},"enumCommands":[]},"machineState":{"schema":{"type":"object","properties":{"value":{"title":"MachineState","type":"string","enum":["pause","run","stop"]}},"additionalProperties":false,"required":["value"]},"setter":"setMachineState","enumCommands":[]},"supportedMachineStates":{"schema":{"type":"object","properties":{"value":{"type":"array","items":{"title":"MachineState","type":"string","enum":["pause","run","stop"]}}},"additionalProperties":false,"required":["value"]},"enumCommands":[]},"dishwasherJobState":{"schema":{"type":"object","properties":{"value":{"title":"DishwasherJobState","type":"string","enum":["airwash","cooling","drying","finish","preDrain","prewash","rinse","spin","unknown","wash","wrinklePrevent"]}},"additionalProperties":false,"required":["value"]},"enumCommands":[]}},"commands":{"setMachineState":{"arguments":[{"name":"state","optional":false,"schema":{"title":"MachineState","type":"string","enum":["pause","run","stop"]}}]}}},{"id":"dishwasherOperationalState","version":1,"status":"deprecated","name":"Dishwasher Operational State","attributes":{"completionTime":{"schema":{"type":"object","properties":{"value":{"title":"Iso8601Date","type":"string","pattern":"^(?:[1-9]\\d{3}-?(?:(?:0[1-9]|1[0-2])-?(?:0[1-9]|1\\d|2[0-8])|(?:0[13-9]|1[0-2])-?(?:29|30)|(?:0[13578]|1[02])-?31)|(?:[1-9]\\d(?:0[48]|[2468][048]|[13579][26])|(?:[2468][048]|[13579][26])00)-?02-?29)T(?:[01]\\d|2[0-3]):?[0-5]\\d:?[0-5]\\d(?:\\.\\d{3})?(?:Z|[+-][01]\\d(?::?[0-5]\\d)?)$"}},"additionalProperties":false,"required":["value"]},"enumCommands":[]},"machineState":{"schema":{"type":"object","properties":{"value":{"title":"MachineState","type":"string","enum":["pause","run","stop"]}},"additionalProperties":false,"required":["value"]},"setter":"setMachineState","enumCommands":[]},"supportedMachineStates":{"schema":{"type":"object","properties":{"value":{"type":"array","items":{"title":"MachineState","type":"string","enum":["pause","run","stop"]}}},"additionalProperties":false,"required":["value"]},"enumCommands":[]},"dishwasherJobState":{"schema":{"type":"object","properties":{"value":{"title":"DishwasherJobState","type":"string","enum":["airwash","cooling","drying","finish","preDrain","prewash","rinse","spin","unknown","wash","wrinklePrevent"]}},"additionalProperties":false,"required":["value"]},"enumCommands":[]}},"commands":{"setMachineState":{"arguments":[{"name":"state","optional":false,"schema":{"title":"MachineState","type":"string","enum":["pause","run","stop"]}}]}}},{"id":"doorControl","version":1,"status":"live","name":"Door Control","attributes":{"door":{"schema":{"type":"object","properties":{"value":{"type":"string","enum":["closed","closing","open","opening","unknown"]}},"additionalProperties":false,"required":["value"]},"enumCommands":[{"command":"close","value":"closed"},{"command":"open","value":"open"}]}},"commands":{"close":{"arguments":[]},"open":{"arguments":[]}}},{"id":"drivingStatus","version":1,"status":"proposed","name":"Driving Status","attributes":{"drivingStatus":{"schema":{"type":"object","properties":{"value":{"type":"string","enum":["driving","notDriving"]}},"additionalProperties":false,"required":["value"]},"enumCommands":[]}},"commands":{}},{"id":"dryerMode","version":1,"status":"proposed","name":"Dryer Mode","attributes":{"dryerMode":{"schema":{"type":"object","properties":{"value":{"title":"DryerMode","type":"string","enum":["regular","lowHeat","highHeat"]}},"additionalProperties":false,"required":["value"]},"setter":"setDryerMode","enumCommands":[]}},"commands":{"setDryerMode":{"arguments":[{"name":"mode","optional":false,"schema":{"title":"DryerMode","type":"string","enum":["regular","lowHeat","highHeat"]}}]}}},{"id":"dryerOperatingState","version":1,"status":"proposed","name":"Dryer Operating State","attributes":{"completionTime":{"schema":{"type":"object","properties":{"value":{"title":"Iso8601Date","type":"string","pattern":"^(?:[1-9]\\d{3}-?(?:(?:0[1-9]|1[0-2])-?(?:0[1-9]|1\\d|2[0-8])|(?:0[13-9]|1[0-2])-?(?:29|30)|(?:0[13578]|1[02])-?31)|(?:[1-9]\\d(?:0[48]|[2468][048]|[13579][26])|(?:[2468][048]|[13579][26])00)-?02-?29)T(?:[01]\\d|2[0-3]):?[0-5]\\d:?[0-5]\\d(?:\\.\\d{3})?(?:Z|[+-][01]\\d(?::?[0-5]\\d)?)$"}},"additionalProperties":false,"required":["value"]},"enumCommands":[]},"machineState":{"schema":{"type":"object","properties":{"value":{"title":"MachineState","type":"string","enum":["pause","run","stop"]}},"additionalProperties":false,"required":["value"]},"setter":"setMachineState","enumCommands":[]},"supportedMachineStates":{"schema":{"type":"object","properties":{"value":{"type":"array","items":{"title":"MachineState","type":"string","enum":["pause","run","stop"]}}},"additionalProperties":false,"required":["value"]},"enumCommands":[]},"dryerJobState":{"schema":{"type":"object","properties":{"value":{"title":"DryerJobState","type":"string","enum":["cooling","delayWash","drying","finished","none","refreshing","weightSensing","wrinklePrevent"]}},"additionalProperties":false,"required":["value"]},"enumCommands":[]}},"commands":{"setMachineState":{"arguments":[{"name":"state","optional":false,"schema":{"title":"MachineState","type":"string","enum":["pause","run","stop"]}}]}}},{"id":"dustHealthConcern","version":1,"status":"proposed","name":"Dust Health Concern","attributes":{"dustHealthConcern":{"schema":{"type":"object","properties":{"value":{"title":"AirQualityHealthConcern","type":"string","enum":["good","moderate","slightlyUnhealthy","unhealthy","veryUnhealthy","hazardous"]}},"additionalProperties":false,"required":["value"]},"enumCommands":[]}},"commands":{}},{"id":"dustSensor","version":1,"status":"live","name":"Dust Sensor","attributes":{"dustLevel":{"schema":{"type":"object","properties":{"value":{"title":"PositiveInteger","type":"integer","minimum":0},"unit":{"type":"string","enum":["μg/m^3"],"default":"μg/m^3"}},"additionalProperties":false,"required":["value"]},"enumCommands":[]},"fineDustLevel":{"schema":{"type":"object","properties":{"value":{"title":"PositiveInteger","type":"integer","minimum":0},"unit":{"type":"string","enum":["μg/m^3"],"default":"μg/m^3"}},"additionalProperties":false,"required":["value"]},"enumCommands":[]}},"commands":{}},{"id":"elevatorCall","version":1,"status":"proposed","name":"Elevator Call","attributes":{"callStatus":{"schema":{"type":"object","properties":{"value":{"type":"string","enum":["called","standby","unknown"]}},"additionalProperties":false,"required":["value"]},"enumCommands":[]}},"commands":{"call":{"arguments":[]}}},{"id":"energyMeter","version":1,"status":"live","name":"Energy Meter","attributes":{"energy":{"schema":{"type":"object","properties":{"value":{"type":"number"},"unit":{"type":"string","enum":["Wh","kWh","mWh","kVAh"],"default":"kWh"}},"additionalProperties":false,"required":["value"]},"enumCommands":[]}},"commands":{"resetEnergyMeter":{"arguments":[]}}},{"id":"equivalentCarbonDioxideMeasurement","version":1,"status":"live","name":"Equivalent Carbon Dioxide Measurement","attributes":{"equivalentCarbonDioxideMeasurement":{"schema":{"type":"object","properties":{"value":{"type":"number","minimum":0,"maximum":1000000},"unit":{"type":"string","enum":["ppm"],"default":"ppm"}},"additionalProperties":false,"required":["value"]},"enumCommands":[]}},"commands":{}},{"id":"estimatedTimeOfArrival","version":1,"status":"proposed","name":"Estimated Time Of Arrival","attributes":{"eta":{"schema":{"type":"object","properties":{"value":{"title":"Iso8601Date","type":"string","pattern":"^(?:[1-9]\\d{3}-?(?:(?:0[1-9]|1[0-2])-?(?:0[1-9]|1\\d|2[0-8])|(?:0[13-9]|1[0-2])-?(?:29|30)|(?:0[13578]|1[02])-?31)|(?:[1-9]\\d(?:0[48]|[2468][048]|[13579][26])|(?:[2468][048]|[13579][26])00)-?02-?29)T(?:[01]\\d|2[0-3]):?[0-5]\\d:?[0-5]\\d(?:\\.\\d{3})?(?:Z|[+-][01]\\d(?::?[0-5]\\d)?)$"}},"additionalProperties":false,"required":["value"]},"enumCommands":[]}},"commands":{}},{"id":"execute","version":1,"status":"live","name":"Execute","attributes":{"data":{"schema":{"type":"object","properties":{"value":{"title":"JsonObject","type":"object"},"data":{"type":"object","additionalProperties":true,"required":[]}},"additionalProperties":false,"required":["value"]},"enumCommands":[]}},"commands":{"execute":{"arguments":[{"name":"command","optional":false,"schema":{"title":"String","type":"string","maxLength":255}},{"name":"args","optional":true,"schema":{"title":"JsonObject","type":"object"}}]}}},{"id":"fanOscillationMode","version":1,"status":"proposed","name":"Fan Oscillation Mode","attributes":{"fanOscillationMode":{"schema":{"type":"object","properties":{"value":{"title":"FanOscillationMode","type":"string","enum":["fixed","vertical","horizontal","all","indirect","direct","fixedCenter","fixedLeft","fixedRight","far"]}},"additionalProperties":false,"required":[]},"enumCommands":[]}},"commands":{"setFanOscillationMode":{"arguments":[{"name":"fanOscillationMode","optional":false,"schema":{"title":"FanOscillationMode","type":"string","enum":["fixed","vertical","horizontal","all","indirect","direct","fixedCenter","fixedLeft","fixedRight","far"]}}]}}},{"id":"fanSpeed","version":1,"status":"live","name":"Fan Speed","attributes":{"fanSpeed":{"schema":{"type":"object","properties":{"value":{"title":"PositiveInteger","type":"integer","minimum":0}},"additionalProperties":false,"required":["value"]},"setter":"setFanSpeed","enumCommands":[]}},"commands":{"setFanSpeed":{"arguments":[{"name":"speed","optional":false,"schema":{"title":"PositiveInteger","type":"integer","minimum":0}}]}}},{"id":"feederOperatingState","version":1,"status":"proposed","name":"Feeder Operating State","attributes":{"feederOperatingState":{"schema":{"type":"object","properties":{"value":{"type":"string","enum":["idle","feeding"]}},"additionalProperties":false,"required":["value"]},"enumCommands":[{"command":"startFeeding","value":"feeding"}]}},"commands":{"startFeeding":{"arguments":[]}}},{"id":"feederPortion","version":1,"status":"proposed","name":"Feeder Portion","attributes":{"feedPortion":{"schema":{"title":"FeedPortion","type":"object","properties":{"value":{"type":"number","minimum":0,"maximum":2000},"unit":{"type":"string","enum":["g","lbs","oz"],"default":"g"}},"additionalProperties":false,"required":["value","unit"]},"setter":"setPortion","enumCommands":[]}},"commands":{"setPortion":{"arguments":[{"name":"portion","optional":false,"schema":{"title":"FeedPortion","type":"object","additionalProperties":false,"properties":{"value":{"type":"number","minimum":0,"maximum":2000},"unit":{"type":"string","enum":["g","lbs","oz"],"default":"g"}},"required":["value","unit"]}}]}}},{"id":"filterState","version":1,"status":"live","name":"Filter State","attributes":{"filterLifeRemaining":{"schema":{"type":"object","properties":{"value":{"title":"PositiveInteger","type":"integer","minimum":0}},"additionalProperties":false,"required":["value"]},"enumCommands":[]}},"commands":{}},{"id":"filterStatus","version":1,"status":"proposed","name":"Filter Status","attributes":{"filterStatus":{"schema":{"type":"object","properties":{"value":{"type":"string","enum":["normal","replace"]}},"additionalProperties":false,"required":["value"]},"enumCommands":[]}},"commands":{}},{"id":"fineDustHealthConcern","version":1,"status":"proposed","name":"Fine Dust Health Concern","attributes":{"fineDustHealthConcern":{"schema":{"type":"object","properties":{"value":{"title":"AirQualityHealthConcern","type":"string","enum":["good","moderate","slightlyUnhealthy","unhealthy","veryUnhealthy","hazardous"]}},"additionalProperties":false,"required":["value"]},"enumCommands":[]}},"commands":{}},{"id":"fineDustSensor","version":1,"status":"live","name":"Fine Dust Sensor","attributes":{"fineDustLevel":{"schema":{"type":"object","properties":{"value":{"title":"PositiveInteger","type":"integer","minimum":0},"unit":{"type":"string","enum":["μg/m^3"],"default":"μg/m^3"}},"additionalProperties":false,"required":["value"]},"enumCommands":[]}},"commands":{}},{"id":"firmwareUpdate","version":1,"status":"proposed","name":"Firmware Update","attributes":{"lastUpdateStatusReason":{"schema":{"type":"object","properties":{"value":{"type":"string"}},"additionalProperties":false,"required":[]},"enumCommands":[]},"availableVersion":{"schema":{"type":"object","properties":{"value":{"type":"string"}},"additionalProperties":false,"required":[]},"enumCommands":[]},"lastUpdateStatus":{"schema":{"type":"object","properties":{"value":{"type":"string","enum":["updateSucceeded","updateFailed"]}},"additionalProperties":false,"required":[]},"enumCommands":[]},"state":{"schema":{"type":"object","properties":{"value":{"type":"string","enum":["normalOperation","updateInProgress"]}},"additionalProperties":false,"required":[]},"enumCommands":[]},"currentVersion":{"schema":{"type":"object","properties":{"value":{"type":"string"}},"additionalProperties":false,"required":[]},"enumCommands":[]},"lastUpdateTime":{"schema":{"type":"object","properties":{"value":{"title":"Iso8601Date","type":"string","pattern":"^(?:[1-9]\\d{3}-?(?:(?:0[1-9]|1[0-2])-?(?:0[1-9]|1\\d|2[0-8])|(?:0[13-9]|1[0-2])-?(?:29|30)|(?:0[13578]|1[02])-?31)|(?:[1-9]\\d(?:0[48]|[2468][048]|[13579][26])|(?:[2468][048]|[13579][26])00)-?02-?29)T(?:[01]\\d|2[0-3]):?[0-5]\\d:?[0-5]\\d(?:\\.\\d{3})?(?:Z|[+-][01]\\d(?::?[0-5]\\d)?)$"}},"additionalProperties":false,"required":[]},"enumCommands":[]}},"commands":{"updateFirmware":{"arguments":[]},"checkForFirmwareUpdate":{"arguments":[]}}},{"id":"formaldehydeMeasurement","version":1,"status":"live","name":"Formaldehyde Measurement","attributes":{"formaldehydeLevel":{"schema":{"type":"object","properties":{"value":{"type":"number","minimum":0,"maximum":1000000},"unit":{"type":"string","enum":["ppm","mg/m^3"],"default":"ppm"}},"additionalProperties":false,"required":["value","unit"]},"enumCommands":[]}},"commands":{}},{"id":"garageDoorControl","version":1,"status":"deprecated","name":"Garage Door Control","attributes":{"door":{"schema":{"type":"object","properties":{"value":{"type":"string","enum":["closed","closing","open","opening","unknown"]}},"additionalProperties":false,"required":["value"]},"enumCommands":[{"command":"close","value":"closed"},{"command":"open","value":"open"}]}},"commands":{"close":{"arguments":[]},"open":{"arguments":[]}}},{"id":"gasDetector","version":1,"status":"proposed","name":"Gas Detector","attributes":{"gas":{"schema":{"type":"object","properties":{"value":{"type":"string","enum":["clear","detected","tested"]}},"additionalProperties":false,"required":["value"]},"enumCommands":[]}},"commands":{}},{"id":"gasMeter","version":1,"status":"proposed","name":"Gas Meter","attributes":{"gasMeterPrecision":{"schema":{"type":"object","properties":{"value":{"title":"GasMeterPrecision","type":"object","additionalProperties":false,"properties":{"volume":{"title":"VolumePrecision","type":"number"},"calorific":{"title":"CalorificPrecision","type":"number"},"conversion":{"title":"ConversionPrecision","type":"number"}}}},"additionalProperties":false,"required":["value"]},"enumCommands":[]},"gasMeterCalorific":{"schema":{"type":"object","properties":{"value":{"type":"number"}},"additionalProperties":false,"required":["value"]},"enumCommands":[]},"gasMeterTime":{"schema":{"type":"object","properties":{"value":{"title":"Iso8601Date","type":"string","pattern":"^(?:[1-9]\\d{3}-?(?:(?:0[1-9]|1[0-2])-?(?:0[1-9]|1\\d|2[0-8])|(?:0[13-9]|1[0-2])-?(?:29|30)|(?:0[13578]|1[02])-?31)|(?:[1-9]\\d(?:0[48]|[2468][048]|[13579][26])|(?:[2468][048]|[13579][26])00)-?02-?29)T(?:[01]\\d|2[0-3]):?[0-5]\\d:?[0-5]\\d(?:\\.\\d{3})?(?:Z|[+-][01]\\d(?::?[0-5]\\d)?)$"}},"additionalProperties":false,"required":["value"]},"enumCommands":[]},"gasMeterVolume":{"schema":{"type":"object","properties":{"value":{"type":"number"},"unit":{"type":"string","enum":["m^3"],"default":"m^3"}},"additionalProperties":false,"required":["value"]},"enumCommands":[]},"gasMeterConversion":{"schema":{"type":"object","properties":{"value":{"type":"number"}},"additionalProperties":false,"required":["value"]},"enumCommands":[]},"gasMeter":{"schema":{"type":"object","properties":{"value":{"type":"number"},"unit":{"type":"string","enum":["kWh"],"default":"kWh"}},"additionalProperties":false,"required":["value"]},"enumCommands":[]}},"commands":{}},{"id":"geofence","version":1,"status":"proposed","name":"Geofence","attributes":{"enableState":{"schema":{"type":"object","properties":{"value":{"title":"EnableState","type":"string","enum":["enabled","disabled"]}},"additionalProperties":false,"required":["value"]},"setter":"setEnableState","enumCommands":[]},"geofence":{"schema":{"type":"object","properties":{"value":{"title":"GeofenceRadiusData","type":"object","additionalProperties":false,"properties":{"longitude":{"type":"number"},"latitude":{"type":"number"},"radius":{"type":"number"}}}},"additionalProperties":false,"required":["value"]},"setter":"setGeofence","enumCommands":[]},"name":{"schema":{"type":"object","properties":{"value":{"type":"string"}},"additionalProperties":false,"required":["value"]},"setter":"setName","enumCommands":[]}},"commands":{"setName":{"arguments":[{"name":"name","optional":false,"schema":{"type":"string"}}]},"setEnableState":{"arguments":[{"name":"enableState","optional":false,"schema":{"title":"EnableState","type":"string","enum":["enabled","disabled"]}}]},"setGeofence":{"arguments":[{"name":"geofence","optional":false,"schema":{"title":"GeofenceRadiusData","type":"object","additionalProperties":false,"properties":{"longitude":{"type":"number"},"latitude":{"type":"number"},"radius":{"type":"number"}}}}]}}},{"id":"geofences","version":1,"status":"deprecated","name":"Geofences","attributes":{"geofences":{"schema":{"type":"object","properties":{"value":{"type":"array","items":{"title":"Geofence","type":"object","additionalProperties":false,"properties":{"id":{"title":"PositiveInteger","type":"integer","minimum":0},"presence":{"title":"PresenceState","type":"string","enum":["present","not present"]}}}}},"additionalProperties":false,"required":["value"]},"enumCommands":[]}},"commands":{}},{"id":"geolocation","version":1,"status":"proposed","name":"Geolocation","attributes":{"method":{"schema":{"type":"object","properties":{"value":{"title":"String","type":"string","maxLength":255}},"additionalProperties":false,"required":[]},"enumCommands":[]},"heading":{"schema":{"type":"object","properties":{"value":{"type":"number","minimum":0,"maximum":360}},"additionalProperties":false,"required":[]},"enumCommands":[]},"latitude":{"schema":{"type":"object","properties":{"value":{"type":"integer","maximum":90,"minimum":-90}},"additionalProperties":false,"required":[]},"enumCommands":[]},"accuracy":{"schema":{"type":"object","properties":{"value":{"type":"number","minimum":0}},"additionalProperties":false,"required":[]},"enumCommands":[]},"altitudeAccuracy":{"schema":{"type":"object","properties":{"value":{"type":"number","minimum":0}},"additionalProperties":false,"required":[]},"enumCommands":[]},"speed":{"schema":{"type":"object","properties":{"value":{"type":"number","minimum":0}},"additionalProperties":false,"required":[]},"enumCommands":[]},"longitude":{"schema":{"type":"object","properties":{"value":{"type":"integer","maximum":180,"minimum":-180}},"additionalProperties":false,"required":[]},"enumCommands":[]},"lastUpdateTime":{"schema":{"type":"object","properties":{"value":{"title":"PositiveInteger","type":"integer","minimum":0}},"additionalProperties":false,"required":[]},"enumCommands":[]}},"commands":{}},{"id":"healthCheck","version":1,"status":"live","name":"Health Check","attributes":{"checkInterval":{"schema":{"type":"object","properties":{"value":{"type":"integer","minimum":0,"maximum":604800},"unit":{"type":"string","enum":["s"],"default":"s"},"data":{"type":"object","additionalProperties":false,"required":[],"properties":{"deviceScheme":{"type":"string","enum":["MIXED","TRACKED","UNTRACKED"]},"hubHardwareId":{"type":"string","pattern":"^[0-9a-fA-F]{4}$"},"protocol":{"title":"DeviceHealthProtocol","type":"string","enum":["zigbee","zwave","bluetooth","lan","cloud","unknown","ocf","mqtt"]},"offlinePingable":{"type":"string","enum":["0","1"]},"badProperty":{"type":"string"}}}},"additionalProperties":false,"required":["value"]},"enumCommands":[]},"healthStatus":{"schema":{"type":"object","properties":{"value":{"type":"string","enum":["online","offline"]},"data":{"type":"object","additionalProperties":false,"required":[],"properties":{"deviceScheme":{"type":"string","enum":["MIXED","TRACKED","UNTRACKED"]},"badProperty":{"type":"string"}}}},"additionalProperties":false,"required":["value"]},"enumCommands":[]},"DeviceWatch-Enroll":{"schema":{"type":"object","properties":{"value":{"title":"DeviceHealthEnroll","type":"object","additionalProperties":false,"properties":{"scheme":{"type":"string","enum":["MIXED","TRACKED","UNTRACKED"]},"protocol":{"title":"DeviceHealthProtocol","type":"string","enum":["zigbee","zwave","bluetooth","lan","cloud","unknown","ocf","mqtt"]},"hubHardwareId":{"title":"String","type":"string","maxLength":255}}}},"additionalProperties":false,"required":["value"]},"enumCommands":[]},"DeviceWatch-DeviceStatus":{"schema":{"type":"object","properties":{"value":{"type":"string","enum":["online","offline"]},"data":{"type":"object","additionalProperties":false,"required":[],"properties":{"deviceScheme":{"type":"string","enum":["MIXED","TRACKED","UNTRACKED"]},"badProperty":{"type":"string"}}}},"additionalProperties":false,"required":["value"]},"enumCommands":[]}},"commands":{"ping":{"arguments":[]}}},{"id":"holdableButton","version":1,"status":"deprecated","name":"Holdable Button","attributes":{"button":{"schema":{"type":"object","properties":{"value":{"type":"string","enum":["held","pushed"]}},"additionalProperties":false,"required":["value"]},"enumCommands":[]},"numberOfButtons":{"schema":{"type":"object","properties":{"value":{"title":"PositiveInteger","type":"integer","minimum":0}},"additionalProperties":false,"required":["value"]},"enumCommands":[]}},"commands":{}},{"id":"humidifierMode","version":1,"status":"proposed","name":"Humidifier Mode","attributes":{"humidifierMode":{"schema":{"type":"object","properties":{"value":{"title":"HumidifierMode","type":"string","enum":["auto","low","medium","high"]}},"additionalProperties":false,"required":[]},"enumCommands":[]}},"commands":{"setHumidifierMode":{"arguments":[{"name":"humidifierMode","optional":false,"schema":{"title":"HumidifierMode","type":"string","enum":["auto","low","medium","high"]}}]}}},{"id":"illuminanceMeasurement","version":1,"status":"live","name":"Illuminance Measurement","attributes":{"illuminance":{"schema":{"type":"object","properties":{"value":{"type":"number","minimum":0,"maximum":100000},"unit":{"type":"string","enum":["lux"],"default":"lux"}},"additionalProperties":false,"required":["value"]},"enumCommands":[]}},"commands":{}},{"id":"imageCapture","version":1,"status":"live","name":"Image Capture","attributes":{"image":{"schema":{"type":"object","properties":{"value":{"title":"URL","type":"string","pattern":"^(https?):\\/\\/((?:[a-zA-Z0-9.-]|%[0-9A-F]{2}){3,})(?::(\\d+))?((?:\\/(?:[a-zA-Z0-9-._~!$&'()*+,;=:@]|%[0-9A-F]{2})*)*)(?:\\?((?:[a-zA-Z0-9-._~!$&'()*+,;=:\\/?@]|%[0-9A-F]{2})*))?(?:#((?:[a-zA-Z0-9-._~!$&'()*+,;=:\\/?@]|%[0-9A-F]{2})*))?$"}},"additionalProperties":false,"required":["value"]},"setter":"take","enumCommands":[]},"encrypted":{"schema":{"type":"object","properties":{"value":{"type":"boolean"}},"additionalProperties":false,"required":["value"]},"enumCommands":[]},"captureTime":{"schema":{"type":"object","properties":{"value":{"title":"Iso8601Date","type":"string","pattern":"^(?:[1-9]\\d{3}-?(?:(?:0[1-9]|1[0-2])-?(?:0[1-9]|1\\d|2[0-8])|(?:0[13-9]|1[0-2])-?(?:29|30)|(?:0[13578]|1[02])-?31)|(?:[1-9]\\d(?:0[48]|[2468][048]|[13579][26])|(?:[2468][048]|[13579][26])00)-?02-?29)T(?:[01]\\d|2[0-3]):?[0-5]\\d:?[0-5]\\d(?:\\.\\d{3})?(?:Z|[+-][01]\\d(?::?[0-5]\\d)?)$"}},"additionalProperties":false,"required":["value"]},"enumCommands":[]}},"commands":{"take":{"arguments":[{"name":"correlationId","optional":true,"schema":{"title":"String","type":"string","maxLength":255}},{"name":"reason","optional":true,"schema":{"title":"String","type":"string","maxLength":255}}]}}},{"id":"indicator","version":1,"status":"deprecated","name":"Indicator","attributes":{"indicatorStatus":{"schema":{"type":"object","properties":{"value":{"type":"string","enum":["never","when off","when on"]}},"additionalProperties":false,"required":["value"]},"enumCommands":[{"command":"indicatorNever","value":"never"},{"command":"indicatorWhenOff","value":"when off"},{"command":"indicatorWhenOn","value":"when on"}]}},"commands":{"indicatorNever":{"arguments":[]},"indicatorWhenOn":{"arguments":[]},"indicatorWhenOff":{"arguments":[]}}},{"id":"infraredLevel","version":1,"status":"live","name":"Infrared Level","attributes":{"infraredLevel":{"schema":{"title":"Percent","type":"object","properties":{"value":{"type":"number","minimum":0,"maximum":100},"unit":{"type":"string","enum":["%"],"default":"%"}},"additionalProperties":false,"required":["value"]},"setter":"setInfraredLevel","enumCommands":[]}},"commands":{"setInfraredLevel":{"arguments":[{"name":"level","optional":false,"schema":{"type":"number","minimum":0,"maximum":100}}]}}},{"id":"languageSetting","version":1,"status":"proposed","name":"Language Setting","attributes":{"supportedLanguages":{"schema":{"type":"object","properties":{"value":{"type":"array","items":{"type":"string"}}},"additionalProperties":false,"required":[]},"enumCommands":[]},"language":{"schema":{"type":"object","properties":{"value":{"type":"string"}},"additionalProperties":false,"required":[]},"setter":"setLanguage","enumCommands":[]}},"commands":{"setLanguage":{"arguments":[{"name":"language","optional":false,"schema":{"title":"String","type":"string","maxLength":255}}]}}},{"id":"light","version":1,"status":"deprecated","name":"Light","attributes":{"switch":{"schema":{"type":"object","properties":{"value":{"title":"SwitchState","type":"string","enum":["on","off"]}},"additionalProperties":false,"required":["value"]},"enumCommands":[{"command":"on","value":"on"},{"command":"off","value":"off"}]}},"commands":{"off":{"arguments":[]},"on":{"arguments":[]}}},{"id":"locationMode","version":1,"status":"live","name":"Location Mode","attributes":{"mode":{"schema":{"type":"object","properties":{"value":{"title":"String","type":"string","maxLength":255}},"additionalProperties":false,"required":["value"]},"setter":"setMode","enumCommands":[]}},"commands":{"setMode":{"arguments":[{"name":"mode","optional":false,"schema":{"title":"String","type":"string","maxLength":255}}]}}},{"id":"lock","version":1,"status":"live","name":"Lock","attributes":{"lock":{"schema":{"type":"object","properties":{"value":{"title":"LockState","type":"string","enum":["locked","unknown","unlocked","unlocked with timeout"]},"data":{"type":"object","additionalProperties":false,"required":[],"properties":{"method":{"type":"string","enum":["manual","keypad","auto","command","rfid","fingerprint","bluetooth"]},"codeId":{"type":"string"},"timeout":{"title":"Iso8601Date","type":"string","pattern":"^(?:[1-9]\\d{3}-?(?:(?:0[1-9]|1[0-2])-?(?:0[1-9]|1\\d|2[0-8])|(?:0[13-9]|1[0-2])-?(?:29|30)|(?:0[13578]|1[02])-?31)|(?:[1-9]\\d(?:0[48]|[2468][048]|[13579][26])|(?:[2468][048]|[13579][26])00)-?02-?29)T(?:[01]\\d|2[0-3]):?[0-5]\\d:?[0-5]\\d(?:\\.\\d{3})?(?:Z|[+-][01]\\d(?::?[0-5]\\d)?)$"}}}},"additionalProperties":false,"required":["value"]},"enumCommands":[{"command":"lock","value":"locked"},{"command":"unlock","value":"unlocked"}]}},"commands":{"unlock":{"arguments":[]},"lock":{"arguments":[]}}},{"id":"lockCodes","version":1,"status":"proposed","name":"Lock Codes","attributes":{"codeLength":{"schema":{"type":"object","properties":{"value":{"title":"PositiveInteger","type":"integer","minimum":0}},"additionalProperties":false,"required":[]},"setter":"setCodeLength","enumCommands":[]},"maxCodes":{"schema":{"type":"object","properties":{"value":{"title":"PositiveInteger","type":"integer","minimum":0}},"additionalProperties":false,"required":[]},"enumCommands":[]},"maxCodeLength":{"schema":{"type":"object","properties":{"value":{"title":"PositiveInteger","type":"integer","minimum":0}},"additionalProperties":false,"required":[]},"enumCommands":[]},"codeChanged":{"schema":{"type":"object","properties":{"value":{"title":"String","type":"string","maxLength":255},"data":{"type":"object","additionalProperties":false,"required":[],"properties":{"codeName":{"type":"string"}}}},"additionalProperties":false,"required":[]},"enumCommands":[]},"lock":{"schema":{"type":"object","properties":{"value":{"title":"LockState","type":"string","enum":["locked","unknown","unlocked","unlocked with timeout"]}},"additionalProperties":false,"required":[]},"enumCommands":[{"command":"lock","value":"locked"},{"command":"unlock","value":"unlocked"},{"command":"unlockWithTimeout","value":"unlocked with timeout"}]},"minCodeLength":{"schema":{"type":"object","properties":{"value":{"title":"PositiveInteger","type":"integer","minimum":0}},"additionalProperties":false,"required":[]},"enumCommands":[]},"codeReport":{"schema":{"type":"object","properties":{"value":{"title":"PositiveInteger","type":"integer","minimum":0}},"additionalProperties":false,"required":["value"]},"enumCommands":[]},"scanCodes":{"schema":{"type":"object","properties":{"value":{"title":"String","type":"string","maxLength":255}},"additionalProperties":false,"required":[]},"enumCommands":[]},"lockCodes":{"schema":{"type":"object","properties":{"value":{"title":"String","type":"string","maxLength":255}},"additionalProperties":false,"required":[]},"enumCommands":[]}},"commands":{"setCodeLength":{"arguments":[{"name":"length","optional":false,"schema":{"title":"PositiveInteger","type":"integer","minimum":0}}]},"reloadAllCodes":{"arguments":[]},"unlock":{"arguments":[]},"unlockWithTimeout":{"arguments":[]},"setCode":{"arguments":[{"name":"codeSlot","optional":false,"schema":{"title":"PositiveInteger","type":"integer","minimum":0}},{"name":"codePIN","optional":false,"schema":{"title":"String","type":"string","maxLength":255}},{"name":"codeName","optional":false,"schema":{"title":"String","type":"string","maxLength":255}}]},"updateCodes":{"arguments":[{"name":"codes","optional":false,"schema":{"title":"JsonObject","type":"object"}}]},"lock":{"arguments":[]},"requestCode":{"arguments":[{"name":"codeSlot","optional":false,"schema":{"title":"PositiveInteger","type":"integer","minimum":0}}]},"deleteCode":{"arguments":[{"name":"codeSlot","optional":false,"schema":{"title":"PositiveInteger","type":"integer","minimum":0}}]},"nameSlot":{"arguments":[{"name":"codeSlot","optional":false,"schema":{"title":"PositiveInteger","type":"integer","minimum":0}},{"name":"codeName","optional":false,"schema":{"title":"String","type":"string","maxLength":255}}]}}},{"id":"lockOnly","version":1,"status":"deprecated","name":"Lock Only","attributes":{"lock":{"schema":{"type":"object","properties":{"value":{"title":"LockState","type":"string","enum":["locked","unknown","unlocked","unlocked with timeout"]}},"additionalProperties":false,"required":["value"]},"enumCommands":[{"command":"lock","value":"locked"}]}},"commands":{"lock":{"arguments":[]}}},{"id":"logTrigger","version":1,"status":"proposed","name":"Log Trigger","attributes":{"logState":{"schema":{"type":"object","properties":{"value":{"type":"string","enum":["idle","inProgress"]}},"additionalProperties":false,"required":[]},"enumCommands":[]},"logRequestState":{"schema":{"type":"object","properties":{"value":{"type":"string","enum":["idle","triggerRequired"]}},"additionalProperties":false,"required":[]},"enumCommands":[]},"logInfo":{"schema":{"type":"object","properties":{"value":{"title":"JsonObject","type":"object"}},"additionalProperties":false,"required":["value"]},"enumCommands":[]}},"commands":{"triggerLogWithUrl":{"arguments":[{"name":"url","optional":true,"schema":{"title":"URL","type":"string","pattern":"^(https?):\\/\\/((?:[a-zA-Z0-9.-]|%[0-9A-F]{2}){3,})(?::(\\d+))?((?:\\/(?:[a-zA-Z0-9-._~!$&'()*+,;=:@]|%[0-9A-F]{2})*)*)(?:\\?((?:[a-zA-Z0-9-._~!$&'()*+,;=:\\/?@]|%[0-9A-F]{2})*))?(?:#((?:[a-zA-Z0-9-._~!$&'()*+,;=:\\/?@]|%[0-9A-F]{2})*))?$"}}]},"triggerLogWithLogInfo":{"arguments":[{"name":"logInfo","optional":false,"schema":{"title":"JsonObject","type":"object"}}]},"triggerLog":{"arguments":[]}}},{"id":"mediaController","version":1,"status":"proposed","name":"Media Controller","attributes":{"currentActivity":{"schema":{"type":"object","properties":{"value":{"title":"String","type":"string","maxLength":255}},"additionalProperties":false,"required":["value"]},"enumCommands":[]},"activities":{"schema":{"type":"object","properties":{"value":{"title":"JsonObject","type":"object"}},"additionalProperties":false,"required":["value"]},"enumCommands":[]}},"commands":{"startActivity":{"arguments":[{"name":"activityId","optional":false,"schema":{"title":"String","type":"string","maxLength":255}}]}}},{"id":"mediaGroup","version":1,"status":"proposed","name":"Media Group","attributes":{"groupMute":{"schema":{"type":"object","properties":{"value":{"title":"MuteState","type":"string","enum":["muted","unmuted"]}},"additionalProperties":false,"required":["value"]},"setter":"setGroupMute","enumCommands":[{"command":"muteGroup","value":"muted"},{"command":"unmuteGroup","value":"unmuted"}]},"groupPrimaryDeviceId":{"schema":{"type":"object","properties":{"value":{"title":"String","type":"string","maxLength":255}},"additionalProperties":false,"required":["value"]},"enumCommands":[]},"groupId":{"schema":{"type":"object","properties":{"value":{"title":"String","type":"string","maxLength":255}},"additionalProperties":false,"required":["value"]},"enumCommands":[]},"groupVolume":{"schema":{"title":"IntegerPercent","type":"object","properties":{"value":{"type":"integer","minimum":0,"maximum":100},"unit":{"type":"string","enum":["%"],"default":"%"}},"additionalProperties":false,"required":["value"]},"setter":"setGroupVolume","enumCommands":[]},"groupRole":{"schema":{"type":"object","properties":{"value":{"type":"string","enum":["primary","auxilary","ungrouped"]}},"additionalProperties":false,"required":["value"]},"enumCommands":[]}},"commands":{"groupVolumeUp":{"arguments":[]},"groupVolumeDown":{"arguments":[]},"muteGroup":{"arguments":[]},"setGroupVolume":{"arguments":[{"name":"groupVolume","optional":false,"schema":{"type":"integer","minimum":0,"maximum":100}}]},"unmuteGroup":{"arguments":[]},"setGroupMute":{"arguments":[{"name":"state","optional":false,"schema":{"title":"MuteState","type":"string","enum":["muted","unmuted"]}}]}}},{"id":"mediaInputSource","version":1,"status":"proposed","name":"Media Input Source","attributes":{"supportedInputSources":{"schema":{"type":"object","properties":{"value":{"type":"array","items":{"title":"MediaSource","type":"string","enum":["AM","CD","FM","HDMI","HDMI1","HDMI2","HDMI3","HDMI4","HDMI5","HDMI6","digitalTv","USB","YouTube","aux","bluetooth","digital","melon","wifi"]}}},"additionalProperties":false,"required":["value"]},"enumCommands":[]},"inputSource":{"schema":{"type":"object","properties":{"value":{"title":"MediaSource","type":"string","enum":["AM","CD","FM","HDMI","HDMI1","HDMI2","HDMI3","HDMI4","HDMI5","HDMI6","digitalTv","USB","YouTube","aux","bluetooth","digital","melon","wifi"]}},"additionalProperties":false,"required":["value"]},"setter":"setInputSource","enumCommands":[]}},"commands":{"setInputSource":{"arguments":[{"name":"mode","optional":false,"schema":{"title":"MediaSource","type":"string","enum":["AM","CD","FM","HDMI","HDMI1","HDMI2","HDMI3","HDMI4","HDMI5","HDMI6","digitalTv","USB","YouTube","aux","bluetooth","digital","melon","wifi"]}}]}}},{"id":"mediaPlayback","version":1,"status":"proposed","name":"Media Playback","attributes":{"supportedPlaybackCommands":{"schema":{"type":"object","properties":{"value":{"type":"array","items":{"title":"MediaPlaybackCommands","type":"string","enum":["pause","play","stop","fastForward","rewind"]}}},"additionalProperties":false,"required":[]},"enumCommands":[]},"playbackStatus":{"schema":{"type":"object","properties":{"value":{"type":"string","enum":["paused","playing","stopped","fast forwarding","rewinding"]}},"additionalProperties":false,"required":[]},"setter":"setPlaybackStatus","enumCommands":[{"command":"play","value":"playing"},{"command":"pause","value":"paused"},{"command":"stop","value":"stopped"},{"command":"fastForward","value":"fast forwarding"},{"command":"rewind","value":"rewinding"}]}},"commands":{"play":{"arguments":[]},"stop":{"arguments":[]},"rewind":{"arguments":[]},"fastForward":{"arguments":[]},"setPlaybackStatus":{"arguments":[{"name":"status","optional":false,"schema":{"type":"string","enum":["paused","playing","stopped","fast forwarding","rewinding"]}}]},"pause":{"arguments":[]}}},{"id":"mediaPlaybackRepeat","version":1,"status":"proposed","name":"Media Playback Repeat","attributes":{"playbackRepeatMode":{"schema":{"type":"object","properties":{"value":{"type":"string","enum":["all","off","one"]}},"additionalProperties":false,"required":["value"]},"setter":"setPlaybackRepeatMode","enumCommands":[]}},"commands":{"setPlaybackRepeatMode":{"arguments":[{"name":"mode","optional":false,"schema":{"type":"string","enum":["all","off","one"]}}]}}},{"id":"mediaPlaybackShuffle","version":1,"status":"proposed","name":"Media Playback Shuffle","attributes":{"playbackShuffle":{"schema":{"type":"object","properties":{"value":{"type":"string","enum":["disabled","enabled"]}},"additionalProperties":false,"required":["value"]},"setter":"setPlaybackShuffle","enumCommands":[]}},"commands":{"setPlaybackShuffle":{"arguments":[{"name":"shuffle","optional":false,"schema":{"type":"string","enum":["disabled","enabled"]}}]}}},{"id":"mediaPresets","version":1,"status":"proposed","name":"Media Presets","attributes":{"presets":{"schema":{"type":"object","properties":{"value":{"type":"array","items":{"title":"MediaPreset","type":"object","additionalProperties":false,"properties":{"id":{"type":"string"},"name":{"type":"string"},"mediaSource":{"type":"string"},"imageUrl":{"type":"string"}},"required":["id","name"]}}},"additionalProperties":false,"required":[]},"enumCommands":[]}},"commands":{"playPreset":{"arguments":[{"name":"presetId","optional":false,"schema":{"title":"String","type":"string","maxLength":255}}]}}},{"id":"mediaTrackControl","version":1,"status":"proposed","name":"Media Track Control","attributes":{"supportedTrackControlCommands":{"schema":{"type":"object","properties":{"value":{"type":"array","items":{"title":"MediaTrackCommands","type":"string","enum":["previousTrack","nextTrack"]}}},"additionalProperties":false,"required":[]},"enumCommands":[]}},"commands":{"previousTrack":{"arguments":[]},"nextTrack":{"arguments":[]}}},{"id":"moldHealthConcern","version":1,"status":"proposed","name":"Mold Health Concern","attributes":{"moldHealthConcern":{"schema":{"type":"object","properties":{"value":{"title":"AirQualityHealthConcern","type":"string","enum":["good","moderate","slightlyUnhealthy","unhealthy","veryUnhealthy","hazardous"]}},"additionalProperties":false,"required":["value"]},"enumCommands":[]}},"commands":{}},{"id":"momentary","version":1,"status":"live","name":"Momentary","attributes":{},"commands":{"push":{"arguments":[]}}},{"id":"motionSensor","version":1,"status":"live","name":"Motion Sensor","attributes":{"motion":{"schema":{"type":"object","properties":{"value":{"title":"ActivityState","type":"string","enum":["active","inactive"]}},"additionalProperties":false,"required":["value"]},"enumCommands":[]}},"commands":{}},{"id":"musicPlayer","version":1,"status":"deprecated","name":"Music Player","attributes":{"trackDescription":{"schema":{"type":"object","properties":{"value":{"title":"String","type":"string","maxLength":255}},"additionalProperties":false,"required":[]},"enumCommands":[]},"level":{"schema":{"type":"object","properties":{"value":{"title":"PositiveInteger","type":"integer","minimum":0}},"additionalProperties":false,"required":[]},"setter":"setLevel","enumCommands":[]},"mute":{"schema":{"type":"object","properties":{"value":{"title":"MuteState","type":"string","enum":["muted","unmuted"]}},"additionalProperties":false,"required":[]},"enumCommands":[{"command":"mute","value":"muted"},{"command":"unmute","value":"unmuted"}]},"trackData":{"schema":{"type":"object","properties":{"value":{"title":"JsonObject","type":"object"}},"additionalProperties":false,"required":[]},"enumCommands":[]},"status":{"schema":{"type":"object","properties":{"value":{"title":"String","type":"string","maxLength":255}},"additionalProperties":false,"required":[]},"enumCommands":[]}},"commands":{"play":{"arguments":[]},"restoreTrack":{"arguments":[{"name":"trackToRestore","optional":false,"schema":{"title":"String","type":"string","maxLength":255}}]},"resumeTrack":{"arguments":[{"name":"trackToResume","optional":false,"schema":{"title":"String","type":"string","maxLength":255}}]},"stop":{"arguments":[]},"previousTrack":{"arguments":[]},"nextTrack":{"arguments":[]},"mute":{"arguments":[]},"setTrack":{"arguments":[{"name":"trackToSet","optional":false,"schema":{"title":"String","type":"string","maxLength":255}}]},"unmute":{"arguments":[]},"playTrack":{"arguments":[{"name":"trackToPlay","optional":false,"schema":{"title":"String","type":"string","maxLength":255}}]},"pause":{"arguments":[]},"setLevel":{"arguments":[{"name":"level","optional":false,"schema":{"title":"PositiveInteger","type":"integer","minimum":0}}]}}},{"id":"networkMeter","version":1,"status":"live","name":"Network Meter","attributes":{"uplinkSpeed":{"schema":{"type":"object","properties":{"value":{"title":"PositiveInteger","type":"integer","minimum":0}},"additionalProperties":false,"required":["value"]},"enumCommands":[]},"downlinkSpeed":{"schema":{"type":"object","properties":{"value":{"title":"PositiveInteger","type":"integer","minimum":0}},"additionalProperties":false,"required":["value"]},"enumCommands":[]}},"commands":{}},{"id":"notification","version":1,"status":"live","name":"Notification","attributes":{},"commands":{"deviceNotification":{"arguments":[{"name":"notification","optional":false,"schema":{"title":"String","type":"string","maxLength":255}}]}}},{"id":"objectDetection","version":1,"status":"live","name":"Object Detection","attributes":{"detected":{"schema":{"type":"object","properties":{"value":{"title":"ObjectDetectionValue","type":"object","additionalProperties":false,"properties":{"value":{"title":"String","type":"string","maxLength":255},"qty":{"title":"PositiveInteger","type":"integer","minimum":0},"data":{"title":"JsonObject","type":"object"}},"required":["value"]}},"additionalProperties":false,"required":["value"]},"enumCommands":[]},"supportedValues":{"schema":{"type":"object","properties":{"value":{"type":"array","items":{"title":"String","type":"string","maxLength":255}}},"additionalProperties":false,"required":[]},"enumCommands":[]}},"commands":{}},{"id":"occupancySensor","version":1,"status":"proposed","name":"Occupancy Sensor","attributes":{"occupancy":{"schema":{"type":"object","properties":{"value":{"title":"OccupancyState","type":"string","enum":["occupied","unoccupied"]}},"additionalProperties":false,"required":["value"]},"enumCommands":[]}},"commands":{}},{"id":"ocf","version":1,"status":"proposed","name":"Ocf","attributes":{"st":{"schema":{"title":"StringAttribute","type":"object","properties":{"value":{"title":"String","type":"string","maxLength":255}},"additionalProperties":false,"required":["value"]},"enumCommands":[]},"mndt":{"schema":{"title":"StringAttribute","type":"object","properties":{"value":{"title":"String","type":"string","maxLength":255}},"additionalProperties":false,"required":["value"]},"enumCommands":[]},"mnfv":{"schema":{"title":"StringAttribute","type":"object","properties":{"value":{"title":"String","type":"string","maxLength":255}},"additionalProperties":false,"required":["value"]},"enumCommands":[]},"mnhw":{"schema":{"title":"StringAttribute","type":"object","properties":{"value":{"title":"String","type":"string","maxLength":255}},"additionalProperties":false,"required":["value"]},"enumCommands":[]},"di":{"schema":{"title":"StringAttribute","type":"object","properties":{"value":{"title":"String","type":"string","maxLength":255}},"additionalProperties":false,"required":["value"]},"enumCommands":[]},"mnsl":{"schema":{"title":"StringAttribute","type":"object","properties":{"value":{"title":"String","type":"string","maxLength":255}},"additionalProperties":false,"required":["value"]},"enumCommands":[]},"dmv":{"schema":{"title":"StringAttribute","type":"object","properties":{"value":{"title":"String","type":"string","maxLength":255}},"additionalProperties":false,"required":["value"]},"enumCommands":[]},"n":{"schema":{"title":"StringAttribute","type":"object","properties":{"value":{"title":"String","type":"string","maxLength":255}},"additionalProperties":false,"required":["value"]},"enumCommands":[]},"mnmo":{"schema":{"title":"StringAttribute","type":"object","properties":{"value":{"title":"String","type":"string","maxLength":255}},"additionalProperties":false,"required":["value"]},"enumCommands":[]},"vid":{"schema":{"title":"StringAttribute","type":"object","properties":{"value":{"title":"String","type":"string","maxLength":255}},"additionalProperties":false,"required":["value"]},"enumCommands":[]},"mnmn":{"schema":{"title":"StringAttribute","type":"object","properties":{"value":{"title":"String","type":"string","maxLength":255}},"additionalProperties":false,"required":["value"]},"enumCommands":[]},"mnml":{"schema":{"title":"StringAttribute","type":"object","properties":{"value":{"title":"String","type":"string","maxLength":255}},"additionalProperties":false,"required":["value"]},"enumCommands":[]},"mnpv":{"schema":{"title":"StringAttribute","type":"object","properties":{"value":{"title":"String","type":"string","maxLength":255}},"additionalProperties":false,"required":["value"]},"enumCommands":[]},"mnos":{"schema":{"title":"StringAttribute","type":"object","properties":{"value":{"title":"String","type":"string","maxLength":255}},"additionalProperties":false,"required":["value"]},"enumCommands":[]},"pi":{"schema":{"title":"StringAttribute","type":"object","properties":{"value":{"title":"String","type":"string","maxLength":255}},"additionalProperties":false,"required":["value"]},"enumCommands":[]},"icv":{"schema":{"title":"StringAttribute","type":"object","properties":{"value":{"title":"String","type":"string","maxLength":255}},"additionalProperties":false,"required":["value"]},"enumCommands":[]}},"commands":{"postOcfCommand":{"arguments":[{"name":"href","optional":false,"schema":{"title":"String","type":"string","maxLength":255}},{"name":"value","optional":false,"schema":{"title":"JsonObject","type":"object"}}]}}},{"id":"odorSensor","version":1,"status":"proposed","name":"Odor Sensor","attributes":{"odorLevel":{"schema":{"type":"object","properties":{"value":{"title":"PositiveInteger","type":"integer","minimum":0}},"additionalProperties":false,"required":["value"]},"enumCommands":[]}},"commands":{}},{"id":"outlet","version":1,"status":"deprecated","name":"Outlet","attributes":{"switch":{"schema":{"type":"object","properties":{"value":{"title":"SwitchState","type":"string","enum":["on","off"]}},"additionalProperties":false,"required":["value"]},"enumCommands":[{"command":"on","value":"on"},{"command":"off","value":"off"}]}},"commands":{"off":{"arguments":[]},"on":{"arguments":[]}}},{"id":"ovenMode","version":1,"status":"proposed","name":"Oven Mode","attributes":{"supportedOvenModes":{"schema":{"type":"object","properties":{"value":{"type":"array","items":{"title":"OvenMode","type":"string","enum":["heating","grill","warming","defrosting","Conventional","Bake","BottomHeat","ConvectionBake","ConvectionRoast","Broil","ConvectionBroil","SteamCook","SteamBake","SteamRoast","SteamBottomHeatplusConvection","Microwave","MWplusGrill","MWplusConvection","MWplusHotBlast","MWplusHotBlast2","SlimMiddle","SlimStrong","SlowCook","Proof","Dehydrate","Others"]}}},"additionalProperties":false,"required":[]},"enumCommands":[]},"ovenMode":{"schema":{"type":"object","properties":{"value":{"title":"OvenMode","type":"string","enum":["heating","grill","warming","defrosting","Conventional","Bake","BottomHeat","ConvectionBake","ConvectionRoast","Broil","ConvectionBroil","SteamCook","SteamBake","SteamRoast","SteamBottomHeatplusConvection","Microwave","MWplusGrill","MWplusConvection","MWplusHotBlast","MWplusHotBlast2","SlimMiddle","SlimStrong","SlowCook","Proof","Dehydrate","Others"]}},"additionalProperties":false,"required":["value"]},"setter":"setOvenMode","enumCommands":[]}},"commands":{"setOvenMode":{"arguments":[{"name":"mode","optional":false,"schema":{"title":"OvenMode","type":"string","enum":["heating","grill","warming","defrosting","Conventional","Bake","BottomHeat","ConvectionBake","ConvectionRoast","Broil","ConvectionBroil","SteamCook","SteamBake","SteamRoast","SteamBottomHeatplusConvection","Microwave","MWplusGrill","MWplusConvection","MWplusHotBlast","MWplusHotBlast2","SlimMiddle","SlimStrong","SlowCook","Proof","Dehydrate","Others"]}}]}}},{"id":"ovenOperatingState","version":1,"status":"proposed","name":"Oven Operating State","attributes":{"completionTime":{"schema":{"type":"object","properties":{"value":{"title":"Iso8601Date","type":"string","pattern":"^(?:[1-9]\\d{3}-?(?:(?:0[1-9]|1[0-2])-?(?:0[1-9]|1\\d|2[0-8])|(?:0[13-9]|1[0-2])-?(?:29|30)|(?:0[13578]|1[02])-?31)|(?:[1-9]\\d(?:0[48]|[2468][048]|[13579][26])|(?:[2468][048]|[13579][26])00)-?02-?29)T(?:[01]\\d|2[0-3]):?[0-5]\\d:?[0-5]\\d(?:\\.\\d{3})?(?:Z|[+-][01]\\d(?::?[0-5]\\d)?)$"}},"additionalProperties":false,"required":["value"]},"enumCommands":[]},"machineState":{"schema":{"type":"object","properties":{"value":{"type":"string","enum":["ready","running","paused"]}},"additionalProperties":false,"required":[]},"setter":"setMachineState","enumCommands":[]},"progress":{"schema":{"title":"IntegerPercent","type":"object","properties":{"value":{"type":"integer","minimum":0,"maximum":100},"unit":{"type":"string","enum":["%"],"default":"%"}},"additionalProperties":false,"required":["value"]},"enumCommands":[]},"supportedMachineStates":{"schema":{"type":"object","properties":{"value":{"type":"array","items":{"type":"string","enum":["ready","running","paused"]}}},"additionalProperties":false,"required":[]},"enumCommands":[]},"ovenJobState":{"schema":{"type":"object","properties":{"value":{"type":"string","enum":["cleaning","cooking","cooling","draining","preheat","ready","rinsing"]}},"additionalProperties":false,"required":[]},"enumCommands":[]},"operationTime":{"schema":{"type":"object","properties":{"value":{"title":"PositiveInteger","type":"integer","minimum":0}},"additionalProperties":false,"required":[]},"enumCommands":[]}},"commands":{"stop":{"arguments":[]},"setMachineState":{"arguments":[{"name":"state","optional":false,"schema":{"type":"string","enum":["stop"]}}]},"start":{"arguments":[{"name":"mode","optional":true,"schema":{"title":"OvenMode","type":"string","enum":["heating","grill","warming","defrosting","Conventional","Bake","BottomHeat","ConvectionBake","ConvectionRoast","Broil","ConvectionBroil","SteamCook","SteamBake","SteamRoast","SteamBottomHeatplusConvection","Microwave","MWplusGrill","MWplusConvection","MWplusHotBlast","MWplusHotBlast2","SlimMiddle","SlimStrong","SlowCook","Proof","Dehydrate","Others"]}},{"name":"time","optional":true,"schema":{"title":"PositiveInteger","type":"integer","minimum":0}},{"name":"setpoint","optional":true,"schema":{"title":"PositiveInteger","type":"integer","minimum":0}}]}}},{"id":"ovenOperationalState","version":1,"status":"deprecated","name":"Oven Operational State","attributes":{"completionTime":{"schema":{"type":"object","properties":{"value":{"title":"Iso8601Date","type":"string","pattern":"^(?:[1-9]\\d{3}-?(?:(?:0[1-9]|1[0-2])-?(?:0[1-9]|1\\d|2[0-8])|(?:0[13-9]|1[0-2])-?(?:29|30)|(?:0[13578]|1[02])-?31)|(?:[1-9]\\d(?:0[48]|[2468][048]|[13579][26])|(?:[2468][048]|[13579][26])00)-?02-?29)T(?:[01]\\d|2[0-3]):?[0-5]\\d:?[0-5]\\d(?:\\.\\d{3})?(?:Z|[+-][01]\\d(?::?[0-5]\\d)?)$"}},"additionalProperties":false,"required":["value"]},"enumCommands":[]},"machineState":{"schema":{"type":"object","properties":{"value":{"type":"string","enum":["ready","running","paused"]}},"additionalProperties":false,"required":[]},"setter":"setMachineState","enumCommands":[]},"progress":{"schema":{"title":"IntegerPercent","type":"object","properties":{"value":{"type":"integer","minimum":0,"maximum":100},"unit":{"type":"string","enum":["%"],"default":"%"}},"additionalProperties":false,"required":["value"]},"enumCommands":[]},"supportedMachineStates":{"schema":{"type":"object","properties":{"value":{"type":"array","items":{"type":"string","enum":["ready","running","paused"]}}},"additionalProperties":false,"required":[]},"enumCommands":[]},"ovenJobState":{"schema":{"type":"object","properties":{"value":{"type":"string","enum":["cleaning","cooking","cooling","draining","preheat","ready","rinsing"]}},"additionalProperties":false,"required":[]},"enumCommands":[]},"operationTime":{"schema":{"type":"object","properties":{"value":{"title":"PositiveInteger","type":"integer","minimum":0}},"additionalProperties":false,"required":[]},"enumCommands":[]}},"commands":{"stop":{"arguments":[]},"setMachineState":{"arguments":[{"name":"state","optional":false,"schema":{"type":"string","enum":["stop"]}}]}}},{"id":"ovenSetpoint","version":1,"status":"proposed","name":"Oven Setpoint","attributes":{"ovenSetpoint":{"schema":{"type":"object","properties":{"value":{"title":"PositiveInteger","type":"integer","minimum":0}},"additionalProperties":false,"required":["value"]},"setter":"setOvenSetpoint","enumCommands":[]}},"commands":{"setOvenSetpoint":{"arguments":[{"name":"setpoint","optional":false,"schema":{"title":"PositiveInteger","type":"integer","minimum":0}}]}}},{"id":"pHMeasurement","version":1,"status":"live","name":"pH Measurement","attributes":{"pH":{"schema":{"type":"object","properties":{"value":{"type":"number","minimum":0,"maximum":14},"unit":{"type":"string","enum":["pH"],"default":"pH"}},"additionalProperties":false,"required":["value"]},"enumCommands":[]}},"commands":{}},{"id":"panicAlarm","version":1,"status":"live","name":"Panic Alarm","attributes":{"panicAlarm":{"schema":{"type":"object","properties":{"value":{"type":"string","enum":["panic","clear"]}},"additionalProperties":false,"required":["value"]},"enumCommands":[]}},"commands":{}},{"id":"pestControl","version":1,"status":"proposed","name":"Pest Control","attributes":{"pestControl":{"schema":{"type":"object","properties":{"value":{"type":"string","enum":["idle","trapArmed","trapRearmRequired","pestDetected","pestExterminated"]}},"additionalProperties":false,"required":["value"]},"enumCommands":[]}},"commands":{}},{"id":"polling","version":1,"status":"deprecated","name":"Polling","attributes":{},"commands":{"poll":{"arguments":[]}}},{"id":"powerConsumptionReport","version":1,"status":"proposed","name":"Power Consumption Report","attributes":{"powerConsumption":{"schema":{"type":"object","properties":{"value":{"title":"PowerConsumption","type":"object","additionalProperties":false,"properties":{"start":{"title":"Iso8601Date","type":"string","pattern":"^(?:[1-9]\\d{3}-?(?:(?:0[1-9]|1[0-2])-?(?:0[1-9]|1\\d|2[0-8])|(?:0[13-9]|1[0-2])-?(?:29|30)|(?:0[13578]|1[02])-?31)|(?:[1-9]\\d(?:0[48]|[2468][048]|[13579][26])|(?:[2468][048]|[13579][26])00)-?02-?29)T(?:[01]\\d|2[0-3]):?[0-5]\\d:?[0-5]\\d(?:\\.\\d{3})?(?:Z|[+-][01]\\d(?::?[0-5]\\d)?)$"},"end":{"title":"Iso8601Date","type":"string","pattern":"^(?:[1-9]\\d{3}-?(?:(?:0[1-9]|1[0-2])-?(?:0[1-9]|1\\d|2[0-8])|(?:0[13-9]|1[0-2])-?(?:29|30)|(?:0[13578]|1[02])-?31)|(?:[1-9]\\d(?:0[48]|[2468][048]|[13579][26])|(?:[2468][048]|[13579][26])00)-?02-?29)T(?:[01]\\d|2[0-3]):?[0-5]\\d:?[0-5]\\d(?:\\.\\d{3})?(?:Z|[+-][01]\\d(?::?[0-5]\\d)?)$"},"energy":{"type":"number"},"power":{"type":"number"},"deltaEnergy":{"type":"number"},"powerEnergy":{"type":"number"},"energySaved":{"type":"number"},"persistedEnergy":{"type":"number"}}}},"additionalProperties":false,"required":["value"]},"enumCommands":[]}},"commands":{}},{"id":"powerMeter","version":1,"status":"live","name":"Power Meter","attributes":{"power":{"schema":{"type":"object","properties":{"value":{"type":"number"},"unit":{"type":"string","enum":["W"],"default":"W"}},"additionalProperties":false,"required":["value"]},"enumCommands":[]}},"commands":{}},{"id":"powerSource","version":1,"status":"live","name":"Power Source","attributes":{"powerSource":{"schema":{"type":"object","properties":{"value":{"type":"string","enum":["battery","dc","mains","unknown"]}},"additionalProperties":false,"required":["value"]},"enumCommands":[]}},"commands":{}},{"id":"precipitationMeasurement","version":1,"status":"proposed","name":"Precipitation Measurement","attributes":{"precipitationLevel":{"schema":{"type":"object","properties":{"value":{"title":"PositiveNumber","type":"number","minimum":0},"unit":{"type":"string","enum":["mm","in"]}},"additionalProperties":false,"required":["value","unit"]},"enumCommands":[]}},"commands":{"resetPrecipitationLevel":{"arguments":[]}}},{"id":"precipitationRate","version":1,"status":"proposed","name":"Precipitation Rate","attributes":{"precipitationRate":{"schema":{"type":"object","properties":{"value":{"title":"PositiveNumber","type":"number","minimum":0},"unit":{"type":"string","enum":["mm/h","in/h"]}},"additionalProperties":false,"required":["value","unit"]},"enumCommands":[]}},"commands":{}},{"id":"precipitationSensor","version":1,"status":"proposed","name":"Precipitation Sensor","attributes":{"precipitationIntensity":{"schema":{"type":"object","properties":{"value":{"type":"string","enum":["none","possiblePrecipitation","light","moderate","heavy","violent"]}},"additionalProperties":false,"required":["value"]},"enumCommands":[]}},"commands":{}},{"id":"presenceSensor","version":1,"status":"live","name":"Presence Sensor","attributes":{"presence":{"schema":{"type":"object","properties":{"value":{"title":"PresenceState","type":"string","enum":["present","not present"]}},"additionalProperties":false,"required":["value"]},"enumCommands":[]}},"commands":{}},{"id":"radonHealthConcern","version":1,"status":"proposed","name":"Radon Health Concern","attributes":{"radonHealthConcern":{"schema":{"type":"object","properties":{"value":{"title":"AirQualityHealthConcern","type":"string","enum":["good","moderate","slightlyUnhealthy","unhealthy","veryUnhealthy","hazardous"]}},"additionalProperties":false,"required":["value"]},"enumCommands":[]}},"commands":{}},{"id":"radonMeasurement","version":1,"status":"proposed","name":"Radon Measurement","attributes":{"radonLevel":{"schema":{"type":"object","properties":{"value":{"type":"number"},"unit":{"type":"string","enum":["pCi/L"],"default":"pCi/L"}},"additionalProperties":false,"required":["value","unit"]},"enumCommands":[]}},"commands":{}},{"id":"rapidCooling","version":1,"status":"proposed","name":"Rapid Cooling","attributes":{"rapidCooling":{"schema":{"type":"object","properties":{"value":{"type":"string","enum":["off","on"]}},"additionalProperties":false,"required":["value"]},"setter":"setRapidCooling","enumCommands":[]}},"commands":{"setRapidCooling":{"arguments":[{"name":"rapidCooling","optional":false,"schema":{"type":"string","enum":["off","on"]}}]}}},{"id":"refresh","version":1,"status":"live","name":"Refresh","attributes":{},"commands":{"refresh":{"arguments":[]}}},{"id":"refrigeration","version":1,"status":"live","name":"Refrigeration","attributes":{"defrost":{"schema":{"type":"object","properties":{"value":{"type":"string","enum":["off","on"]}},"additionalProperties":false,"required":[]},"setter":"setDefrost","enumCommands":[]},"rapidCooling":{"schema":{"type":"object","properties":{"value":{"type":"string","enum":["off","on"]}},"additionalProperties":false,"required":[]},"setter":"setRapidCooling","enumCommands":[]},"rapidFreezing":{"schema":{"type":"object","properties":{"value":{"type":"string","enum":["off","on"]}},"additionalProperties":false,"required":[]},"setter":"setRapidFreezing","enumCommands":[]}},"commands":{"setDefrost":{"arguments":[{"name":"rapidCooling","optional":false,"schema":{"type":"string","enum":["off","on"]}}]},"setRapidFreezing":{"arguments":[{"name":"rapidCooling","optional":false,"schema":{"type":"string","enum":["off","on"]}}]},"setRapidCooling":{"arguments":[{"name":"rapidCooling","optional":false,"schema":{"type":"string","enum":["off","on"]}}]}}},{"id":"refrigerationSetpoint","version":1,"status":"proposed","name":"Refrigeration Setpoint","attributes":{"refrigerationSetpoint":{"schema":{"title":"Temperature","type":"object","properties":{"value":{"title":"TemperatureValue","type":"number","minimum":-460,"maximum":10000},"unit":{"type":"string","enum":["F","C"]}},"additionalProperties":false,"required":["value","unit"]},"setter":"setRefrigerationSetpoint","enumCommands":[]}},"commands":{"setRefrigerationSetpoint":{"arguments":[{"name":"setpoint","optional":false,"schema":{"title":"TemperatureValue","type":"number","minimum":-460,"maximum":10000}}]}}},{"id":"relativeBrightness","version":1,"status":"proposed","name":"Relative Brightness","attributes":{"brightnessIntensity":{"schema":{"type":"object","properties":{"value":{"type":"integer","minimum":0,"maximum":7},"unit":{"type":"string","enum":["level"]}},"additionalProperties":false,"required":["value","unit"]},"enumCommands":[]}},"commands":{}},{"id":"relativeHumidityMeasurement","version":1,"status":"live","name":"Relative Humidity Measurement","attributes":{"humidity":{"schema":{"title":"Percent","type":"object","properties":{"value":{"type":"number","minimum":0,"maximum":100},"unit":{"type":"string","enum":["%"],"default":"%"}},"additionalProperties":false,"required":["value"]},"enumCommands":[]}},"commands":{}},{"id":"relaySwitch","version":1,"status":"deprecated","name":"Relay Switch","attributes":{"switch":{"schema":{"type":"object","properties":{"value":{"title":"SwitchState","type":"string","enum":["on","off"]}},"additionalProperties":false,"required":["value"]},"enumCommands":[{"command":"on","value":"on"},{"command":"off","value":"off"}]}},"commands":{"off":{"arguments":[]},"on":{"arguments":[]}}},{"id":"remoteControlStatus","version":1,"status":"live","name":"Remote Control Status","attributes":{"remoteControlEnabled":{"schema":{"type":"object","properties":{"value":{"type":"string","enum":["false","true"]}},"additionalProperties":false,"required":["value"]},"enumCommands":[]}},"commands":{}},{"id":"robotCleanerCleaningMode","version":1,"status":"proposed","name":"Robot Cleaner Cleaning Mode","attributes":{"robotCleanerCleaningMode":{"schema":{"type":"object","properties":{"value":{"type":"string","enum":["auto","part","repeat","manual","stop","map"]}},"additionalProperties":false,"required":["value"]},"setter":"setRobotCleanerCleaningMode","enumCommands":[]}},"commands":{"setRobotCleanerCleaningMode":{"arguments":[{"name":"mode","optional":false,"schema":{"type":"string","enum":["auto","part","repeat","manual","stop"]}}]}}},{"id":"robotCleanerMovement","version":1,"status":"proposed","name":"Robot Cleaner Movement","attributes":{"robotCleanerMovement":{"schema":{"type":"object","properties":{"value":{"type":"string","enum":["homing","idle","charging","alarm","powerOff","reserve","point","after","cleaning","pause"]}},"additionalProperties":false,"required":["value"]},"setter":"setRobotCleanerMovement","enumCommands":[]}},"commands":{"setRobotCleanerMovement":{"arguments":[{"name":"mode","optional":false,"schema":{"type":"string","enum":["homing","idle","charging","alarm","powerOff","reserve","point","after","cleaning","pause"]}}]}}},{"id":"robotCleanerState","version":1,"status":"deprecated","name":"Robot Cleaner State","attributes":{"robotCleanerTurboState":{"schema":{"type":"object","properties":{"value":{"type":"string","enum":["turboOff","turboOn","turboSilence"]}},"additionalProperties":false,"required":[]},"setter":"setRobotCleanerTurboState","enumCommands":[]},"robotCleanerCleaningState":{"schema":{"type":"object","properties":{"value":{"type":"string","enum":["cleaningAuto","cleaningManual","cleaningPart","cleaningRepeat","cleaningStop"]}},"additionalProperties":false,"required":[]},"setter":"setRobotCleanerCleaningState","enumCommands":[]},"supportedRobotCleanerStates":{"schema":{"type":"object","properties":{"value":{"type":"array","items":{"type":"string","enum":["cleaningAuto","cleaningManual","cleaningPart","cleaningRepeat","cleaningStop"]}}},"additionalProperties":false,"required":[]},"enumCommands":[]},"robotCleanerControlState":{"schema":{"type":"object","properties":{"value":{"type":"string","enum":["controlAfter","controlAlarm","controlCharging","controlCleaning","controlHoming","controlIdle","controlPause","controlPoint","controlPowerOff","controlReserve"]}},"additionalProperties":false,"required":[]},"setter":"setRobotCleanerControlState","enumCommands":[]}},"commands":{"setRobotCleanerCleaningState":{"arguments":[{"name":"state","optional":false,"schema":{"type":"string","enum":["cleaningAuto","cleaningStop"]}}]},"stop":{"arguments":[]},"setRobotCleanerControlState":{"arguments":[{"name":"state","optional":false,"schema":{"type":"string","enum":["controlHoming"]}}]},"setRobotCleanerTurboState":{"arguments":[{"name":"state","optional":false,"schema":{"type":"string","enum":["turboOff","turboOn","turboSilence"]}}]}}},{"id":"robotCleanerTurboMode","version":1,"status":"proposed","name":"Robot Cleaner Turbo Mode","attributes":{"robotCleanerTurboMode":{"schema":{"type":"object","properties":{"value":{"type":"string","enum":["on","off","silence"]}},"additionalProperties":false,"required":["value"]},"setter":"setRobotCleanerTurboMode","enumCommands":[]}},"commands":{"setRobotCleanerTurboMode":{"arguments":[{"name":"mode","optional":false,"schema":{"type":"string","enum":["on","off","silence"]}}]}}},{"id":"samsungTV","version":1,"status":"live","name":"Samsung TV","attributes":{"volume":{"schema":{"type":"object","properties":{"value":{"title":"PositiveInteger","type":"integer","minimum":0}},"additionalProperties":false,"required":[]},"setter":"setVolume","enumCommands":[]},"pictureMode":{"schema":{"type":"object","properties":{"value":{"type":"string","enum":["dynamic","movie","standard","unknown"]}},"additionalProperties":false,"required":[]},"setter":"setPictureMode","enumCommands":[]},"messageButton":{"schema":{"type":"object","properties":{"value":{"title":"JsonObject","type":"object"}},"additionalProperties":false,"required":[]},"enumCommands":[]},"soundMode":{"schema":{"type":"object","properties":{"value":{"type":"string","enum":["clear voice","movie","music","standard","unknown"]}},"additionalProperties":false,"required":[]},"setter":"setSoundMode","enumCommands":[]},"mute":{"schema":{"type":"object","properties":{"value":{"type":"string","enum":["muted","unknown","unmuted"]}},"additionalProperties":false,"required":[]},"enumCommands":[{"command":"mute","value":"muted"},{"command":"unmute","value":"unmuted"}]},"switch":{"schema":{"type":"object","properties":{"value":{"title":"SwitchState","type":"string","enum":["on","off"]}},"additionalProperties":false,"required":[]},"enumCommands":[{"command":"on","value":"on"},{"command":"off","value":"off"}]}},"commands":{"setPictureMode":{"arguments":[{"name":"pictureMode","optional":false,"schema":{"type":"string","enum":["dynamic","movie","standard"]}}]},"volumeDown":{"arguments":[]},"setSoundMode":{"arguments":[{"name":"soundMode","optional":false,"schema":{"type":"string","enum":["clear voice","movie","music","standard"]}}]},"showMessage":{"arguments":[{"name":"1","optional":false,"schema":{"title":"String","type":"string","maxLength":255}},{"name":"2","optional":false,"schema":{"title":"String","type":"string","maxLength":255}},{"name":"3","optional":false,"schema":{"title":"String","type":"string","maxLength":255}},{"name":"4","optional":false,"schema":{"title":"String","type":"string","maxLength":255}}]},"volumeUp":{"arguments":[]},"mute":{"arguments":[]},"unmute":{"arguments":[]},"setVolume":{"arguments":[{"name":"volume","optional":false,"schema":{"title":"PositiveInteger","type":"integer","minimum":0}}]},"off":{"arguments":[]},"on":{"arguments":[]}}},{"id":"scent","version":1,"status":"proposed","name":"Scent","attributes":{"scentName":{"schema":{"type":"object","properties":{"value":{"title":"String","type":"string","maxLength":255}},"additionalProperties":false,"required":[]},"enumCommands":[]},"scentIntensity":{"schema":{"title":"IntegerPercent","type":"object","properties":{"value":{"type":"integer","minimum":0,"maximum":100},"unit":{"type":"string","enum":["%"],"default":"%"}},"additionalProperties":false,"required":["value"]},"setter":"setScentIntensity","enumCommands":[]}},"commands":{"setScentIntensity":{"arguments":[{"name":"intensity","optional":false,"schema":{"type":"integer","minimum":0,"maximum":100}}]}}},{"id":"securitySystem","version":1,"status":"live","name":"Security System","attributes":{"alarm":{"schema":{"type":"object","properties":{"value":{"title":"String","type":"string","maxLength":255}},"additionalProperties":false,"required":["value"]},"enumCommands":[]},"securitySystemStatus":{"schema":{"type":"object","properties":{"value":{"type":"string","enum":["armedAway","armedStay","disarmed"]}},"additionalProperties":false,"required":["value"]},"enumCommands":[{"command":"armStay","value":"armedStay"},{"command":"armAway","value":"armedAway"},{"command":"disarm","value":"disarmed"}]}},"commands":{"armStay":{"arguments":[{"name":"bypassAll","optional":false,"schema":{"type":"boolean"}}]},"disarm":{"arguments":[]},"armAway":{"arguments":[{"name":"bypassAll","optional":false,"schema":{"type":"boolean"}}]}}},{"id":"sensor","version":1,"status":"deprecated","name":"Sensor","attributes":{},"commands":{}},{"id":"shockSensor","version":1,"status":"deprecated","name":"Shock Sensor","attributes":{"shock":{"schema":{"type":"object","properties":{"value":{"type":"string","enum":["clear","detected"]}},"additionalProperties":false,"required":["value"]},"enumCommands":[]}},"commands":{}},{"id":"signalStrength","version":1,"status":"live","name":"Signal Strength","attributes":{"rssi":{"schema":{"type":"object","properties":{"value":{"type":"number","minimum":-200,"maximum":0},"unit":{"type":"string","enum":["dBm"],"default":"dBm"}},"additionalProperties":false,"required":["value"]},"enumCommands":[]},"lqi":{"schema":{"type":"object","properties":{"value":{"type":"integer","minimum":0,"maximum":255}},"additionalProperties":false,"required":["value"]},"enumCommands":[]}},"commands":{}},{"id":"sleepSensor","version":1,"status":"live","name":"Sleep Sensor","attributes":{"sleeping":{"schema":{"type":"object","properties":{"value":{"type":"string","enum":["not sleeping","sleeping"]}},"additionalProperties":false,"required":["value"]},"enumCommands":[]}},"commands":{}},{"id":"smokeDetector","version":1,"status":"live","name":"Smoke Detector","attributes":{"smoke":{"schema":{"type":"object","properties":{"value":{"type":"string","enum":["clear","detected","tested"]}},"additionalProperties":false,"required":["value"]},"enumCommands":[]}},"commands":{}},{"id":"soundDetection","version":1,"status":"proposed","name":"Sound Detection","attributes":{"soundDetectionState":{"schema":{"type":"object","properties":{"value":{"title":"EnableState","type":"string","enum":["enabled","disabled"]}},"additionalProperties":false,"required":["value"]},"enumCommands":[{"command":"enableSoundDetection","value":"enabled"},{"command":"disableSoundDetection","value":"disabled"}]},"supportedSoundTypes":{"schema":{"type":"object","properties":{"value":{"type":"array","items":{"title":"DetectedSoundType","type":"string","enum":["noSound","babyCrying","glassBreaking","fireAlarm","dogBarking","catMeowing","doorKnocking"]}}},"additionalProperties":false,"required":["value"]},"enumCommands":[]},"soundDetected":{"schema":{"type":"object","properties":{"value":{"title":"DetectedSoundType","type":"string","enum":["noSound","babyCrying","glassBreaking","fireAlarm","dogBarking","catMeowing","doorKnocking"]}},"additionalProperties":false,"required":["value"]},"enumCommands":[]}},"commands":{"disableSoundDetection":{"arguments":[]},"enableSoundDetection":{"arguments":[]}}},{"id":"soundPressureLevel","version":1,"status":"live","name":"Sound Pressure Level","attributes":{"soundPressureLevel":{"schema":{"type":"object","properties":{"value":{"type":"number","minimum":0,"maximum":194},"unit":{"type":"string","enum":["dB"],"default":"dB"}},"additionalProperties":false,"required":["value"]},"enumCommands":[]}},"commands":{}},{"id":"soundSensor","version":1,"status":"live","name":"Sound Sensor","attributes":{"sound":{"schema":{"type":"object","properties":{"value":{"type":"string","enum":["detected","not detected"]}},"additionalProperties":false,"required":["value"]},"enumCommands":[]}},"commands":{}},{"id":"speechRecognition","version":1,"status":"proposed","name":"Speech Recognition","attributes":{"phraseSpoken":{"schema":{"type":"object","properties":{"value":{"type":"string","maxLength":1000}},"additionalProperties":false,"required":["value"]},"enumCommands":[]}},"commands":{}},{"id":"speechSynthesis","version":1,"status":"proposed","name":"Speech Synthesis","attributes":{},"commands":{"speak":{"arguments":[{"name":"phrase","optional":false,"schema":{"type":"string","maxLength":1000}}]}}},{"id":"statelessAirCleanerModeButton","version":1,"status":"proposed","name":"Stateless Air Cleaner Mode Button","attributes":{"availableAirCleanerModeButtons":{"schema":{"type":"object","properties":{"value":{"type":"array","items":{"type":"string","enum":["changeMode"]}}},"additionalProperties":false,"required":[]},"enumCommands":[]}},"commands":{"setButton":{"arguments":[{"name":"button","optional":false,"schema":{"type":"string","enum":["changeMode"]}}]}}},{"id":"statelessAudioMuteButton","version":1,"status":"live","name":"Stateless Audio Mute Button","attributes":{"availableAudioMuteButtons":{"schema":{"type":"object","properties":{"value":{"type":"array","items":{"type":"string","enum":["muteToggle"]}}},"additionalProperties":false,"required":[]},"enumCommands":[]}},"commands":{"setButton":{"arguments":[{"name":"button","optional":false,"schema":{"type":"string","enum":["muteToggle"]}}]}}},{"id":"statelessAudioVolumeButton","version":1,"status":"live","name":"Stateless Audio Volume Button","attributes":{"availableAudioVolumeButtons":{"schema":{"type":"object","properties":{"value":{"type":"array","items":{"type":"string","enum":["volumeUp","volumeDown"]}}},"additionalProperties":false,"required":[]},"enumCommands":[]}},"commands":{"setButton":{"arguments":[{"name":"button","optional":false,"schema":{"type":"string","enum":["volumeUp","volumeDown"]}}]}}},{"id":"statelessChannelButton","version":1,"status":"live","name":"Stateless Channel Button","attributes":{"availableChannelButtons":{"schema":{"type":"object","properties":{"value":{"type":"array","items":{"type":"string","enum":["channelUp","channelDown"]}}},"additionalProperties":false,"required":[]},"enumCommands":[]}},"commands":{"setButton":{"arguments":[{"name":"button","optional":false,"schema":{"type":"string","enum":["channelUp","channelDown"]}}]}}},{"id":"statelessCurtainPowerButton","version":1,"status":"proposed","name":"Stateless Curtain Power Button","attributes":{"availableCurtainPowerButtons":{"schema":{"type":"object","properties":{"value":{"type":"array","items":{"type":"string","enum":["open","close","pause"]}}},"additionalProperties":false,"required":[]},"enumCommands":[]}},"commands":{"setButton":{"arguments":[{"name":"button","optional":false,"schema":{"type":"string","enum":["open","close","pause"]}}]}}},{"id":"statelessCustomButton","version":1,"status":"live","name":"Stateless Custom Button","attributes":{"availableCustomButtons":{"schema":{"type":"object","properties":{"value":{"type":"array","items":{"type":"string"}}},"additionalProperties":false,"required":[]},"enumCommands":[]}},"commands":{"setButton":{"arguments":[{"name":"button","optional":false,"schema":{"type":"string"}}]}}},{"id":"statelessFanspeedButton","version":1,"status":"live","name":"Stateless Fanspeed Button","attributes":{"availableFanspeedButtons":{"schema":{"type":"object","properties":{"value":{"type":"array","items":{"type":"string","enum":["fanspeedUp","fanspeedDown"]}}},"additionalProperties":false,"required":[]},"enumCommands":[]}},"commands":{"setButton":{"arguments":[{"name":"button","optional":false,"schema":{"type":"string","enum":["fanspeedUp","fanspeedDown"]}}]}}},{"id":"statelessFanspeedModeButton","version":1,"status":"proposed","name":"Stateless Fanspeed Mode Button","attributes":{"availableFanspeedModeButtons":{"schema":{"type":"object","properties":{"value":{"type":"array","items":{"type":"string","enum":["changeMode"]}}},"additionalProperties":false,"required":[]},"enumCommands":[]}},"commands":{"setButton":{"arguments":[{"name":"button","optional":false,"schema":{"type":"string","enum":["changeMode"]}}]}}},{"id":"statelessHumidifierModeButton","version":1,"status":"proposed","name":"Stateless Humidifier Mode Button","attributes":{"availableHumidifierModeButtons":{"schema":{"type":"object","properties":{"value":{"type":"array","items":{"type":"string","enum":["changeMode"]}}},"additionalProperties":false,"required":[]},"enumCommands":[]}},"commands":{"setButton":{"arguments":[{"name":"button","optional":false,"schema":{"type":"string","enum":["changeMode"]}}]}}},{"id":"statelessMediaPlaybackButton","version":1,"status":"proposed","name":"Stateless Media Playback Button","attributes":{"availableMediaPlaybackButtons":{"schema":{"type":"object","properties":{"value":{"type":"array","items":{"title":"MediaPlaybackCommands","type":"string","enum":["pause","play","stop","fastForward","rewind"]}}},"additionalProperties":false,"required":[]},"enumCommands":[]}},"commands":{"setButton":{"arguments":[{"name":"button","optional":false,"schema":{"title":"MediaPlaybackCommands","type":"string","enum":["pause","play","stop","fastForward","rewind"]}}]}}},{"id":"statelessPowerButton","version":1,"status":"live","name":"Stateless Power Button","attributes":{"availablePowerButtons":{"schema":{"type":"object","properties":{"value":{"type":"array","items":{"type":"string","enum":["powerOn","powerOff"]}}},"additionalProperties":false,"required":[]},"enumCommands":[]}},"commands":{"setButton":{"arguments":[{"name":"button","optional":false,"schema":{"type":"string","enum":["powerOn","powerOff"]}}]}}},{"id":"statelessPowerToggleButton","version":1,"status":"live","name":"Stateless Power Toggle Button","attributes":{"availablePowerToggleButtons":{"schema":{"type":"object","properties":{"value":{"type":"array","items":{"type":"string","enum":["powerToggle"]}}},"additionalProperties":false,"required":[]},"enumCommands":[]}},"commands":{"setButton":{"arguments":[{"name":"button","optional":false,"schema":{"type":"string","enum":["powerToggle"]}}]}}},{"id":"statelessRobotCleanerActionButton","version":1,"status":"proposed","name":"Stateless Robot Cleaner Action Button","attributes":{"availableRobotCleanerActionButtons":{"schema":{"type":"object","properties":{"value":{"type":"array","items":{"type":"string","enum":["start","stop","quit"]}}},"additionalProperties":false,"required":[]},"enumCommands":[]}},"commands":{"setButton":{"arguments":[{"name":"button","optional":false,"schema":{"type":"string","enum":["start","stop","quit"]}}]}}},{"id":"statelessRobotCleanerHomeButton","version":1,"status":"proposed","name":"Stateless Robot Cleaner Home Button","attributes":{"availableRobotCleanerHomeButtons":{"schema":{"type":"object","properties":{"value":{"type":"array","items":{"type":"string","enum":["home"]}}},"additionalProperties":false,"required":[]},"enumCommands":[]}},"commands":{"setButton":{"arguments":[{"name":"button","optional":false,"schema":{"type":"string","enum":["home"]}}]}}},{"id":"statelessRobotCleanerToggleButton","version":1,"status":"proposed","name":"Stateless Robot Cleaner Toggle Button","attributes":{"availableRobotCleanerToggleButtons":{"schema":{"type":"object","properties":{"value":{"type":"array","items":{"type":"string","enum":["actionToggle"]}}},"additionalProperties":false,"required":[]},"enumCommands":[]}},"commands":{"setButton":{"arguments":[{"name":"button","optional":false,"schema":{"type":"string","enum":["actionToggle"]}}]}}},{"id":"statelessSetChannelButton","version":1,"status":"proposed","name":"Stateless Set Channel Button","attributes":{},"commands":{"setChannel":{"arguments":[{"name":"channel","optional":false,"schema":{"type":"string"}}]}}},{"id":"statelessSetChannelByContentButton","version":1,"status":"proposed","name":"Stateless Set Channel By Content Button","attributes":{},"commands":{"setChannelByContent":{"arguments":[{"name":"contentName","optional":false,"schema":{"type":"string"}}]}}},{"id":"statelessSetChannelByNameButton","version":1,"status":"proposed","name":"Stateless Set Channel By Name Button","attributes":{},"commands":{"setChannelByName":{"arguments":[{"name":"channel","optional":false,"schema":{"type":"string"}}]}}},{"id":"statelessTemperatureButton","version":1,"status":"live","name":"Stateless Temperature Button","attributes":{"availableTemperatureButtons":{"schema":{"type":"object","properties":{"value":{"type":"array","items":{"type":"string","enum":["temperatureUp","temperatureDown"]}}},"additionalProperties":false,"required":[]},"enumCommands":[]}},"commands":{"setButton":{"arguments":[{"name":"button","optional":false,"schema":{"type":"string","enum":["temperatureUp","temperatureDown"]}}]}}},{"id":"statelessVolumeButtonWithRepetition","version":1,"status":"proposed","name":"Stateless Volume Button With Repetition","attributes":{},"commands":{"volumeDown":{"arguments":[{"name":"repetition","optional":false,"schema":{"type":"integer","minimum":0,"maximum":10}}]},"volumeUp":{"arguments":[{"name":"repetition","optional":false,"schema":{"type":"integer","minimum":0,"maximum":10}}]}}},{"id":"stepSensor","version":1,"status":"proposed","name":"Step Sensor","attributes":{"goal":{"schema":{"type":"object","properties":{"value":{"title":"PositiveInteger","type":"integer","minimum":0}},"additionalProperties":false,"required":["value"]},"enumCommands":[]},"steps":{"schema":{"type":"object","properties":{"value":{"title":"PositiveInteger","type":"integer","minimum":0}},"additionalProperties":false,"required":["value"]},"enumCommands":[]}},"commands":{}},{"id":"switch","version":1,"status":"live","name":"Switch","attributes":{"switch":{"schema":{"type":"object","properties":{"value":{"title":"SwitchState","type":"string","enum":["on","off"]}},"additionalProperties":false,"required":["value"]},"enumCommands":[{"command":"on","value":"on"},{"command":"off","value":"off"}]}},"commands":{"off":{"arguments":[]},"on":{"arguments":[]}}},{"id":"switchLevel","version":1,"status":"live","name":"Switch Level","attributes":{"level":{"schema":{"title":"IntegerPercent","type":"object","properties":{"value":{"type":"integer","minimum":0,"maximum":100},"unit":{"type":"string","enum":["%"],"default":"%"}},"additionalProperties":false,"required":["value"]},"setter":"setLevel","enumCommands":[]}},"commands":{"setLevel":{"arguments":[{"name":"level","optional":false,"schema":{"type":"integer","minimum":0,"maximum":100}},{"name":"rate","optional":true,"schema":{"title":"PositiveInteger","type":"integer","minimum":0}}]}}},{"id":"tV","version":1,"status":"live","name":"TV","attributes":{"volume":{"schema":{"type":"object","properties":{"value":{"title":"PositiveInteger","type":"integer","minimum":0}},"additionalProperties":false,"required":[]},"enumCommands":[]},"movieMode":{"schema":{"type":"object","properties":{"value":{"title":"String","type":"string","maxLength":255}},"additionalProperties":false,"required":[]},"enumCommands":[]},"sound":{"schema":{"type":"object","properties":{"value":{"title":"String","type":"string","maxLength":255}},"additionalProperties":false,"required":[]},"enumCommands":[]},"channel":{"schema":{"type":"object","properties":{"value":{"title":"PositiveInteger","type":"integer","minimum":0}},"additionalProperties":false,"required":[]},"enumCommands":[]},"power":{"schema":{"type":"object","properties":{"value":{"title":"String","type":"string","maxLength":255}},"additionalProperties":false,"required":[]},"enumCommands":[]},"picture":{"schema":{"type":"object","properties":{"value":{"title":"String","type":"string","maxLength":255}},"additionalProperties":false,"required":[]},"enumCommands":[]}},"commands":{"volumeDown":{"arguments":[]},"volumeUp":{"arguments":[]},"channelDown":{"arguments":[]},"channelUp":{"arguments":[]}}},{"id":"tamperAlert","version":1,"status":"live","name":"Tamper Alert","attributes":{"tamper":{"schema":{"type":"object","properties":{"value":{"type":"string","enum":["clear","detected"]}},"additionalProperties":false,"required":["value"]},"enumCommands":[]}},"commands":{}},{"id":"temperatureAlarm","version":1,"status":"live","name":"Temperature Alarm","attributes":{"temperatureAlarm":{"schema":{"type":"object","properties":{"value":{"type":"string","enum":["cleared","freeze","heat","rateOfRise"]}},"additionalProperties":false,"required":["value"]},"enumCommands":[]}},"commands":{}},{"id":"temperatureMeasurement","version":1,"status":"live","name":"Temperature Measurement","attributes":{"temperature":{"schema":{"type":"object","properties":{"value":{"title":"TemperatureValue","type":"number","minimum":-460,"maximum":10000},"unit":{"type":"string","enum":["F","C"]}},"additionalProperties":false,"required":["value","unit"]},"enumCommands":[]}},"commands":{}},{"id":"testCapability","version":1,"status":"live","name":"Test Capability","attributes":{},"commands":{}},{"id":"thermostat","version":1,"status":"deprecated","name":"Thermostat","attributes":{"thermostatSetpointRange":{"schema":{"type":"object","properties":{"value":{"type":"array","items":[{"title":"TemperatureValue","type":"number","minimum":-460,"maximum":10000},{"title":"TemperatureValue","type":"number","minimum":-460,"maximum":10000}],"minItems":2,"maxItems":2}},"additionalProperties":false,"required":[]},"enumCommands":[]},"heatingSetpointRange":{"schema":{"type":"object","properties":{"value":{"type":"array","items":[{"title":"TemperatureValue","type":"number","minimum":-460,"maximum":10000},{"title":"TemperatureValue","type":"number","minimum":-460,"maximum":10000}],"minItems":2,"maxItems":2}},"additionalProperties":false,"required":["value"]},"enumCommands":[]},"thermostatSetpoint":{"schema":{"title":"Temperature","type":"object","properties":{"value":{"title":"TemperatureValue","type":"number","minimum":-460,"maximum":10000},"unit":{"type":"string","enum":["F","C"]}},"additionalProperties":false,"required":["value","unit"]},"enumCommands":[]},"supportedThermostatFanModes":{"schema":{"type":"object","properties":{"value":{"type":"array","items":{"title":"ThermostatFanMode","type":"string","enum":["auto","circulate","followschedule","on"]}}},"additionalProperties":false,"required":[]},"enumCommands":[]},"schedule":{"schema":{"type":"object","properties":{"value":{"title":"JsonObject","type":"object"}},"additionalProperties":false,"required":["value"]},"setter":"setSchedule","enumCommands":[]},"coolingSetpointRange":{"schema":{"type":"object","properties":{"value":{"type":"array","items":[{"title":"TemperatureValue","type":"number","minimum":-460,"maximum":10000},{"title":"TemperatureValue","type":"number","minimum":-460,"maximum":10000}],"minItems":2,"maxItems":2}},"additionalProperties":false,"required":["value"]},"enumCommands":[]},"heatingSetpoint":{"schema":{"title":"Temperature","type":"object","properties":{"value":{"title":"TemperatureValue","type":"number","minimum":-460,"maximum":10000},"unit":{"type":"string","enum":["F","C"]}},"additionalProperties":false,"required":["value","unit"]},"setter":"setHeatingSetpoint","enumCommands":[]},"coolingSetpoint":{"schema":{"title":"Temperature","type":"object","properties":{"value":{"title":"TemperatureValue","type":"number","minimum":-460,"maximum":10000},"unit":{"type":"string","enum":["F","C"]}},"additionalProperties":false,"required":["value","unit"]},"setter":"setCoolingSetpoint","enumCommands":[]},"thermostatOperatingState":{"schema":{"type":"object","properties":{"value":{"title":"ThermostatOperatingState","type":"string","enum":["cooling","fan only","heating","idle","pending cool","pending heat","vent economizer"]}},"additionalProperties":false,"required":["value"]},"enumCommands":[]},"temperature":{"schema":{"title":"Temperature","type":"object","properties":{"value":{"title":"TemperatureValue","type":"number","minimum":-460,"maximum":10000},"unit":{"type":"string","enum":["F","C"]}},"additionalProperties":false,"required":["value","unit"]},"enumCommands":[]},"thermostatFanMode":{"schema":{"type":"object","properties":{"value":{"title":"ThermostatFanMode","type":"string","enum":["auto","circulate","followschedule","on"]},"data":{"type":"object","additionalProperties":false,"required":[],"properties":{"supportedThermostatFanModes":{"type":"array","items":{"title":"ThermostatFanMode","type":"string","enum":["auto","circulate","followschedule","on"]}}}}},"additionalProperties":false,"required":["value"]},"setter":"setThermostatFanMode","enumCommands":[{"command":"fanAuto","value":"auto"},{"command":"fanCirculate","value":"circulate"},{"command":"fanOn","value":"on"}]},"thermostatMode":{"schema":{"type":"object","properties":{"value":{"title":"ThermostatMode","type":"string","enum":["asleep","auto","autowitheco","autowithreset","autochangeover","autochangeoveractive","autocool","autoheat","auxheatonly","auxiliaryemergencyheat","away","cool","custom","dayoff","dryair","eco","emergency heat","emergencyheat","emergencyheatactive","energysavecool","energysaveheat","fanonly","frostguard","furnace","heat","heatingoff","home","in","manual","moistair","off","out","resume","rush hour","rushhour","schedule","southernaway"]},"data":{"type":"object","additionalProperties":false,"required":[],"properties":{"supportedThermostatModes":{"type":"array","items":{"title":"ThermostatMode","type":"string","enum":["asleep","auto","autowitheco","autowithreset","autochangeover","autochangeoveractive","autocool","autoheat","auxheatonly","auxiliaryemergencyheat","away","cool","custom","dayoff","dryair","eco","emergency heat","emergencyheat","emergencyheatactive","energysavecool","energysaveheat","fanonly","frostguard","furnace","heat","heatingoff","home","in","manual","moistair","off","out","resume","rush hour","rushhour","schedule","southernaway"]}}}}},"additionalProperties":false,"required":["value"]},"setter":"setThermostatMode","enumCommands":[{"command":"auto","value":"auto"},{"command":"cool","value":"cool"},{"command":"emergencyHeat","value":"emergency heat"},{"command":"heat","value":"heat"},{"command":"off","value":"off"}]},"supportedThermostatModes":{"schema":{"type":"object","properties":{"value":{"type":"array","items":{"title":"ThermostatMode","type":"string","enum":["asleep","auto","autowitheco","autowithreset","autochangeover","autochangeoveractive","autocool","autoheat","auxheatonly","auxiliaryemergencyheat","away","cool","custom","dayoff","dryair","eco","emergency heat","emergencyheat","emergencyheatactive","energysavecool","energysaveheat","fanonly","frostguard","furnace","heat","heatingoff","home","in","manual","moistair","off","out","resume","rush hour","rushhour","schedule","southernaway"]}}},"additionalProperties":false,"required":[]},"enumCommands":[]}},"commands":{"heat":{"arguments":[]},"setSchedule":{"arguments":[{"name":"schedule","optional":false,"schema":{"title":"JsonObject","type":"object"}}]},"auto":{"arguments":[]},"cool":{"arguments":[]},"emergencyHeat":{"arguments":[]},"setThermostatFanMode":{"arguments":[{"name":"fanmode","optional":false,"schema":{"title":"ThermostatFanMode","type":"string","enum":["auto","circulate","followschedule","on"]}}]},"fanAuto":{"arguments":[]},"fanCirculate":{"arguments":[]},"off":{"arguments":[]},"setCoolingSetpoint":{"arguments":[{"name":"setpoint","optional":false,"schema":{"title":"TemperatureValue","type":"number","minimum":-460,"maximum":10000}}]},"setHeatingSetpoint":{"arguments":[{"name":"setpoint","optional":false,"schema":{"title":"TemperatureValue","type":"number","minimum":-460,"maximum":10000}}]},"setThermostatMode":{"arguments":[{"name":"mode","optional":false,"schema":{"title":"ThermostatMode","type":"string","enum":["asleep","auto","autowitheco","autowithreset","autochangeover","autochangeoveractive","autocool","autoheat","auxheatonly","auxiliaryemergencyheat","away","cool","custom","dayoff","dryair","eco","emergency heat","emergencyheat","emergencyheatactive","energysavecool","energysaveheat","fanonly","frostguard","furnace","heat","heatingoff","home","in","manual","moistair","off","out","resume","rush hour","rushhour","schedule","southernaway"]}}]},"fanOn":{"arguments":[]}}},{"id":"thermostatCoolingSetpoint","version":1,"status":"live","name":"Thermostat Cooling Setpoint","attributes":{"coolingSetpoint":{"schema":{"title":"Temperature","type":"object","properties":{"value":{"title":"TemperatureValue","type":"number","minimum":-460,"maximum":10000},"unit":{"type":"string","enum":["F","C"]}},"additionalProperties":false,"required":["value","unit"]},"setter":"setCoolingSetpoint","enumCommands":[]}},"commands":{"setCoolingSetpoint":{"arguments":[{"name":"setpoint","optional":false,"schema":{"title":"TemperatureValue","type":"number","minimum":-460,"maximum":10000}}]}}},{"id":"thermostatFanMode","version":1,"status":"live","name":"Thermostat Fan Mode","attributes":{"thermostatFanMode":{"schema":{"type":"object","properties":{"value":{"title":"ThermostatFanMode","type":"string","enum":["auto","circulate","followschedule","on"]},"data":{"type":"object","additionalProperties":false,"required":[],"properties":{"supportedThermostatFanModes":{"type":"array","items":{"title":"ThermostatFanMode","type":"string","enum":["auto","circulate","followschedule","on"]}}}}},"additionalProperties":false,"required":["value"]},"setter":"setThermostatFanMode","enumCommands":[{"command":"fanAuto","value":"auto"},{"command":"fanCirculate","value":"circulate"},{"command":"fanOn","value":"on"}]},"supportedThermostatFanModes":{"schema":{"type":"object","properties":{"value":{"type":"array","items":{"title":"ThermostatFanMode","type":"string","enum":["auto","circulate","followschedule","on"]}}},"additionalProperties":false,"required":[]},"enumCommands":[]}},"commands":{"fanOn":{"arguments":[]},"setThermostatFanMode":{"arguments":[{"name":"mode","optional":false,"schema":{"title":"ThermostatFanMode","type":"string","enum":["auto","circulate","followschedule","on"]}}]},"fanAuto":{"arguments":[]},"fanCirculate":{"arguments":[]}}},{"id":"thermostatHeatingSetpoint","version":1,"status":"live","name":"Thermostat Heating Setpoint","attributes":{"heatingSetpoint":{"schema":{"title":"Temperature","type":"object","properties":{"value":{"title":"TemperatureValue","type":"number","minimum":-460,"maximum":10000},"unit":{"type":"string","enum":["F","C"]}},"additionalProperties":false,"required":["value","unit"]},"setter":"setHeatingSetpoint","enumCommands":[]}},"commands":{"setHeatingSetpoint":{"arguments":[{"name":"setpoint","optional":false,"schema":{"title":"TemperatureValue","type":"number","minimum":-460,"maximum":10000}}]}}},{"id":"thermostatMode","version":1,"status":"live","name":"Thermostat Mode","attributes":{"thermostatMode":{"schema":{"type":"object","properties":{"value":{"title":"ThermostatMode","type":"string","enum":["asleep","auto","autowitheco","autowithreset","autochangeover","autochangeoveractive","autocool","autoheat","auxheatonly","auxiliaryemergencyheat","away","cool","custom","dayoff","dryair","eco","emergency heat","emergencyheat","emergencyheatactive","energysavecool","energysaveheat","fanonly","frostguard","furnace","heat","heatingoff","home","in","manual","moistair","off","out","resume","rush hour","rushhour","schedule","southernaway"]},"data":{"type":"object","additionalProperties":false,"required":[],"properties":{"supportedThermostatModes":{"type":"array","items":{"title":"ThermostatMode","type":"string","enum":["asleep","auto","autowitheco","autowithreset","autochangeover","autochangeoveractive","autocool","autoheat","auxheatonly","auxiliaryemergencyheat","away","cool","custom","dayoff","dryair","eco","emergency heat","emergencyheat","emergencyheatactive","energysavecool","energysaveheat","fanonly","frostguard","furnace","heat","heatingoff","home","in","manual","moistair","off","out","resume","rush hour","rushhour","schedule","southernaway"]}}}}},"additionalProperties":false,"required":["value"]},"setter":"setThermostatMode","enumCommands":[{"command":"auto","value":"auto"},{"command":"cool","value":"cool"},{"command":"emergencyHeat","value":"emergency heat"},{"command":"heat","value":"heat"},{"command":"off","value":"off"}]},"supportedThermostatModes":{"schema":{"type":"object","properties":{"value":{"type":"array","items":{"title":"ThermostatMode","type":"string","enum":["asleep","auto","autowitheco","autowithreset","autochangeover","autochangeoveractive","autocool","autoheat","auxheatonly","auxiliaryemergencyheat","away","cool","custom","dayoff","dryair","eco","emergency heat","emergencyheat","emergencyheatactive","energysavecool","energysaveheat","fanonly","frostguard","furnace","heat","heatingoff","home","in","manual","moistair","off","out","resume","rush hour","rushhour","schedule","southernaway"]}}},"additionalProperties":false,"required":[]},"enumCommands":[]}},"commands":{"heat":{"arguments":[]},"auto":{"arguments":[]},"setThermostatMode":{"arguments":[{"name":"mode","optional":false,"schema":{"title":"ThermostatMode","type":"string","enum":["asleep","auto","autowitheco","autowithreset","autochangeover","autochangeoveractive","autocool","autoheat","auxheatonly","auxiliaryemergencyheat","away","cool","custom","dayoff","dryair","eco","emergency heat","emergencyheat","emergencyheatactive","energysavecool","energysaveheat","fanonly","frostguard","furnace","heat","heatingoff","home","in","manual","moistair","off","out","resume","rush hour","rushhour","schedule","southernaway"]}}]},"cool":{"arguments":[]},"emergencyHeat":{"arguments":[]},"off":{"arguments":[]}}},{"id":"thermostatOperatingState","version":1,"status":"live","name":"Thermostat Operating State","attributes":{"thermostatOperatingState":{"schema":{"type":"object","properties":{"value":{"title":"ThermostatOperatingState","type":"string","enum":["cooling","fan only","heating","idle","pending cool","pending heat","vent economizer"]}},"additionalProperties":false,"required":["value"]},"enumCommands":[]}},"commands":{}},{"id":"thermostatSchedule","version":1,"status":"deprecated","name":"Thermostat Schedule","attributes":{"schedule":{"schema":{"type":"object","properties":{"value":{"title":"JsonObject","type":"object"}},"additionalProperties":false,"required":[]},"setter":"setSchedule","enumCommands":[]}},"commands":{"setSchedule":{"arguments":[{"name":"schedule","optional":false,"schema":{"title":"JsonObject","type":"object"}}]}}},{"id":"thermostatSetpoint","version":1,"status":"deprecated","name":"Thermostat Setpoint","attributes":{"thermostatSetpoint":{"schema":{"title":"Temperature","type":"object","properties":{"value":{"title":"TemperatureValue","type":"number","minimum":-460,"maximum":10000},"unit":{"type":"string","enum":["F","C"]}},"additionalProperties":false,"required":["value","unit"]},"enumCommands":[]}},"commands":{}},{"id":"threeAxis","version":1,"status":"live","name":"Three Axis","attributes":{"threeAxis":{"schema":{"type":"object","properties":{"value":{"type":"array","items":{"type":"integer","minimum":-10000,"maximum":10000},"minItems":3,"maxItems":3},"unit":{"type":"string","enum":["mG"],"default":"mG"}},"additionalProperties":false,"required":["value"]},"enumCommands":[]}},"commands":{}},{"id":"timedSession","version":1,"status":"proposed","name":"Timed Session","attributes":{"completionTime":{"schema":{"type":"object","properties":{"value":{"title":"Iso8601Date","type":"string","pattern":"^(?:[1-9]\\d{3}-?(?:(?:0[1-9]|1[0-2])-?(?:0[1-9]|1\\d|2[0-8])|(?:0[13-9]|1[0-2])-?(?:29|30)|(?:0[13578]|1[02])-?31)|(?:[1-9]\\d(?:0[48]|[2468][048]|[13579][26])|(?:[2468][048]|[13579][26])00)-?02-?29)T(?:[01]\\d|2[0-3]):?[0-5]\\d:?[0-5]\\d(?:\\.\\d{3})?(?:Z|[+-][01]\\d(?::?[0-5]\\d)?)$"}},"additionalProperties":false,"required":["value"]},"setter":"setCompletionTime","enumCommands":[]},"sessionStatus":{"schema":{"type":"object","properties":{"value":{"type":"string","enum":["canceled","paused","running","stopped"]}},"additionalProperties":false,"required":["value"]},"enumCommands":[{"command":"cancel","value":"canceled"},{"command":"pause","value":"paused"},{"command":"start","value":"running"},{"command":"stop","value":"stopped"}]}},"commands":{"cancel":{"arguments":[]},"stop":{"arguments":[]},"start":{"arguments":[]},"setCompletionTime":{"arguments":[{"name":"completionTime","optional":false,"schema":{"title":"Iso8601Date","type":"string","pattern":"^(?:[1-9]\\d{3}-?(?:(?:0[1-9]|1[0-2])-?(?:0[1-9]|1\\d|2[0-8])|(?:0[13-9]|1[0-2])-?(?:29|30)|(?:0[13578]|1[02])-?31)|(?:[1-9]\\d(?:0[48]|[2468][048]|[13579][26])|(?:[2468][048]|[13579][26])00)-?02-?29)T(?:[01]\\d|2[0-3]):?[0-5]\\d:?[0-5]\\d(?:\\.\\d{3})?(?:Z|[+-][01]\\d(?::?[0-5]\\d)?)$"}}]},"pause":{"arguments":[]}}},{"id":"tone","version":1,"status":"live","name":"Tone","attributes":{},"commands":{"beep":{"arguments":[]}}},{"id":"touchSensor","version":1,"status":"deprecated","name":"Touch Sensor","attributes":{"touch":{"schema":{"type":"object","properties":{"value":{"type":"string","enum":["touched"]}},"additionalProperties":false,"required":[]},"enumCommands":[]}},"commands":{}},{"id":"tvChannel","version":1,"status":"proposed","name":"Tv Channel","attributes":{"tvChannel":{"schema":{"type":"object","properties":{"value":{"title":"String","type":"string","maxLength":255}},"additionalProperties":false,"required":[]},"setter":"setTvChannel","enumCommands":[]},"tvChannelName":{"schema":{"type":"object","properties":{"value":{"title":"String","type":"string","maxLength":255}},"additionalProperties":false,"required":[]},"setter":"setTvChannelName","enumCommands":[]}},"commands":{"channelDown":{"arguments":[]},"setTvChannel":{"arguments":[{"name":"tvChannel","optional":false,"schema":{"title":"String","type":"string","maxLength":255}}]},"channelUp":{"arguments":[]},"setTvChannelName":{"arguments":[{"name":"tvChannelName","optional":true,"schema":{"title":"String","type":"string","maxLength":255}}]}}},{"id":"tvocHealthConcern","version":1,"status":"proposed","name":"Tvoc Health Concern","attributes":{"tvocHealthConcern":{"schema":{"type":"object","properties":{"value":{"title":"AirQualityHealthConcern","type":"string","enum":["good","moderate","slightlyUnhealthy","unhealthy","veryUnhealthy","hazardous"]}},"additionalProperties":false,"required":["value"]},"enumCommands":[]}},"commands":{}},{"id":"tvocMeasurement","version":1,"status":"live","name":"Tvoc Measurement","attributes":{"tvocLevel":{"schema":{"type":"object","properties":{"value":{"type":"number","minimum":0,"maximum":1000000},"unit":{"type":"string","enum":["ppm"],"default":"ppm"}},"additionalProperties":false,"required":["value","unit"]},"enumCommands":[]}},"commands":{}},{"id":"ultravioletIndex","version":1,"status":"live","name":"Ultraviolet Index","attributes":{"ultravioletIndex":{"schema":{"type":"object","properties":{"value":{"type":"number","minimum":0,"maximum":255}},"additionalProperties":false,"required":["value"]},"enumCommands":[]}},"commands":{}},{"id":"valve","version":1,"status":"live","name":"Valve","attributes":{"valve":{"schema":{"type":"object","properties":{"value":{"type":"string","enum":["closed","open"]}},"additionalProperties":false,"required":["value"]},"enumCommands":[{"command":"close","value":"closed"},{"command":"open","value":"open"}]}},"commands":{"close":{"arguments":[]},"open":{"arguments":[]}}},{"id":"vehicleEngine","version":1,"status":"proposed","name":"Vehicle Engine","attributes":{"engineState":{"schema":{"type":"object","properties":{"value":{"type":"string","enum":["starting","running","unknown","off"]}},"additionalProperties":false,"required":["value"]},"enumCommands":[{"command":"startEngine","value":"running"},{"command":"stopEngine","value":"off"}]}},"commands":{"startEngine":{"arguments":[]},"stopEngine":{"arguments":[]}}},{"id":"vehicleFuelLevel","version":1,"status":"proposed","name":"Vehicle Fuel Level","attributes":{"fuelLevel":{"schema":{"title":"IntegerPercent","type":"object","properties":{"value":{"type":"integer","minimum":0,"maximum":100},"unit":{"type":"string","enum":["%"],"default":"%"}},"additionalProperties":false,"required":["value"]},"enumCommands":[]}},"commands":{}},{"id":"vehicleOdometer","version":1,"status":"proposed","name":"Vehicle Odometer","attributes":{"odometerReading":{"schema":{"title":"Distance","type":"object","properties":{"value":{"title":"PositiveNumber","type":"number","minimum":0},"unit":{"type":"string","enum":["mi","km","m"]}},"additionalProperties":false,"required":["value","unit"]},"enumCommands":[]}},"commands":{}},{"id":"vehicleRange","version":1,"status":"proposed","name":"Vehicle Range","attributes":{"estimatedRemainingRange":{"schema":{"title":"Distance","type":"object","properties":{"value":{"title":"PositiveNumber","type":"number","minimum":0},"unit":{"type":"string","enum":["mi","km","m"]}},"additionalProperties":false,"required":["value","unit"]},"enumCommands":[]}},"commands":{}},{"id":"vehicleTirePressureMonitor","version":1,"status":"proposed","name":"Vehicle Tire Pressure Monitor","attributes":{"tirePressureState":{"schema":{"type":"object","properties":{"value":{"type":"string","enum":["normal","warn"]}},"additionalProperties":false,"required":["value"]},"enumCommands":[]}},"commands":{}},{"id":"veryFineDustHealthConcern","version":1,"status":"proposed","name":"Very Fine Dust Health Concern","attributes":{"veryFineDustHealthConcern":{"schema":{"type":"object","properties":{"value":{"title":"AirQualityHealthConcern","type":"string","enum":["good","moderate","slightlyUnhealthy","unhealthy","veryUnhealthy","hazardous"]}},"additionalProperties":false,"required":["value"]},"enumCommands":[]}},"commands":{}},{"id":"veryFineDustSensor","version":1,"status":"live","name":"Very Fine Dust Sensor","attributes":{"veryFineDustLevel":{"schema":{"type":"object","properties":{"value":{"title":"PositiveInteger","type":"integer","minimum":0},"unit":{"type":"string","enum":["μg/m^3"],"default":"μg/m^3"}},"additionalProperties":false,"required":["value"]},"enumCommands":[]}},"commands":{}},{"id":"videoCamera","version":1,"status":"live","name":"Video Camera","attributes":{"settings":{"schema":{"type":"object","properties":{"value":{"title":"JsonObject","type":"object"}},"additionalProperties":false,"required":["value"]},"enumCommands":[]},"mute":{"schema":{"type":"object","properties":{"value":{"title":"MuteState","type":"string","enum":["muted","unmuted"]}},"additionalProperties":false,"required":[]},"enumCommands":[{"command":"mute","value":"muted"},{"command":"unmute","value":"unmuted"}]},"camera":{"schema":{"type":"object","properties":{"value":{"type":"string","enum":["off","on","restarting","unavailable"]}},"additionalProperties":false,"required":[]},"enumCommands":[{"command":"on","value":"on"},{"command":"off","value":"off"}]},"statusMessage":{"schema":{"type":"object","properties":{"value":{"title":"String","type":"string","maxLength":255}},"additionalProperties":false,"required":[]},"enumCommands":[]}},"commands":{"mute":{"arguments":[]},"unmute":{"arguments":[]},"flip":{"arguments":[]},"off":{"arguments":[]},"on":{"arguments":[]}}},{"id":"videoCapture","version":1,"status":"live","name":"Video Capture","attributes":{"stream":{"schema":{"type":"object","properties":{"value":{"title":"JsonObject","type":"object"}},"additionalProperties":false,"required":["value"]},"enumCommands":[]},"clip":{"schema":{"type":"object","properties":{"value":{"title":"JsonObject","type":"object"}},"additionalProperties":false,"required":["value"]},"enumCommands":[]}},"commands":{"capture":{"arguments":[{"name":"startTime","optional":false,"schema":{"title":"Iso8601Date","type":"string","pattern":"^(?:[1-9]\\d{3}-?(?:(?:0[1-9]|1[0-2])-?(?:0[1-9]|1\\d|2[0-8])|(?:0[13-9]|1[0-2])-?(?:29|30)|(?:0[13578]|1[02])-?31)|(?:[1-9]\\d(?:0[48]|[2468][048]|[13579][26])|(?:[2468][048]|[13579][26])00)-?02-?29)T(?:[01]\\d|2[0-3]):?[0-5]\\d:?[0-5]\\d(?:\\.\\d{3})?(?:Z|[+-][01]\\d(?::?[0-5]\\d)?)$"}},{"name":"captureTime","optional":false,"schema":{"title":"Iso8601Date","type":"string","pattern":"^(?:[1-9]\\d{3}-?(?:(?:0[1-9]|1[0-2])-?(?:0[1-9]|1\\d|2[0-8])|(?:0[13-9]|1[0-2])-?(?:29|30)|(?:0[13578]|1[02])-?31)|(?:[1-9]\\d(?:0[48]|[2468][048]|[13579][26])|(?:[2468][048]|[13579][26])00)-?02-?29)T(?:[01]\\d|2[0-3]):?[0-5]\\d:?[0-5]\\d(?:\\.\\d{3})?(?:Z|[+-][01]\\d(?::?[0-5]\\d)?)$"}},{"name":"endTime","optional":false,"schema":{"title":"Iso8601Date","type":"string","pattern":"^(?:[1-9]\\d{3}-?(?:(?:0[1-9]|1[0-2])-?(?:0[1-9]|1\\d|2[0-8])|(?:0[13-9]|1[0-2])-?(?:29|30)|(?:0[13578]|1[02])-?31)|(?:[1-9]\\d(?:0[48]|[2468][048]|[13579][26])|(?:[2468][048]|[13579][26])00)-?02-?29)T(?:[01]\\d|2[0-3]):?[0-5]\\d:?[0-5]\\d(?:\\.\\d{3})?(?:Z|[+-][01]\\d(?::?[0-5]\\d)?)$"}},{"name":"correlationId","optional":true,"schema":{"title":"String","type":"string","maxLength":255}},{"name":"reason","optional":true,"schema":{"title":"String","type":"string","maxLength":255}}]}}},{"id":"videoClips","version":1,"status":"proposed","name":"Video Clips","attributes":{"videoClip":{"schema":{"type":"object","properties":{"value":{"title":"VideoClip","type":"object","additionalProperties":false,"properties":{"status":{"title":"VideoClipStatus","type":"string","enum":["initiated","streaming","completed","failed","ignored"]},"clipId":{"title":"String","type":"string","maxLength":255},"thumbnailUrl":{"title":"URL","type":"string","pattern":"^(https?):\\/\\/((?:[a-zA-Z0-9.-]|%[0-9A-F]{2}){3,})(?::(\\d+))?((?:\\/(?:[a-zA-Z0-9-._~!$&'()*+,;=:@]|%[0-9A-F]{2})*)*)(?:\\?((?:[a-zA-Z0-9-._~!$&'()*+,;=:\\/?@]|%[0-9A-F]{2})*))?(?:#((?:[a-zA-Z0-9-._~!$&'()*+,;=:\\/?@]|%[0-9A-F]{2})*))?$"},"clipUrl":{"title":"URL","type":"string","pattern":"^(https?):\\/\\/((?:[a-zA-Z0-9.-]|%[0-9A-F]{2}){3,})(?::(\\d+))?((?:\\/(?:[a-zA-Z0-9-._~!$&'()*+,;=:@]|%[0-9A-F]{2})*)*)(?:\\?((?:[a-zA-Z0-9-._~!$&'()*+,;=:\\/?@]|%[0-9A-F]{2})*))?(?:#((?:[a-zA-Z0-9-._~!$&'()*+,;=:\\/?@]|%[0-9A-F]{2})*))?$"},"startTime":{"title":"Iso8601Date","type":"string","pattern":"^(?:[1-9]\\d{3}-?(?:(?:0[1-9]|1[0-2])-?(?:0[1-9]|1\\d|2[0-8])|(?:0[13-9]|1[0-2])-?(?:29|30)|(?:0[13578]|1[02])-?31)|(?:[1-9]\\d(?:0[48]|[2468][048]|[13579][26])|(?:[2468][048]|[13579][26])00)-?02-?29)T(?:[01]\\d|2[0-3]):?[0-5]\\d:?[0-5]\\d(?:\\.\\d{3})?(?:Z|[+-][01]\\d(?::?[0-5]\\d)?)$"},"captureTime":{"title":"Iso8601Date","type":"string","pattern":"^(?:[1-9]\\d{3}-?(?:(?:0[1-9]|1[0-2])-?(?:0[1-9]|1\\d|2[0-8])|(?:0[13-9]|1[0-2])-?(?:29|30)|(?:0[13578]|1[02])-?31)|(?:[1-9]\\d(?:0[48]|[2468][048]|[13579][26])|(?:[2468][048]|[13579][26])00)-?02-?29)T(?:[01]\\d|2[0-3]):?[0-5]\\d:?[0-5]\\d(?:\\.\\d{3})?(?:Z|[+-][01]\\d(?::?[0-5]\\d)?)$"},"duration":{"title":"PositiveInteger","type":"integer","minimum":0}}}},"additionalProperties":false,"required":["value"]},"enumCommands":[]}},"commands":{"captureClip":{"arguments":[{"name":"duration","optional":false,"schema":{"title":"PositiveInteger","type":"integer","minimum":0}},{"name":"preFetch","optional":false,"schema":{"title":"PositiveInteger","type":"integer","minimum":0}}]}}},{"id":"videoStream","version":1,"status":"live","name":"Video Stream","attributes":{"stream":{"schema":{"type":"object","properties":{"value":{"title":"JsonObject","type":"object"}},"additionalProperties":false,"required":["value"]},"enumCommands":[]}},"commands":{"stopStream":{"arguments":[]},"startStream":{"arguments":[]}}},{"id":"voltageMeasurement","version":1,"status":"live","name":"Voltage Measurement","attributes":{"voltage":{"schema":{"type":"object","properties":{"value":{"title":"Number","type":"number"},"unit":{"type":"string","enum":["V"],"default":"V"}},"additionalProperties":false,"required":["value"]},"enumCommands":[]}},"commands":{}},{"id":"washerMode","version":1,"status":"proposed","name":"Washer Mode","attributes":{"washerMode":{"schema":{"type":"object","properties":{"value":{"title":"WasherMode","type":"string","enum":["regular","heavy","rinse","spinDry"]}},"additionalProperties":false,"required":["value"]},"setter":"setWasherMode","enumCommands":[]}},"commands":{"setWasherMode":{"arguments":[{"name":"mode","optional":false,"schema":{"title":"WasherMode","type":"string","enum":["regular","heavy","rinse","spinDry"]}}]}}},{"id":"washerOperatingState","version":1,"status":"proposed","name":"Washer Operating State","attributes":{"completionTime":{"schema":{"type":"object","properties":{"value":{"title":"Iso8601Date","type":"string","pattern":"^(?:[1-9]\\d{3}-?(?:(?:0[1-9]|1[0-2])-?(?:0[1-9]|1\\d|2[0-8])|(?:0[13-9]|1[0-2])-?(?:29|30)|(?:0[13578]|1[02])-?31)|(?:[1-9]\\d(?:0[48]|[2468][048]|[13579][26])|(?:[2468][048]|[13579][26])00)-?02-?29)T(?:[01]\\d|2[0-3]):?[0-5]\\d:?[0-5]\\d(?:\\.\\d{3})?(?:Z|[+-][01]\\d(?::?[0-5]\\d)?)$"}},"additionalProperties":false,"required":["value"]},"enumCommands":[]},"machineState":{"schema":{"type":"object","properties":{"value":{"title":"MachineState","type":"string","enum":["pause","run","stop"]}},"additionalProperties":false,"required":["value"]},"setter":"setMachineState","enumCommands":[]},"washerJobState":{"schema":{"type":"object","properties":{"value":{"type":"string","enum":["airWash","cooling","delayWash","drying","finish","none","preWash","rinse","spin","wash","weightSensing","wrinklePrevent"]}},"additionalProperties":false,"required":["value"]},"enumCommands":[]},"supportedMachineStates":{"schema":{"type":"object","properties":{"value":{"type":"array","items":{"title":"MachineState","type":"string","enum":["pause","run","stop"]}}},"additionalProperties":false,"required":[]},"enumCommands":[]}},"commands":{"setMachineState":{"arguments":[{"name":"state","optional":false,"schema":{"title":"MachineState","type":"string","enum":["pause","run","stop"]}}]}}},{"id":"washerOperationalState","version":1,"status":"deprecated","name":"Washer Operational State","attributes":{"completionTime":{"schema":{"type":"object","properties":{"value":{"title":"Iso8601Date","type":"string","pattern":"^(?:[1-9]\\d{3}-?(?:(?:0[1-9]|1[0-2])-?(?:0[1-9]|1\\d|2[0-8])|(?:0[13-9]|1[0-2])-?(?:29|30)|(?:0[13578]|1[02])-?31)|(?:[1-9]\\d(?:0[48]|[2468][048]|[13579][26])|(?:[2468][048]|[13579][26])00)-?02-?29)T(?:[01]\\d|2[0-3]):?[0-5]\\d:?[0-5]\\d(?:\\.\\d{3})?(?:Z|[+-][01]\\d(?::?[0-5]\\d)?)$"}},"additionalProperties":false,"required":["value"]},"enumCommands":[]},"machineState":{"schema":{"type":"object","properties":{"value":{"title":"MachineState","type":"string","enum":["pause","run","stop"]}},"additionalProperties":false,"required":["value"]},"setter":"setMachineState","enumCommands":[]},"washerJobState":{"schema":{"type":"object","properties":{"value":{"type":"string","enum":["airWash","cooling","delayWash","drying","finish","none","preWash","rinse","spin","wash","weightSensing","wrinklePrevent"]}},"additionalProperties":false,"required":["value"]},"enumCommands":[]},"supportedMachineStates":{"schema":{"type":"object","properties":{"value":{"type":"array","items":{"title":"MachineState","type":"string","enum":["pause","run","stop"]}}},"additionalProperties":false,"required":[]},"enumCommands":[]}},"commands":{"setMachineState":{"arguments":[{"name":"state","optional":false,"schema":{"title":"MachineState","type":"string","enum":["pause","run","stop"]}}]}}},{"id":"waterSensor","version":1,"status":"live","name":"Water Sensor","attributes":{"water":{"schema":{"type":"object","properties":{"value":{"title":"MoistureState","type":"string","enum":["dry","wet"]}},"additionalProperties":false,"required":["value"]},"enumCommands":[]}},"commands":{}},{"id":"webrtc","version":1,"status":"live","name":"webrtc","attributes":{"sdpAnswer":{"schema":{"type":"object","properties":{"value":{"type":"object","additionalProperties":false,"properties":{"id":{"type":"string"},"sdp":{"type":"string"},"turn_url":{"type":"string"},"turn_user":{"type":"string"},"turn_pwd":{"type":"string"}},"required":["id","sdp"]}},"additionalProperties":false,"required":["value"]},"enumCommands":[]},"talkback":{"schema":{"type":"object","properties":{"value":{"type":"boolean"}},"additionalProperties":false,"required":["value"]},"enumCommands":[]},"supportedFeatures":{"schema":{"type":"object","properties":{"value":{"type":"array","items":{"type":"string"}}},"additionalProperties":false,"required":["value"]},"enumCommands":[]},"audioOnly":{"schema":{"type":"object","properties":{"value":{"type":"boolean"}},"additionalProperties":false,"required":["value"]},"enumCommands":[]},"stunUrl":{"schema":{"type":"object","properties":{"value":{"title":"URL","type":"string","pattern":"^(https?):\\/\\/((?:[a-zA-Z0-9.-]|%[0-9A-F]{2}){3,})(?::(\\d+))?((?:\\/(?:[a-zA-Z0-9-._~!$&'()*+,;=:@]|%[0-9A-F]{2})*)*)(?:\\?((?:[a-zA-Z0-9-._~!$&'()*+,;=:\\/?@]|%[0-9A-F]{2})*))?(?:#((?:[a-zA-Z0-9-._~!$&'()*+,;=:\\/?@]|%[0-9A-F]{2})*))?$"}},"additionalProperties":false,"required":["value"]},"enumCommands":[]}},"commands":{"sdpOffer":{"arguments":[{"name":"id","optional":false,"schema":{"type":"string"}},{"name":"sdp","optional":false,"schema":{"type":"string"}}]},"end":{"arguments":[{"name":"id","optional":false,"schema":{"type":"string"}}]}}},{"id":"wifiMeshRouter","version":1,"status":"proposed","name":"Wifi Mesh Router","attributes":{"disconnectedRouterCount":{"schema":{"type":"object","properties":{"value":{"title":"PositiveInteger","type":"integer","minimum":0}},"additionalProperties":false,"required":["value"]},"enumCommands":[]},"wifiGuestNetworkStatus":{"schema":{"type":"object","properties":{"value":{"title":"WifiState","type":"string","enum":["enabled","disabled","not configured"]}},"additionalProperties":false,"required":["value"]},"enumCommands":[{"command":"enableWifiGuestNetwork","value":"enabled"},{"command":"disableWifiGuestNetwork","value":"disabled"}]},"connectedRouterCount":{"schema":{"type":"object","properties":{"value":{"title":"PositiveInteger","type":"integer","minimum":0}},"additionalProperties":false,"required":["value"]},"enumCommands":[]},"connectedDeviceCount":{"schema":{"type":"object","properties":{"value":{"title":"PositiveInteger","type":"integer","minimum":0}},"additionalProperties":false,"required":["value"]},"enumCommands":[]},"wifiNetworkName":{"schema":{"type":"object","properties":{"value":{"title":"String","type":"string","maxLength":255}},"additionalProperties":false,"required":["value"]},"enumCommands":[]},"wifiGuestNetworkName":{"schema":{"type":"object","properties":{"value":{"title":"String","type":"string","maxLength":255}},"additionalProperties":false,"required":["value"]},"enumCommands":[]},"wifiNetworkStatus":{"schema":{"type":"object","properties":{"value":{"title":"WifiState","type":"string","enum":["enabled","disabled","not configured"]}},"additionalProperties":false,"required":["value"]},"enumCommands":[{"command":"enableWifiNetwork","value":"enabled"},{"command":"disableWifiNetwork","value":"disabled"}]}},"commands":{"enableWifiGuestNetwork":{"arguments":[]},"disableWifiNetwork":{"arguments":[]},"enableWifiNetwork":{"arguments":[]},"disableWifiGuestNetwork":{"arguments":[]}}},{"id":"windSpeed","version":1,"status":"proposed","name":"Wind Speed","attributes":{"windspeed":{"schema":{"type":"object","properties":{"value":{"title":"PositiveNumber","type":"number","minimum":0},"unit":{"type":"string","enum":["m/s"],"default":"m/s"}},"additionalProperties":false,"required":["value"]},"enumCommands":[]}},"commands":{}},{"id":"windowShade","version":1,"status":"live","name":"Window Shade","attributes":{"supportedWindowShadeCommands":{"schema":{"type":"object","properties":{"value":{"type":"array","items":{"type":"string","enum":["open","close","pause"]}}},"additionalProperties":false,"required":[]},"enumCommands":[]},"windowShade":{"schema":{"type":"object","properties":{"value":{"title":"OpenableState","type":"string","enum":["closed","closing","open","opening","partially open","unknown"]}},"additionalProperties":false,"required":["value"]},"enumCommands":[{"command":"close","value":"closed"},{"command":"open","value":"open"}]}},"commands":{"close":{"arguments":[]},"open":{"arguments":[]},"pause":{"arguments":[]}}},{"id":"windowShadeLevel","version":1,"status":"proposed","name":"Window Shade Level","attributes":{"shadeLevel":{"schema":{"title":"IntegerPercent","type":"object","properties":{"value":{"type":"integer","minimum":0,"maximum":100},"unit":{"type":"string","enum":["%"],"default":"%"}},"additionalProperties":false,"required":["value"]},"setter":"setShadeLevel","enumCommands":[]}},"commands":{"setShadeLevel":{"arguments":[{"name":"shadeLevel","optional":false,"schema":{"title":"IntegerPercent","type":"object","additionalProperties":false,"properties":{"value":{"type":"integer","minimum":0,"maximum":100},"unit":{"type":"string","enum":["%"],"default":"%"}},"required":["value"]}}]}}},{"id":"windowShadePreset","version":1,"status":"live","name":"Window Shade Preset","attributes":{},"commands":{"presetPosition":{"arguments":[]}}},{"id":"wirelessOperatingMode","version":1,"status":"proposed","name":"Wireless Operating Mode","attributes":{"wirelessOperatingMode":{"schema":{"type":"object","properties":{"value":{"type":"string","enum":["whenNeeded","alwaysOn"]}},"additionalProperties":false,"required":["value"]},"setter":"setWirelessOperatingMode","enumCommands":[]}},"commands":{"setWirelessOperatingMode":{"arguments":[{"name":"wirelessOperatingMode","optional":false,"schema":{"type":"string","enum":["whenNeeded","alwaysOn"]}}]}}},{"id":"zwMultichannel","version":1,"status":"live","name":"Zw Multichannel","attributes":{"epEvent":{"schema":{"type":"object","properties":{"value":{"title":"String","type":"string","maxLength":255}},"additionalProperties":false,"required":[]},"enumCommands":[]},"epInfo":{"schema":{"type":"object","properties":{"value":{"title":"String","type":"string","maxLength":255}},"additionalProperties":false,"required":[]},"enumCommands":[]}},"commands":{"enableEpEvents":{"arguments":[{"name":"enabledEndpoints","optional":false,"schema":{"title":"String","type":"string","maxLength":255}}]},"epCmd":{"arguments":[{"name":"endpoint","optional":false,"schema":{"title":"Number","type":"number"}},{"name":"commands","optional":false,"schema":{"title":"String","type":"string","maxLength":255}}]}}}]
        var _capabilities = {}
        _raw_capabilities.sort((capa1, capa2)=>{
                return capa1.id.localeCompare(capa2.id)
            })
            .forEach(function (cp) {
                if (cp.status === 'live' || cp.status === 'proposed') {
                    cp['vid']=cp.id+'_v'+cp.version //vid : id + version
                    cp['vname']=(cp.version===1?cp.name:cp.name+' v'+cp.version)// vname : name + version
                    // _capabilities[capa.id] = capa
                    _capabilities[cp.vid] = cp
                }
            })

        this.getAttributeSchema = function (capabilityId, attributeId) {
            if (_capabilities[capabilityId] && _capabilities[capabilityId].attributes && _capabilities[capabilityId].attributes[attributeId]) {
                return _capabilities[capabilityId].attributes[attributeId].schema || {}
            } else {
                return {}
            }
        }
        this.getCommandArguments = function (capabilityId, commandId) {
            if (_capabilities[capabilityId] && _capabilities[capabilityId].commands && _capabilities[capabilityId].commands[commandId]) {
                return _capabilities[capabilityId].commands[commandId].arguments || []
            } else {
                return []
            }
        }

        this.getCapability = function (vid,version) {
            if(version){
                vid = vid+'_v'+version;
            }
            if(vid&&vid.indexOf('_v')===-1){
                vid+='_v1';
            }
            return _capabilities[vid] || null;
        }
        this.hasCapability = function (vid){
            if(vid&&vid.indexOf('_v')===-1){
                vid+='_v1'
            }
            return !!_capabilities[vid]
        }
        this.getAllCapabilities = function () {
            return _capabilities;
        }
        this.setCapabilities=function(capabilities){
            _capabilities = capabilities;
        }
        this.addCapabilities=function(cparr){
            cparr.forEach(cp=>{
                if(!cp.hasOwnProperty('vid')){
                    cp.vid = `${cp.id}_v${cp.version}`;
                }
                this.addCapability(cp);
            })
        }
        this.addCapability = function(cp){
            if(!cp.hasOwnProperty('id') || !cp.hasOwnProperty('version')){
                return;
            }
            _capabilities[cp.vid]=cp;
        }
        var _jsonclone = function (obj) {
            try {
                return JSON.parse(JSON.stringify(obj))
            } catch (err) {
                console.log(err)
                return {}
            }
        }

        this.loadCapabilities= function(){
            return new Promise((resolve,reject)=>{
                $.getJSON('/_SmartThings/capabilities').then(resolve,reject);
            })
        }
        this.loadPATs=()=>{
            return new Promise((resolve,reject)=>{
                $.getJSON('/_SmartThings/pats').then(resolve,reject);
            })
        }
        let _PATs={};
        this.validatePAT=function(pat){
            return SmartThingsApi.getCapability(pat,'switch',1);
        }
        this.addPATs=function(PATs){
            Object.assign(_PATs,PATs);
        }
        this.addpat = function(nodeId,pat,isRefresh){
            if(!pat){

                return Promise.reject(null);
            }
            if(!_PATs[pat]||isRefresh){
                return this.validatePAT(pat).then(()=>{
                    const PAT = {};
                    PAT.nodeIds = (_PATs[pat]&&_PATs[pat].nodeIds)?_PATs[pat].nodeIds:new Set();
                    const getLocationsPR = SmartThingsApi.getLocations(pat)
                        .then(locationsResult=>{
                            return Promise.allSettled(locationsResult.items
                                .sort((l1,l2) => l1.name.localeCompare(l2.name))
                                .map(location=>{
                                    return SmartThingsApi.getLocationsRooms(pat, location.locationId)
                                        .then(roomsResult => {
                                            location.rooms=roomsResult.items;
                                            location.rooms.sort((r1,r2)=> r1.name.localeCompare(r2.name))
                                            location.rooms.push({locationId:location.locationId,roomId:'undefined',name:"'undefined'"});
                                        })
                                }))
                                .then(()=>locationsResult.items)
                        })
                        .then(locations=>{
                            PAT.locations=locations;
                            return locations;
                        })

                    const getDevicesPR = SmartThingsApi.getDevices(pat)
                        .then(devicesResult=>{
                            return devicesResult.items
                                .map(d=>{
                                    return {
                                        deviceId:d.deviceId,
                                        name:d.label||d.name,
                                        locationId:d.locationId,
                                        roomId:d.roomId,
                                        components:d.components
                                    }
                                })
                        });

                    getDevicesPR.then(devices=>{
                        PAT.devices=devices;
                        PAT.customCps = PAT.devices.map(d=>d.components).flat()
                            .map(cmp=>cmp.capabilities).flat()
                            .map(cp=> cp.id+'_v'+cp.version)
                            .filter(cpId=>/\./.test(cpId))//only custom capabilities
                            .filter((cpId,idx,arr)=>arr.indexOf(cpId)==idx)//remove duplicate items
                            .sort();
                        return devices;
                    });

                    const getUnknownCapabilities = getDevicesPR
                        .then(devices=>{
                            var prs = devices.map(d=>d.components).flat()
                                .map(cmp=>cmp.capabilities).flat()
                                .filter(cp=>!SmartThingsProfiles.getCapability(cp.id+'_v'+cp.version))
                                .map(cp=>SmartThingsApi.getCapability(pat,cp.id,cp.version))
                            return Promise.allSettled(prs);
                        });

                    const addPATPromise=Promise.allSettled([getLocationsPR,getDevicesPR,getUnknownCapabilities])
                        .then(result=>{
                            if(PAT.devices){
                                _PATs[pat]=PAT;
                                this.PATmatchNode();
                                return Promise.resolve(PAT);
                            }else{
                                delete _PATs[pat];
                                return Promise.reject(result[1].value);
                            }
                        });
                    _PATs[pat]=addPATPromise;
                    if(RED.nodes.node(nodeId)){
                        RED.nodes.node(nodeId).PAT=this.getPAT(pat);
                    }
                    return addPATPromise;
                }).catch(e=>{
                    console.log('validate SmartThings AccessToken fail : '+e.statusText);
                    delete _PATs[pat];
                    return Promise.reject(null);
                })
            }else if(_PATs[pat]){
                return Promise.resolve(_PATs[pat]);
            }
        }
        this.hasPAT=(pat)=>{
            return !!_PATs[pat];
        }
        this.getPATs=()=>{
            return _PATs;
        }
        this.getpats=()=>{
            return Object.keys(_PATs);
        }
        this.getPAT=(pat)=>{
            if(_PATs[pat] && typeof _PATs[pat].then == 'function'){
                return _PATs[pat];
            }else if(_PATs[pat]){
                return Promise.resolve(_PATs[pat]);
            }else{
                return Promise.reject(undefined);
            }
        }
        this.PATremoveNodeId=(nodeId)=>{
            return Object.values(_PATs).forEach(PAT=>PAT.nodeIds?.delete(nodeId));
        }
        this.PATmatchNode=()=>{
            Object.keys(_PATs)
                .filter(pat=>_PATs[pat]&&_PATs[pat].nodeIds)
                .forEach(pat=>{
                    const PAT = _PATs[pat];
                    PAT.nodeIds.forEach(nodeId=>{
                        if(RED.nodes.node(nodeId)){
                            RED.nodes.node(nodeId).pat=pat;
                        }
                    })
                })
        }

    }

    var validateAutomationNext = function (id) {
        //Automation 뒤에는 on device(event) 만 올 수 있다 (input 1, 해당 input port 에 연결된 wires 도 하나)
        var backLinks = RED.nodes.filterLinks({"source": {"id": id}});
        if (backLinks.length != 1) return false;
        if (backLinks[0].target["type"] !== "event-device") return false;
        return true;
    }

    const SmartThingsProfiles = new Profiles();
    SmartThingsProfiles.loadPATs()
        .then(PATs=>{
            console.log('load SmartThings pat success');
            Object.values(PATs).forEach(PAT=>{
                if(PAT.nodeIdArr){
                    PAT.nodeIds = new Set(PAT.nodeIdArr)
                }
            })
            SmartThingsProfiles.addPATs(PATs);
        })
        .catch(e=>{console.warn('load pat fail : ',e.message||e)})
        .then(SmartThingsProfiles.loadCapabilities)
        .then((cps)=>{
            console.log('load SmartThings capabilities success');
            if(Object.values(cps).length>0){
                SmartThingsProfiles.setCapabilities(cps);
            }
        })
        .catch(e=>{console.warn('load capabilities fail : ',e.message||e)})

</script>

<!-- Node Common Script End-->

<!-- Node Script -->
<script type="text/javascript">
    // var loadingImage = $(`<img id="device-loading-img" src="/red/images/spin.svg" style="display:none;"></img>`)

    const ST_NODES_CATEGORY = "Samsung AutomationStudio"
    const ST_EVENT_DEVICE = "event-device";
    const ST_STATUS_DEVICE = "status-device";
    const ST_COMMAND_DEVICE = "command-device";
    const ST_DEVICE_PROFILE = 'device-profile';
    const ST_MY_DEVICE = 'installed-device';
    const ST_AUTOMATION = 'automation';
    const ST_DEVICE_NODES=[ST_EVENT_DEVICE,ST_STATUS_DEVICE,ST_COMMAND_DEVICE]
    const ST_NODES=[ST_AUTOMATION,ST_DEVICE_PROFILE,ST_MY_DEVICE,ST_EVENT_DEVICE,ST_STATUS_DEVICE,ST_COMMAND_DEVICE];
    // const ST_NODE_VERSION = 20210318
    var stDevice = {};

    function STRefCheck() {

        //import, broken reference fix
        const workspaceId = RED.workspaces.active();
        var hasBrokenRef = RED.nodes.filterNodes({z: workspaceId})
            .filter(n => ST_NODES.includes(n.type) && n._def?.defaults?.hasOwnProperty('profileId'))
            .some(n => n.id != n.profileId);
        if (hasBrokenRef) {
            var map = {}
            RED.nodes.filterNodes({z: workspaceId})
                .filter(n => ST_NODES.includes(n.type) && n._def?.defaults?.hasOwnProperty('profileId'))
                .forEach(n => {
                    if (!n.profileId) {
                        n.profileId = n.id;
                    }

                    if (map.hasOwnProperty(n.profileId)) {
                        n.profileId = n.id;
                    } else {
                        map[n.profileId] = n;
                    }
                })

            RED.nodes.filterNodes({z: workspaceId})
                .filter(n => ST_DEVICE_NODES.includes(n.type) && map.hasOwnProperty(n.deviceNodeId))
                .forEach(function (n) {
                    n.deviceNodeId = map[n.deviceNodeId].id;
                    RED.editor.validateNode(n);
                })

            for (var profId in map) {
                map[profId].profileId = map[profId].id;
            }
            RED.view.redraw();
        }

        //210318 STNode compatibility support
        RED.nodes.filterNodes({z:RED.workspaces.active(),type:ST_MY_DEVICE})
            .filter(n=> n.device && !n.devices)
            .forEach(n=> n.devices=[n.device.deviceId]);

        RED.nodes.filterNodes({z: workspaceId})
            .filter(n=>ST_DEVICE_NODES.includes(n.type))
            .filter(n=>n.deviceNodeId && !n.deviceId && RED.nodes.node(n.deviceNodeId))
            .forEach(n=>{
                const deviceNode = RED.nodes.node(n.deviceNodeId);
                if(deviceNode.type===ST_DEVICE_PROFILE){
                    n.deviceId=n.deviceNodeId;
                }else if(deviceNode.type===ST_MY_DEVICE){
                    n.deviceId=deviceNode.device?.deviceId||(deviceNode.devices?.lenght==1?deviceNode.devices[0]:'');
                }
            });

        //PAT put into node
        SmartThingsProfiles.PATmatchNode();
    }

    function PATchangeEvent(PAT,initValue){
        if(PAT && typeof PAT.then === 'function'){
            document.querySelector('.st_state').className = 'st_state st_state--loading';
            document.querySelector('.st_state').disabled=true;
            PAT.then((_PAT)=>{PATchangeEvent(_PAT,initValue)});
            return;
        }
        const cpCustomEl = document.querySelector('#node-input-capabilityId_custom');
        const stStateEL = document.querySelector('.st_state');
        stStateEL.classList.remove('st_state--loading');

        if(PAT){
            stStateEL.classList.add('st_state--valid');
            cpCustomEl.disabled=false;
            cpCustomEl.innerHTML = '';

            PAT.customCps
                .map(cpId=>cpId.slice(0,cpId.indexOf('.')))
                .filter((namespace,idx,arr)=>arr.indexOf(namespace)===idx)
                .sort()
                .forEach(namespace=>{
                    const optgroup = document.createElement('optgroup');
                    optgroup.label = namespace;
                    cpCustomEl.append(optgroup);
                })
            PAT.customCps
                .forEach(cpId=>{
                    const option = document.createElement('option');
                    option.value = cpId;
                    const tempId = cpId.split('_v')[0];
                    const tempVersion = cpId.split('_v')[1];
                    option.innerText = (tempVersion==1)?tempId:cpId;
                    const namespace = cpId.slice(0,cpId.indexOf('.'));
                    const optgroup = cpCustomEl.querySelector(`optgroup[label="${namespace}"]`);
                    optgroup.append(option);
                })

            if(initValue){
                cpCustomEl.value = initValue;
                cpCustomEl.dispatchEvent(new Event('change'));
            }
        }else{
            stStateEL.classList.remove('st_state--valid');
            cpCustomEl.disabled=true;
            cpCustomEl.innerHTML = '';
        }
    }
    RED.nodes.registerType('device-profile', {
        category: ST_NODES_CATEGORY,
        paletteLabel: "Device Profile",
        color: "rgb(168,168,168)",
        defaults: {
            name: {value: ""},
            alias:{value:""},//'name' is null, set automatically with properties;
            capabilityId: {value: "", required: true},
            profileId: {value:""},
            cpType:{value:'standard'},
            capabilityId_standard:{value:''},
            capabilityId_custom:{value:''}
        },
        credentials: {
            stAccessToken: {type: 'text'}
        },
        inputs: 0,
        outputs: 0,
        icon: "deviceprofile.png",
        label: function () {
            return this.name|| this.alias || "Device Profile";
        },
        oneditsave: function(){
            this.cpType = document.querySelector('input[name="cpType"]:checked').value||"standard";
            this.capabilityId = document.querySelector('#node-input-capabilityId_'+this.cpType).value;
            if(this.capabilityId){
                this.alias=this.capabilityId;
            }
        },
        oneditprepare: function () {
            STRefCheck();

            var NODE = this
            NODE.cpType=NODE.cpType||'standard';

            var patDatalist = document.getElementById('stAccessToken_datalist');
            const workspaceId = RED.workspaces.active();
            SmartThingsProfiles.getpats()
                .forEach(function(pat){
                    var option = document.createElement('option');
                    option.setAttribute('value',pat);
                    patDatalist.append(option);
                })

            //capabilityId_standard
            const cpStandardEl = document.querySelector('#node-input-capabilityId_standard');
            const liveGroupEl = document.createElement('optgroup');
            liveGroupEl.label = 'live/proposed';
            cpStandardEl.append(liveGroupEl)
            Object.values(SmartThingsProfiles.getAllCapabilities())
                .filter( cp => !!cp._custom === false)
                .sort((c1,c2)=>c1.vid.localeCompare(c2.vid))
                .forEach((cp) => {
                    const option = document.createElement('option');
                    option.value = cp.vid;
                    option.innerText = cp.vname||cp.name;

                    if (cp.status === 'live' || cp.status === 'proposed') {
                        liveGroupEl.append(option);
                    } else {
                        option.title = cp.status
                        let groupEl = document.querySelector(`optgroup[label="${cp.status}"]`);
                        if(!groupEl){
                            groupEl = document.createElement('optgroup');
                            groupEl.label = cp.status;
                            groupEl.disabled = true;
                            cpStandardEl.append(groupEl);
                        }
                        groupEl.append(option);
                    }
                })

            document.querySelector('.dp_cp').addEventListener('click',e=>{
                if(e.target.matches('.cp_type__option')||e.target.matches('input[name="cpType"]')){
                    var target = e.target;
                    if(e.target.matches('.cp_type__option')){
                        target = e.target.querySelector('input[name="cpType"]');
                        target.checked=true;
                    }
                    e.currentTarget.className = 'dp_cp cp_type--'+target.value;
                    document.querySelector(`#node-input-capabilityId_${target.value}`).dispatchEvent(new Event('change'));
                }
            })

            function changePAT(e,isRefresh){
                const pat = document.querySelector('#node-input-stAccessToken').value
                document.querySelector('.st_state').className = 'st_state st_state--loading';
                SmartThingsProfiles.addpat(NODE.id,pat,isRefresh).then(PATchangeEvent,PATchangeEvent);
            }
            document.querySelector('#node-input-stAccessToken').addEventListener('change',changePAT);
            document.querySelector('.st_state').addEventListener('click',(e)=>{changePAT(e,true)});


            function changeCapabilitySelect(e){
                const cp = SmartThingsProfiles.getCapability(e.target.value);
                const cpType = document.querySelector('input[name="cpType"]:checked').value;
                if(cpType==e.target.dataset.cptype){
                    if(cp){
                        document.querySelector('#dp_cp_spec__code').innerText = JSON.stringify(cp,function(k,v){return ['vid','vname'].includes(k)?undefined:v},2);
                    }else{
                        document.querySelector('#dp_cp_spec__code').innerText = 'select capability';
                    }
                }
            }
            document.querySelector('#node-input-capabilityId_custom').addEventListener('change',changeCapabilitySelect)
            document.querySelector("#node-input-capabilityId_standard").addEventListener('change',changeCapabilitySelect)

            //cp_type optino radio button
            document.querySelector('.dp_cp').className = 'dp_cp cp_type--'+NODE.cpType;
            document.querySelector('.cp_type input[type="radio"][value="'+NODE.cpType+'"]').checked=true;
            SmartThingsProfiles.getPAT(NODE.credentials?.stAccessToken).then(PAT=>{PATchangeEvent(PAT,NODE.capabilityId_custom || NODE.capabilityId)});
            cpStandardEl.value = NODE.capabilityId_standard||NODE.capabilityId;
            cpStandardEl.dispatchEvent(new Event('change'));
        }
    });

    RED.nodes.registerType('installed-device', {
        category: ST_NODES_CATEGORY,
        paletteLabel: "My Device",
        color: "rgb(231,147,173)",
        defaults: {
            name: {value: ''},
            alias: {value: ''},
            device: {value:''},
            devices: {value: null},
            profileId: {value:''}
        },
        credentials: {
            stAccessToken: {type: 'text', required: true, validate: (pat)=>SmartThingsProfiles.hasPAT(pat)}
        },
        inputs: 0,
        outputs: 0,
        icon: "mydevice.png",
        label: function () {
            return this.name|| this.alias || "My Device";
        },
        oneditsave: function () {
            if(document.querySelectorAll('#md_list .md_list__device.md_list__item--selected').length>0){
                this.devices = Array.from(document.querySelectorAll('#md_list .md_list__device.md_list__item--selected')).map(el=>el.dataset.deviceId);
            }
            const pat = document.querySelector('#node-input-stAccessToken').value
            if(pat){
                this.alias=`token:${pat.slice(0,8)}`;
                this.pat=pat;
                if(SmartThingsProfiles.hasPAT(pat)){
                    SmartThingsProfiles.getPAT(pat).then(PAT=>PAT.nodeIds.add(this.id))
                }
            }
        },
        oneditprepare: function () {
            //oneditprepare : init Elements -> set EventListeners -> set values
            const NODE = this;

            //profileId: DeviceNode 참조 backup ID
            STRefCheck();

            /*Element init*/
            const patDatalist = document.getElementById('stAccessToken_datalist');
            SmartThingsProfiles.getpats()
                .forEach(function(pat){
                    var option = document.createElement('option');
                    option.setAttribute('value',pat);
                    patDatalist.append(option);
                })

            if(NODE.credentials?.stAccessToken){
                const stateEl = document.querySelector('.st_state');
                stateEl.classList.add('st_state--loading');
                SmartThingsProfiles.getPAT(NODE.credentials.stAccessToken)
                    .then(PAT=>createMdList(PAT, NODE.devices))
                    .then(()=>{
                        stateEl.classList.add('st_state--valid');
                        stateEl.classList.remove('st_state--loading');
                    })
                    .catch(()=>{
                        stateEl.classList.remove('st_state--valid');
                        stateEl.classList.remove('st_state--loading');
                    })
            }

            function PATchangeEvent(e,isRefresh){
                const pat = document.querySelector('#node-input-stAccessToken').value;
                const stateEl = document.querySelector('.st_state');
                stateEl.classList.add('st_state--loading');
                document.querySelector('#md_list').innerHTML='';
                SmartThingsProfiles.addpat(NODE.id,pat,isRefresh)
                    .then(createMdList,createMdList)
                    .then(()=>{
                        stateEl.classList.add('st_state--valid');
                        stateEl.classList.remove('st_state--loading');
                    })
                    .catch(()=>{
                        stateEl.classList.remove('st_state--valid');
                        stateEl.classList.remove('st_state--loading');
                    })
            }
            document.querySelector('#node-input-stAccessToken').addEventListener('change',PATchangeEvent);
            document.querySelector('.st_state').addEventListener('click',(e)=>{PATchangeEvent(e,true)});
            document.querySelector('#md_list').addEventListener('click',e=>{
                if(e.target.matches('.md_list__item')){
                    e.target.classList.toggle('md_list__item--close');
                }else if(e.target.matches('input[type="checkbox"]') || e.target.matches('.md_list__device__cmp') || e.target.matches('.md_List__device__cps')){
                    const itemEl = e.target.parentElement;
                    const isSelected = itemEl.classList.toggle('md_list__item--selected');
                    itemEl.querySelector('input[type="checkbox"]').checked = isSelected;
                    itemEl.querySelectorAll('.md_list__item--show')
                        .forEach(el=>{
                            el.classList.toggle('md_list__item--selected',isSelected)
                            el.querySelector('input[type="checkbox"]').checked=isSelected;
                        });

                    refreshMdListStatus();
                }
            })

            function createLocationEl(location){
                const locationEl = document.querySelector('.md_list__location[data-location-id="'+location.locationId+'"]')||document.createElement('div');
                Object.assign(locationEl.dataset, {locationId:location.locationId,name:location.name});
                locationEl.className = `md_list__item md_list__location ${location.name==undefined?'md_list__item--unknown':''}`;
                locationEl.innerHTML=`<input type="checkbox"> ${location.name} <i class="fa fa-angle-down"></i>`;
                return locationEl;
            }
            function createRoomEl(room){
                const roomEl = document.querySelector(`.md_list__room[data-location-id="${location.locationId}"][data-room-id="${room.roomId}"]`)|| document.createElement('div');
                Object.assign(roomEl.dataset,{locationId:room.locationId,roomId:room.roomId,name:room.name});
                roomEl.className = `md_list__item md_list__room ${room.name==undefined?'md_list__item--unknown':''}`;
                roomEl.innerHTML=`<input type="checkbox"> ${room.name} <i class="fa fa-angle-down"></i>`;
                return roomEl;
            }
            function createDeviceEl(device){
                const deviceEl = document.createElement('div');
                Object.assign(deviceEl.dataset,{locationId:device.locationId,roomId:device.roomId,deviceId:device.deviceId,name:device.name});
                deviceEl.className= 'md_list__item md_list__device md_list__item--close md_list__item--show';
                deviceEl.innerHTML=`<input type="checkbox" class="md_list__device__check" data-device-id="${device.deviceId}"> ${device.name} <i class="fa fa-angle-down"></i>`;

                device.components.forEach(cmp=>{
                    const cmpEl = document.createElement('div');
                    cmpEl.className = 'md_list__device__cmp';
                    cmpEl.innerText = cmp.id;
                    deviceEl.append(cmpEl);

                    if(cmp.capabilities){
                        const cpEl = document.createElement('div');
                        cpEl.className = 'md_List__device__cps';
                        cpEl.innerText = cmp.capabilities.map(cp=> cp.version===1?cp.id:cp.vid).join(', ');
                        deviceEl.append(cpEl);
                    }
                })
                return deviceEl;
            }
            function createMdList(PAT,selectedDevices){
                if(!PAT){return Promise.reject(null);}
                document.querySelector('.st_state').classList.add('st_state--loading');
                if(PAT && typeof PAT.then == 'function'){
                    return PAT.then((_PAT)=>{createMdList(_PAT,selectedDevices)},createMdList);
                }

                const mdContainerEl = document.querySelector('#md_list');
                document.querySelector('.st_state').classList.remove('st_state--loading');
                if(PAT.devices){
                    if(PAT.locations){
                        PAT.locations.map(location=>{
                            const locationEl = createLocationEl(location);
                            mdContainerEl.append(locationEl);
                            location.rooms.forEach(function(room,roomIdx){
                                locationEl.append(createRoomEl(room));
                            })
                        })
                    }

                    PAT.devices.forEach(function(device){
                        let locationEl = document.querySelector(`.md_list__location[data-location-id="${device.locationId}"]`);
                        let roomEl = document.querySelector(`.md_list__room[data-location-id="${device.locationId}"][data-room-id="${device.roomId}"]`);

                        if(!locationEl){
                            locationEl = createLocationEl({locationId:device.locationId});
                            mdContainerEl.append(locationEl);
                        }
                        if(!roomEl){
                            roomEl = createRoomEl({locationID:device.locationId, roomId:device.roomId});
                            locationEl.append(roomEl);
                        }
                        roomEl.append(createDeviceEl(device));
                    })

                    if(selectedDevices){
                        selectedDevices.forEach(deviceId=>{
                            document.querySelectorAll(`.md_list div.md_list__device[data-device-id="${deviceId}"]`).forEach(el=>{
                                el.classList.add('md_list__item--selected');
                                el.querySelector('input[type="checkbox"]').checked=true;
                            });
                        })
                    }else{
                        document.querySelectorAll('.md_list div.md_list__device')
                            .forEach(el=>{
                                el.classList.add('md_list__item--selected');
                                el.querySelector('input[type="checkbox"]').checked=true;
                            });
                    }
                    refreshMdListStatus();
                    return Promise.resolve();
                }else{
                    const emptyEl = document.createElement('div');
                    emptyEl.className = 'md_list__empty';
                    emptyEl.innerText = 'Cannot get Devices with Access Token';
                    mdContainerEl.append(emptyEl);
                    refreshMdListStatus();
                    return Promise.reject('Cannot get Devices with Access Token');
                }
            }
            function refreshMdListStatus(){
                const listShowCnt = document.querySelectorAll('.md_list__device.md_list__item--show').length;
                const listShowSelectedCnt = document.querySelectorAll('.md_list__device.md_list__item--show.md_list__item--selected').length;
                document.querySelector('.md_header__cnt').innerText = `${listShowCnt} devices, ${listShowSelectedCnt} selected`;
                document.querySelectorAll('#md_list .md_list__location,#md_list .md_list__room')
                    .forEach(el=>{
                        const showCnt = el.querySelectorAll('.md_list__device.md_list__item--show').length;
                        const showSelectedCnt = el.querySelectorAll('.md_list__device.md_list__item--show.md_list__item--selected').length;

                        el.classList.toggle('md_list__item--show',showCnt>0);
                        if(showCnt == showSelectedCnt){
                            el.querySelector('input[type="checkbox"]').checked=true;
                            el.classList.add('md_list__item--selected');
                        }else{
                            el.querySelector('input[type="checkbox"]').checked=false;
                            el.classList.remove('md_list__item--selected');
                        }
                    })
            }

            var mdListSearch=function (e){
                if(e.target.value){
                    document.querySelectorAll('#md_list div.md_list__device').forEach(el=>{
                        var matched = el.dataset.name.includes(e.target.value)||el.querySelector('.md_List__device__cps').innerText.includes(e.target.value);
                        el.classList.toggle('md_list__item--show',matched);
                    })
                }else{
                    document.querySelectorAll('#md_list div.md_list__device').forEach(el=>el.classList.toggle('md_list__item--show',true));
                }
                refreshMdListStatus();
            }
            document.querySelector('#md_header__search').addEventListener('change',mdListSearch);
            document.querySelector('#md_header__search').addEventListener('keydown',(e) => {
                if (e.keyCode === 13) {
                    mdListSearch(e);
                    e.preventDefault();
                }
            })
        }
    });

    RED.nodes.registerType('automation', {
        category: ST_NODES_CATEGORY,
        color: "rgb(80, 196, 253)",
        defaults: {
            name: {value: ""},
            alias: {value: ""},
            method: {value: 'post'},
            url: {
                value: "",
                required: true
            },
            urlDate: {value: ""},
            eqtype: {
                value: "", validate: function (v) {
                    return validateAutomationNext(this.id);
                }
            },
            loggingEditor:{value:false},
            loggingConsole:{value:false}
        },
        inputs: 0,
        outputs: 1,
        icon: "smartapp.png",
        label: function () {
            return this.name|| this.alias || "Automation";
        },
        paletteLabel: "Automation",
        oneditprepare: function () {
            var NODE = this;
            var $inputUrl = $('#node-input-url')

            RED.popover.create({
                target: $('#export-clipboard'),
                content: 'copied',
                trigger: 'click',
                autoClose: 2000,
                direction: 'right',
                delay: {show: 750, hide: 2000}
            });
            var copyurl = window.location.origin + $inputUrl.val()
            if (copyurl == undefined || copyurl == "") {
                $("#node-input-copyurl").val(window.location.origin);
            } else {
                $("#node-input-copyurl").val(window.location.origin + $inputUrl.val());
            }

            var validateUrl = function(){
                var url = $inputUrl.val()||""
                url=url.replace(/[^a-zA-Z0-9\-\_\/]/gi,'')
                url=url.replace(/[\/]{2,}/gi,'/')
                if(url.charAt(0)!='/'){
                    url='/'+url
                }
                $inputUrl.val(url)
                $("#node-input-copyurl").val(window.location.origin + $inputUrl.val());
            }
            $inputUrl.on("keyup", validateUrl);
            $inputUrl.on("focusin", validateUrl);

            //if safari, hide clipboard button
            if (!document.queryCommandSupported("copy")) {
                $("#node-input-copyurl").parent().closest('div').css('right', '0px');
                $("#export-clipboard").hide();
            } else {
                $("#node-input-copyurl").parent().closest('div').css('right', '40px');
                $("#export-clipboard").show();
                $("#export-clipboard").on("click", function () {
                    RED.clipboard.copyText($("#node-input-copyurl").val());
                });
            }
        },
        oneditsave: function () {
            var NODE = this;
            NODE.method = 'post'
            NODE.name = $("#node-input-name").val().trim();
            if (NODE.url != $("#node-input-url").val().trim()) {
                NODE.urlDate = new Date().getTime()
                NODE.url = $("#node-input-url").val().trim()
            }
        }
    });

    var operator = {
        string: [
            {v: "eq", t: "=="},
            {v: "neq", t: "!="}
        ],
        array: [
            {v: "in", t: "contains"},
            {v: "nin", t: "not contains"}
        ],
        integer: [
            {v: "eq", t: "=="},
            {v: "neq", t: "!="},
            {v: "lt", t: "<"},
            {v: "lte", t: "<="},
            {v: "gt", t: ">"},
            {v: "gte", t: ">="}
        ],
        number: [
            {v: "eq", t: "=="},
            {v: "neq", t: "!="},
            {v: "lt", t: "<"},
            {v: "lte", t: "<="},
            {v: "gt", t: ">"},
            {v: "gte", t: ">="}
        ],
        object: [
            {v: "o_eq", t: "all values equal"},
            {v: "o_neq", t: "all values not equal"}
        ],
        boolean: [
            {v: "eq", t: "=="},
            {v: "neq", t: "!="}
        ],
        Iso8601Date: [
            {v: "eq", t: "=="},
            {v: "neq", t: "!="},
            {v: "lt", t: "<"},
            {v: "lte", t: "<="},
            {v: "gt", t: ">"},
            {v: "gte", t: ">="}
        ],
        json: [
            {v: "o_eq", t: "all values equal "},
            {v: "o_neq", t: "all values not equal"}
            // {v: "o_include", t: "include"}
        ]
    }

    function DeviceNodeEventHandler(formObj, NODE) {
        // console.log('init NODE Event Handler : ',JSON.stringify(NODE));
        var THING = this;
        THING.node = NODE;
        THING.type = NODE.type;
        THING.form = formObj;
        THING.target = (NODE.type == ST_COMMAND_DEVICE) ? "commands" : "attributes"
        THING.device={}

        THING.initDeviceSelect = function (initDeviceNodeId,initDeviceId) {
            const stateEl = document.querySelector('.st_state')
            stateEl.classList.add('st_state--loading');

            const deviceIdEl = document.querySelector('#node-input-deviceId');
            deviceIdEl.innerHTML='';

            const dpGroupEl = document.createElement('optgroup');
            dpGroupEl.label='Device Profile';
            deviceIdEl.append(dpGroupEl);

            const mdGroupEl = document.createElement('optgroup');
            mdGroupEl.label='My-Device';
            deviceIdEl.append(mdGroupEl);

            const disGroupEl = document.createElement('optgroup');
            disGroupEl.label='Disabled';
            disGroupEl.disabled=true;
            deviceIdEl.append(disGroupEl);

            const target = (NODE.type == ST_COMMAND_DEVICE) ? "commands" : "attributes";
            const addOptionEl = function(node){
                if(document.querySelector(`#node-input-deviceId option[value="${node.device.deviceId}"]`)){
                    return;
                }
                const opEl = document.createElement('option');
                opEl.value = node.device.deviceId||node.id;
                opEl.dataset.device=JSON.stringify(node.device);
                opEl.dataset.deviceNodeId=node.id;
                opEl.dataset.deviceType=node.type;
                opEl.innerText = node.device.name||node.name||node.alias;

                const isValidType = (NODE.type===ST_EVENT_DEVICE)?node.type==ST_DEVICE_PROFILE:true;
                const hasTarget = node.device.components.map(cmp=>cmp.capabilities).flat().some( _cp => {
                    const vid = _cp.vid||`${_cp.id}_v${_cp.version}`;
                    const cp = SmartThingsProfiles.getCapability(vid);
                    return cp && cp.hasOwnProperty(target) && Object.keys(cp[target]).length>0
                })
                if(isValidType && hasTarget && node.type==ST_DEVICE_PROFILE){
                    dpGroupEl.append(opEl);
                }else if(isValidType && hasTarget && node.type==ST_MY_DEVICE){
                    mdGroupEl.append(opEl);
                }else{
                    let title = [];
                    if(!isValidType){
                        title.push('Event Node cannot use My-Device Node');
                    }
                    if(!hasTarget){
                        title.push('no '+target)
                    }
                    disGroupEl.title = title.join('\n');
                    disGroupEl.append(opEl);
                }
            }
            RED.nodes.filterNodes({z: this.node.z, type: ST_DEVICE_PROFILE})
                .map(function(node){
                    var id = node.capabilityId.split('_v')[0]
                    var version = node.capabilityId.split('_v')[1]||1
                    var vid = id+'_v'+version
                    node.device={components:[{id:"main",capabilities:[{id:id,version:version,vid:vid}]}]}
                    return node;
                })
                .forEach(addOptionEl);

            const mydevicePrs = RED.nodes.filterNodes({z: this.node.z, type: ST_MY_DEVICE})                
                .filter(mdNode=> mdNode.pat)
                .map(mdNode=>
                    SmartThingsProfiles.getPAT(mdNode.pat)
                        .then(PAT => PAT.devices.filter(dvc=>mdNode.devices===null||mdNode.devices?.includes(dvc.deviceId))
                            .sort((d1,d2)=>d1.name.localeCompare(d2.name))
                            .map(dvc=>{return {id:mdNode.id,type:mdNode.type,device:dvc}})
                            .forEach(addOptionEl)
                        )
                );
            Promise.allSettled(mydevicePrs)
                .finally(()=>{
                    if(initDeviceNodeId){
                        document.querySelector('#node-input-deviceNodeId').value=initDeviceNodeId;
                    }
                    if(initDeviceId){
                        deviceIdEl.value = initDeviceId;
                        const selectedOption = deviceIdEl.selectedOptions[0];
                        if(selectedOption){
                            document.querySelector('#node-input-deviceNodeId').value = selectedOption.dataset?.deviceNodeId;
                            NODE.device = (selectedOption.dataset?.device)?JSON.parse(selectedOption.dataset.device):null;
                            NODE.deviceType = selectedOption.dataset?.deviceType;
                        }
                    }

                    Array.from(document.querySelectorAll('#node-input-deviceId optgroup'))
                        .filter(el=>el.querySelectorAll('option').length==0)
                        .forEach(el=>el.classList.add('optgroup--hide'));

                    stateEl.classList.remove('st_state--loading');

                    THING.initCapabilitySelect(THING.node.componentId, THING.node.capabilityId);
                    THING.initAttributeSelect(THING.node.attributeId);
                    THING.initAttributeContainer(THING.node.rules);
                });
            deviceIdEl.addEventListener('change',e=>{
                const selectedOption = e.target.selectedOptions[0];
                if(selectedOption){
                    document.querySelector('#node-input-deviceNodeId').value = selectedOption.dataset?.deviceNodeId;
                    NODE.device = JSON.parse(selectedOption.dataset?.device);
                    NODE.deviceType = selectedOption.dataset?.deviceType;
                }
                THING.initCapabilitySelect();
                THING.initAttributeSelect();
                THING.initAttributeContainer();
            })
        }
        //deviceid 선택시 해당 section 정보를 셋팅한다.
        THING.initCapabilitySelect = function (initComponentId, initCapabilityId) {
            initComponentId=initComponentId||'main';

            var capabilityIdSelect = this.form.capabilityId;
            capabilityIdSelect.html('');
            const devicestr = document.querySelector('#node-input-deviceId')?.selectedOptions[0]?.dataset?.device;
            const device = devicestr?JSON.parse(devicestr):devicestr;
            if(device && device.isLoading){
                capabilityIdSelect.attr('disabled', true)
                return
            }
            if (device && device.components && device.components.some(cmp=>cmp.capabilities)) {
                var target = this.node.target;
                device.components.forEach(cmp=>{
                    const groupEl = document.createElement('optgroup');
                    groupEl.label = cmp.id;
                    capabilityIdSelect.append(groupEl);
                    cmp.capabilities.sort(function(c1,c2){
                        return c1.id.localeCompare(c2.id)
                    }).filter(function (_cp) {
                        _cp.vid=_cp.vid||`${_cp.id}_v${_cp.version}`;
                        var cp = SmartThingsProfiles.getCapability(_cp.vid)
                        if (cp && cp.hasOwnProperty(target) && Object.keys(cp[target]).length>0) {
                            const optionEl = document.createElement('option');
                            optionEl.value=cp.vid;
                            optionEl.innerText = cp.id;
                            optionEl.dataset.componentId=cmp.id;
                            groupEl.append(optionEl);
                        }
                        // locate disable options at the end;
                        return !(cp && cp.hasOwnProperty(target) && Object.keys(cp[target]).length>0);
                    })
                        .forEach(_cp=>{
                            var cp = SmartThingsProfiles.getCapability(_cp.vid);
                            var disableMsg='';
                            if(!cp){
                                disableMsg = 'undefined capability, '+_cp.vid;
                            }else{
                                disableMsg = 'no '+target;
                            }

                            const optionEl = document.createElement('option');
                            optionEl.title=disableMsg;
                            optionEl.innerText=cp.id;
                            optionEl.disabled=true;
                            groupEl.append(optionEl);
                        });
                });

                capabilityIdSelect.removeClass("input-error");
                if (capabilityIdSelect.find('option').length <= 1) {
                    capabilityIdSelect.attr('disabled', true);
                } else {
                    capabilityIdSelect.attr('disabled', false);
                }

                capabilityIdSelect.find('option:first').attr("selected", true);
            } else {
                this.form.deviceId.addClass("input-error");
            }
            capabilityIdSelect.change((e)=>{
                document.querySelector('#node-input-componentId').value = e.target.selectedOptions[0]?.dataset.componentId;
                THING.initAttributeSelect();
                THING.initAttributeContainer();
            })
            if (initCapabilityId && document.querySelector(`#node-input-capabilityId option[data-component-id="${initComponentId}"][value="${initCapabilityId}"]`)) {
                document.querySelector(`#node-input-capabilityId option[data-component-id="${initComponentId}"][value="${initCapabilityId}"]`).selected=true;
            }
        }
        //capability attr 셀렉트박스구성
        THING.initAttributeSelect = function (initAttributeId) {
            var attributeIdSelect = this.form.attributeId
            attributeIdSelect.html('');

            var selectedCapabilityId = this.form.capabilityId.find("option:selected").val();

            //capability의 attributes 및 commands 정보 조회
            var capability = SmartThingsProfiles.getCapability(selectedCapabilityId);
            if (capability && capability.hasOwnProperty(this.target) ) {
                Object.keys(capability[this.target]).forEach(function (attributeId) {
                    attributeIdSelect.append($("<option></option>").val(attributeId).text(attributeId));
                })
            }

            if (attributeIdSelect.find('option').length <= 1) {
                attributeIdSelect.attr('disabled', true)
                attributeIdSelect.attr('readonly', true)
            } else {
                attributeIdSelect.attr('readonly', false)
                attributeIdSelect.attr('disabled', false)
            }
            if (initAttributeId && attributeIdSelect.find('option[value="'+initAttributeId+'"]').length>0) {
                attributeIdSelect.val(initAttributeId)
            }
        }
        THING.initContainer = function(){
            $("#cmd-list-container").css('min-height', '150px').css('min-width', '150px').editableList({
                addButton: false,
                addItem: function (container, idx, data) {
                    var capabilityId = $("#node-input-capabilityId option:selected").val()
                    var commandId = $("#node-input-attributeId option:selected").val()
                    var arguments = SmartThingsProfiles.getCommandArguments(capabilityId, commandId)

                    var row = $('<div/>', {style: "margin-left:10px;height: auto;"}).appendTo(container);
                    $('<span>', {class: "capaId"}).appendTo(row).text(capabilityId)
                    $('<span style="font-size: 20px; font-weight: bold;">.</span>').appendTo(row)
                    $('<span>', {class: "attrId"}).appendTo(row).text(commandId)
                    var argNames = arguments.map(function (arg) {
                        return arg.name
                    }).join(', ')
                    $('<span>').appendTo(row).text(' ( ' + argNames + ' )')

                    if (arguments.length > 0) {
                        arguments.forEach(function (arg) {
                            if(arg.schema.title=='Iso8601Date'){
                                arg.schema.type='Iso8601Date'
                            }else if(arg.schema.title=='JsonObject'){
                                arg.schema.type='json'
                            }else if(arg.schema.type==='object' && (!arg.schema.hasOwnProperty('properties') && arg.schema.title != 'COLOR_MAP' ) ){
                                arg.schema.type='json'
                            }

                            var row2 = $('<div/>', {style: "height:auto;margin:15px 5px 5px auto;width:100%;display:flex;align-items:center;justify-content:flex-end;"}).appendTo(row)
                            createValueField2(arg.schema,row2,{valueName:arg.name,rowName:arg.name,width:'50%'})
                        })
                    }

                    if (data && data.args) {
                        data.args.forEach(function (arg) {
                            var valueField
                            if(arg.hasOwnProperty('propId')){
                                valueField = container.find('.argValue[argName='+arg.name+'][propId='+arg.propId+']')
                            }else{
                                valueField = container.find('.argValue[argName=' + arg.name + ']')
                            }
                            if (valueField.hasClass('red-ui-typedInput')) {
                                valueField.typedInput('value', arg.value)
                            } else {
                                valueField.val(arg.value)
                            }
                        })
                    }

                    if ($("#cmd-list-container").editableList('items').length > 1) {
                        $("#cmd-list-container").find(".outputSpan").remove();
                    }

                },
                resizeItem: function (container) {
                },
                removeItem: function (opt) {
                },
                sortItems: function (rules) {
                },
                sortable: false,
                removable: false
            });

            var emptymsg =null
            if(THING.node.type===ST_STATUS_DEVICE){
                emptymsg = "There is no filter, whole device status response will be sent"
            }

            $("#attr-list-container").css('min-height', '150px').css('min-width', '150px').editableList({
                addButton: "Add Filter",
                emptyMessage: emptymsg,
                // header: $("<div>").append($('<span style="position:absolute;right:2em;""><i class="fa fa-info-circle" aria-hidden="true"></i>  No Filter : msg.payload = whole device status response</span>')),
                addItem: function (itemRow, idx, data) {
                    if(data.type === 'empty'){
                        $(itemRow).parent().html('').append(data.msg)
                        // $(container).append(data.msg)
                        return;
                    }
                    var capabilityId = $("#node-input-capabilityId option:selected").val()
                    var attributeId = $("#node-input-attributeId option:selected").val()
                    var attribute = SmartThingsProfiles.getAttributeSchema(capabilityId, attributeId)

                    var row = $('<div/>', {style: "height: auto;margin:5px 0 5px 0;"}).appendTo(itemRow);

                    var attributeIdField = $('<input/>', {
                        class: "attrId ruleField",
                        capaId: capabilityId,
                        style: "width:auto; margin-right:5px;max-width:30%",
                        type: "text",
                        readonly: "true"
                    }).appendTo(row).val(attributeId)

                    var valueProperty = attribute.properties.value
                    var unitProperty = attribute.properties.unit

                    itemRow.data('data',{capaId:capabilityId,attrId:attributeId,valueType:valueProperty.type})
                    var ruleSpan = $('<span></span>').appendTo(row)
                    createRuleFields(valueProperty,unitProperty,ruleSpan,data)

                    if(itemRow.find('.ruleField').length>3){
                        itemRow.find('.attrId').css('width','20%')
                    }
                },
                resizeItem: function (container) {
                },
                removeItem: function (opt) {
                },
                sortItems: function (rules) {
                },
                sortable: true,
                removable: true
            });
            function createRuleFields(valueProperty,unitProperty,row,data){

                if(valueProperty.title=='Iso8601Date'){
                    valueProperty.type='Iso8601Date'
                }else if(valueProperty.title=='JsonObject'){
                    valueProperty.type='json'
                }else if(valueProperty.type==='object' && (!valueProperty.hasOwnProperty('properties') && valueProperty.title != 'COLOR_MAP' ) ){
                    valueProperty.type='json'
                }
                //oepratorField
                var operatorField = createOperatorField(valueProperty.type).appendTo(row)

                //attribute properties.value
                //typedInput 사용하려면 row에 html 추가된 상태여야함
                var valueField = createValueField2(valueProperty,row)

                //'unit' always has string enum
                var unitField =null
                if (unitProperty && unitProperty.enum) {
                    unitField = createUnitField(unitProperty).appendTo(row);
                }

                if (data) {
                    data.operator && operatorField.val(data.operator)
                    if(data.value){
                        if(data.valueType === 'object' && typeof data.value === 'object'){
                            Object.keys(data.value).forEach(function(propId){
                                var valueField = row.find('.valueField[propId='+propId+']')
                                if(valueField.prop('tagName')=='INPUT'){
                                    valueField.typedInput('value',data.value[propId])
                                }else{
                                    valueField.val(data.value[propId])

                                }
                            })
                        }else{
                            if (valueField[0].prop('tagName') == 'INPUT') {
                                valueField[0].typedInput('value', data.value)
                            } else {
                                valueField[0].val(data.value)
                            }
                        }
                    }
                    // data.value && valueField.find('.attrValue').val(data.value)
                    data.unit && unitField && unitField.val(data.unit)
                }
            }
            function createOperatorField(valueType){
                var operatorField = $('<select/>', {class: "attrOperator ruleField", style: "width:auto; margin-right: 5px; text-align: center;max-width:25%"})
                if (operator[valueType]) {
                    operator[valueType].forEach(function (op) {
                        operatorField.append($("<option></option>").val(op.v).text(op.t))
                    })
                }
                return operatorField
            }
            function createValueField2(valueProp,row,option){
                if(valueProp.title=='Iso8601Date'){
                    valueProp.type='Iso8601Date'
                }else if(valueProp.title=='JsonObject'){
                    valueProp.type='json'
                }else if(valueProp.type==='object' && (!valueProp.hasOwnProperty('properties') && valueProp.title != 'COLOR_MAP' ) ){
                    valueProp.type='json'
                }

                option=option || {}
                if(option.rowName){
                    row.text(option.rowName + ' : ')
                }
                var valueField=null
                if (valueProp.enum || (valueProp.type == 'array' && valueProp.items && valueProp.items.enum)) {
                    valueField = $("<select/>").appendTo(row)
                    if(option.hasOwnProperty('propId')){
                        valueField.append($("<option></option>").val('').text(''))
                    }
                    var enums = valueProp.enum || valueProp.items.enum
                    enums.forEach(function (value) {
                        valueField.append($("<option></option>").val(value).text(value))
                    })
                }else if (valueProp.type == 'string' ) {
                    var holder = valueProp.type||''
                    if(valueProp.hasOwnProperty('maxLength')){
                        holder += ', maxLength:'+valueProp.maxLength
                    }
                    valueField = $("<input/>",{placeholder:holder})
                        .appendTo(row)
                        .typedInput({default: "str", types: ["str"]})

                }else if(valueProp.type == 'number' || valueProp.type == 'integer'){
                    var holder = valueProp.title||valueProp.type||''
                    if (valueProp.hasOwnProperty('minimum') || valueProp.hasOwnProperty('maximum')||valueProp.hasOwnProperty('min')||valueProp.hasOwnProperty('max')) {
                        holder += '('
                        holder += valueProp.hasOwnProperty('minimum') ? valueProp.minimum : (valueProp.hasOwnProperty('min')?valueProp.min:' ')
                        holder += '~'
                        holder += valueProp.hasOwnProperty('maximum') ? valueProp.maximum : (valueProp.hasOwnProperty('max')?valueProp.max:' ')
                        holder += ')'
                    }
                    valueField = $("<input/>", {placeholder:holder})
                        .appendTo(row)
                        .typedInput({default: "num", types: ["num"]})

                }else if (valueProp.type == 'array') {
                    if(Array.isArray(valueProp.items)){
                        throw new Error('unknown data schema, typeof array.items == array')
                    }else if(typeof valueProp.items === 'object'){
                        return createValueField2(valueProp.items,row)
                    }else{
                        throw new Error('unknown data schema '+valueProp.type)
                    }
                }else if (valueProp.type == 'boolean') {
                    valueField = $("<select/>").appendTo(row)
                    if(option.hasOwnProperty('propId')){
                        valueField.append($("<option></option>").val('').text(''))
                    }
                    valueField.append($("<option></option>").val('true').text('true'))
                    valueField.append($("<option></option>").val('false').text('false'))
                    if(valueProp.default){
                        valueField.val(''+valueProp.default)
                    }
                } else if (valueProp.type == 'vector3') {
                    //TODO : vector type
                    throw new Error('vector data type')
                } else if (valueProp.type == 'json') {
                    valueField = $("<input/>",{placeholder:'Json Object'})
                        .appendTo(row)
                        .typedInput({default: "json", types: ["json"]})

                } else if (valueProp.type == 'Iso8601Date') {
                    var holder = ''
                    valueField = $("<input/>",{placeholder:holder})
                        .appendTo(row)
                        .typedInput({default: "str", types: ["str"]})

                    valueField.typedInput('value',new Date().toISOString().substr(0,19)+'Z')
                    //TODO : pattern valid check
                } else if (valueProp.type == 'object') {
                    if(valueProp.title ==='COLOR_MAP'){
                        valueField = $("<input/>", {
                            argName: "color",
                            argType: "object",
                            propId: 'hex',
                            propType: 'string',
                            class: 'argValue',
                            type: 'color',
                            value: "#3366ff",
                            style: "width:50%;margin-right:5px;"
                        }).appendTo(row)
                        Object.assign(option,{valueName: "color",valueType: "object",propId: 'hex',propType: 'string',})
                        // }else if(valueProp.){//TODO : threeAxis vector
                        //
                    }else if (valueProp.hasOwnProperty('properties')){
                        var fields=[]
                        Object.keys(valueProp.properties).forEach(function(k){
                            var row2 = $('<div style="display:flex;align-items:center;justify-content:flex-end;"></div>').appendTo(row)
                            Object.assign(option,{valueType:valueProp.type,propId:k,propType:valueProp.properties[k].type,rowName:k})
                            fields.concat(createValueField2(valueProp.properties[k],row2,option))
                        })
                        return fields
                    }else {
                        var holder = valueProp.title || valueProp.type || ''
                        valueField = $("<input/>", {placeholder: holder}).appendTo(row)
                        valueField.typedInput({default: "str", types: ["str"]})
                        // throw new Error('unknown data schema, '+valueProp.type+' unkwon')
                        console.error('unknown data schema, '+valueProp.type+' unknown')
                    }
                } else {
                    throw new Error('unknown data schema')
                }
                valueField.addClass('argValue valueField')
                valueField.css('margin-right','5px')
                if(option.hasOwnProperty('propId')){
                    valueField.attr('propId',option.propId)
                }
                try{
                    valueField.typedInput('width',option.width||'40%')
                }catch(e){
                    valueField.css('width',option.width||'40%')
                }
                valueField.data('data',Object.assign({valueType:valueProp.type},option))

                valueField.attr('argName',option.valueName)
                if(option.hasOwnProperty('propId')){
                    valueField.attr('propId',option.propId)
                }

                if(Array.isArray(valueField)){
                    return valueField
                }else{
                    return [valueField]
                }
            }

            function createUnitField(unitProp){
                var unitField = null
                if (unitProp && unitProp.hasOwnProperty('enum')) {
                    unitField = $("<select/>", {class: 'attrUnit ruleField', style: "width:auto;margin-right:5px;"})
                    unitProp.enum.forEach(function (value) {
                        unitField.append($('<option>').val(value).text(value))
                    })
                    if (unitProp.default) {
                        unitField.val(unitProp.default)
                    }
                }
                return unitField
            }
            if(THING.node.type===ST_STATUS_DEVICE && $("#attr-list-container").length>0){
                var msg1 = $('<span style="position:absolute;right:2em;""><i class="fa fa-info-circle" aria-hidden="true"></i>  No Filter : msg.payload = whole device status response</span>')
                $('#dialog-form > div.form-row.sensor-container-row > div > a').after(msg1)
            }
        }
        //type값에 따른 페이지 초기화 함수
        THING.initAttributeContainer = function (rules) {
            this.form.container.editableList('empty')

            if (rules && rules.length) {
                for (var i = 0; i < this.node.rules.length; i++) {
                    var data = this.node.rules[i];
                    if (data.isInit) break;
                    if(!data.capaId.includes('_v')){
                        data.capaId+='_v1';
                    }
                    if(data.capaId == this.form.capabilityId.val() && data.attrId == this.form.attributeId.val()){
                        this.form.container.editableList('addItem', data);
                    }
                }
            }

            if (this.form.attributeId.val() && this.form.container.editableList('items').length == 0) {
                if(THING.node.type!=ST_STATUS_DEVICE){//test_code
                    this.form.container.editableList('addItem')
                }
                // this.form.container.editableList('addItem',{type:'empty',msg:'no condition, send whole device status response'})
            }
        }

        THING.initContainer()

        THING.initDeviceSelect(NODE.deviceNodeId,NODE.deviceId);


        THING.form.attributeId.on("mouseover", function () {
            THING.form.attributeId.off("change")
            THING.form.attributeId.on("change", function () {
                THING.initAttributeContainer()
            })
        })
    };

    //convert RGB value to HSL value
    function rgbToHsl(hex) {
        if (/^#[0-9a-f]{6}$/g.test(hex) == false) {
            return {hue: 0, saturation: 0, lightness: 0}
        }
        var r = parseInt(hex.substring(1, 3), 16) / 255
        var g = parseInt(hex.substring(3, 5), 16) / 255
        var b = parseInt(hex.substring(5, 7), 16) / 255
        var max = Math.max(r, g, b)
        var min = Math.min(r, g, b)
        var hue
        if (max == min) {
            hue = 0
        } else if (r == max) {
            hue = 0 + (g - b) / (max - min)
        } else if (g == max) {
            hue = 2 + (b - r) / (max - min)
        } else {
            hue = 4 + (r - g) / (max - min)
        }
        hue *= 60

        var lightness = (max + min) / 2

        var saturation
        if (lightness == 0 || lightness == 1) {
            saturation = 0
        } else {
            a1 = 2 * (max - lightness)
            a2 = 1 - Math.abs(2 * lightness - 1)
            saturation = a1 / a2
        }

        hue = Math.round(hue / 360 * 100)
        saturation = Math.round(saturation * 100)
        lightness = Math.round(lightness * 100)
        return {hex: hex, hue: hue, saturation: saturation, lightness: lightness}
    }

    RED.nodes.registerType('event-device',{
        paletteLabel : "Event",
        color : "rgb(113,179,145)",
        icon : "st-event.png",
        category: ST_NODES_CATEGORY,
        defaults : {
            name: {value:""},
            alias: {value:""},
            deviceNodeId: {value: ""},
            deviceType:{value:""},
            deviceId: {value: ""},
            componentId: {value: ""},
            capabilityId: {value: "", required: true},
            attributeId: {value: "", required: true},
            rules: {value: [{isInit: true}]},
            logging: {value:false},
            loggingEditor:{value:false},
            loggingConsole:{value:false},
            outputs: {value: 1}
        },
        inputs: 1,
        outputs: 1,
        label: function () {
            return this.name|| this.alias || this.type;
        },
        oneditsave: function () {
            this.rules = []
            saveCommandRules(this);
            saveAttributesRules(this);

            this.outputs = this.rules.length || 1;
            if(this.type==ST_COMMAND_DEVICE){
                const attributeId = document.querySelector('#node-input-attributeId').value;
                if(attributeId){
                    const value = document.querySelector(':is(#attr-list-container,#cmd-list-container) .argValue')?.value||'';
                    this.alias=`${attributeId}${value?':'+value:''}`;
                }
            }else{
                const deviceName = document.querySelector('#node-input-deviceId')?.selectedOptions[0]?.innerText;
                if(deviceName){
                    this.alias=deviceName;
                }
            }
            if((!document.querySelector('#node-input-deviceNodeId').value) && document.querySelector('#node-input-deviceId')?.selectedOptions[0]){
                document.querySelector('#node-input-deviceNodeId').value=document.querySelector('#node-input-deviceId')?.selectedOptions[0].dataset.deviceNodeId;
            }
        },
        oneditprepare: function () {
            STRefCheck();
            var NODE = this;
            // console.log('deviceNODE init value : ',JSON.stringify(NODE));
            var targetProperty = (NODE.type == ST_COMMAND_DEVICE) ? "commands" : "attributes";
            NODE.target = targetProperty;

            var formObj = {
                deviceId: $("#node-input-deviceId"),
                capabilityId: $("#node-input-capabilityId"),
                attributeId: $("#node-input-attributeId"),
                container: ((NODE.type == ST_COMMAND_DEVICE) ? $("#cmd-list-container") : $("#attr-list-container"))
            }

            DeviceNodeEventHandler(formObj, NODE);
        },
        oneditresize: function (size) {
            var rows;
            var resizeContainer;
            var editorRow;

            if (this.type == ST_COMMAND_DEVICE) {
                rows = $("#dialog-form>div:not('[class$=container-row]')");
                editorRow = $("#dialog-form>div.actuator-container-row");
                resizeContainer = $("#cmd-list-container");
            } else {
                //event, sensor
                rows = $("#dialog-form>div:not('[class$=container-row]')");
                editorRow = $("#dialog-form>div.sensor-container-row");
                resizeContainer = $("#attr-list-container");
            }

            var height = size.height;
            for (var i = 0; i < rows.size(); i++) {
                height -= $(rows[i]).outerHeight(true);
            }

            height -= (parseInt(editorRow.css("marginTop")) + parseInt(editorRow.css("marginBottom")))
            resizeContainer.editableList('height', height - 100)
        }
    });

    RED.nodes.registerType('status-device',{
        paletteLabel : "Status",
        color : "rgb(119,197,191)",
        icon : "st-status.png",
        category: ST_NODES_CATEGORY,
        defaults : {
            name: {value:""},
            alias: {value:""},
            deviceNodeId: {
                value: "", required: true,
                validate: function (deviceNodeId){return RED.nodes.node(deviceNodeId)}
            },
            deviceType:{value:""},
            deviceId: {value: ""},
            componentId: {value: ""},
            capabilityId: {value: "", required: true},
            attributeId: {value: "", required: true},
            rules: {value: [{isInit: true}]},
            logging: {value:false},
            loggingEditor:{value:false},
            loggingConsole:{value:false},
            outputs: {value: 1}
        },
        inputs: 1,
        outputs: 1,
        label: function () {
            return this.name|| this.alias || this.type;
        },
        oneditsave: function () {
            this.rules = []
            saveCommandRules(this);
            saveAttributesRules(this);

            this.outputs = this.rules.length || 1;
            if(this.type==ST_COMMAND_DEVICE){
                const attributeId = document.querySelector('#node-input-attributeId').value;
                if(attributeId){
                    const value = document.querySelector(':is(#attr-list-container,#cmd-list-container) .argValue')?.value||'';
                    this.alias=`${attributeId}${value?':'+value:''}`;
                }
            }else{
                const deviceName = document.querySelector('#node-input-deviceId')?.selectedOptions[0]?.innerText;
                if(deviceName){
                    this.alias=deviceName;
                }
            }
            if((!document.querySelector('#node-input-deviceNodeId').value) && document.querySelector('#node-input-deviceId')?.selectedOptions[0]){
                document.querySelector('#node-input-deviceNodeId').value=document.querySelector('#node-input-deviceId')?.selectedOptions[0].dataset.deviceNodeId;
            }
        },
        oneditprepare: function () {
            STRefCheck();
            var NODE = this;
            // console.log('deviceNODE init value : ',JSON.stringify(NODE));
            var targetProperty = (NODE.type == ST_COMMAND_DEVICE) ? "commands" : "attributes";
            NODE.target = targetProperty;

            var formObj = {
                deviceId: $("#node-input-deviceId"),
                capabilityId: $("#node-input-capabilityId"),
                attributeId: $("#node-input-attributeId"),
                container: ((NODE.type == ST_COMMAND_DEVICE) ? $("#cmd-list-container") : $("#attr-list-container"))
            }

            DeviceNodeEventHandler(formObj, NODE);
        },
        oneditresize: function (size) {
            var rows;
            var resizeContainer;
            var editorRow;

            if (this.type == ST_COMMAND_DEVICE) {
                rows = $("#dialog-form>div:not('[class$=container-row]')");
                editorRow = $("#dialog-form>div.actuator-container-row");
                resizeContainer = $("#cmd-list-container");
            } else {
                //event, sensor
                rows = $("#dialog-form>div:not('[class$=container-row]')");
                editorRow = $("#dialog-form>div.sensor-container-row");
                resizeContainer = $("#attr-list-container");
            }

            var height = size.height;
            for (var i = 0; i < rows.size(); i++) {
                height -= $(rows[i]).outerHeight(true);
            }

            height -= (parseInt(editorRow.css("marginTop")) + parseInt(editorRow.css("marginBottom")))
            resizeContainer.editableList('height', height - 100)
        }
    });

    function saveCommandRules(NODE) {
        $("#cmd-list-container").editableList('items').each(function (idx, item) {
            var rule = {};
            rule.capaId = item.find('.capaId').text()
            rule.attrId = item.find(".attrId").text()
            rule.args = [];
            item.find(".argValue").each(function (idx, _arg) {
                var data = $(_arg).data('data')
                var arg = {}

                arg.name = data.valueName
                arg.type = data.valueType
                arg.value = $(_arg).val()
                if (data.hasOwnProperty('propId')) {
                    arg.propId = data.propId
                }
                if (data.hasOwnProperty('propType')) {
                    arg.propType = data.propType
                }
                rule.args.push(arg)

                if (arg.name == 'color') {
                    var hsl = rgbToHsl(arg.value)
                    rule.args.push({name: 'color', type: 'object', propId: 'hue', propType: 'number', value: hsl.hue})
                    rule.args.push({name: 'color', type: 'object', propId: 'saturation', propType: 'number', value: hsl.saturation})
                }
            })
            NODE.rules.push(rule)
        })
    }

    function saveAttributesRules(NODE) {
        $("#attr-list-container").editableList('items').each(function (idx, item) {
            var itemData = item.data('data')
            var valueData = item.find('.attrValue').data('data')
            var rule = {}
            rule.capaId = itemData.capaId
            rule.attrId = itemData.attrId
            rule.operator = item.find(".attrOperator").val()
            rule.valueType = itemData.valueType

            if(rule.valueType != 'object'){
                rule.value = item.find(".valueField").val()

                if (rule.valueType.toLowerCase().indexOf('integer') > -1 || rule.valueType.toLowerCase().indexOf('number') > -1) {
                    try{
                        rule.value = Number(rule.value)
                    }catch(e){}
                }
            }else{
                var valueObj = {}
                item.find(".valueField").each((i,valueField)=> {
                    valueData = $(valueField).data('data')
                    valueObj[valueData.propId] = $(valueField).val()

                    if (valueData.propType.toLowerCase().indexOf('integer') > -1 || valueData.propType.toLowerCase().indexOf('number') > -1) {
                        try {
                            if($(valueField).val().length>0){
                                valueObj[valueData.propId] = Number($(valueField).val())
                            }
                        }catch (e) {}
                    }
                })
                rule.value = valueObj
            }
            rule.unit = item.find(".attrUnit").val()

            NODE.rules.push(rule)
        })
    }

    RED.nodes.registerType('command-device', {
        paletteLabel: "Command",
        color: "rgb(255,198,109)",
        icon: "st-command.png",
        category: ST_NODES_CATEGORY,
        defaults : {//노드 의 편집 가능한 속성과 deploy시 json 형태로 저장될 데이터구조명시
            name: {value:""},
            alias: {value:""},
            deviceNodeId: {
                value: "", required: true,
                validate: function (deviceNodeId){return RED.nodes.node(deviceNodeId)}
            },
            deviceType:{value:""},
            deviceId: {value: ""},
            componentId: {value: ""},
            capabilityId: {value: "", required: true},
            attributeId: {value: "", required: true},
            rules: {value: [{isInit: true}]},
            logging: {value:false},
            loggingEditor:{value:false},
            loggingConsole:{value:false},
            outputs: {value: 1}
        },
        inputs: 1,
        outputs: 1,
        label: function () {
            return this.name|| this.alias || this.type;
        },
        oneditsave: function () {
            this.rules = []
            saveCommandRules(this);
            saveAttributesRules(this);

            this.outputs = this.rules.length || 1;
            if(this.type==ST_COMMAND_DEVICE){
                const attributeId = document.querySelector('#node-input-attributeId').value;
                if(attributeId){
                    const value = document.querySelector(':is(#attr-list-container,#cmd-list-container) .argValue')?.value||'';
                    this.alias=`${attributeId}${value?':'+value:''}`;
                }
            }else{
                const deviceName = document.querySelector('#node-input-deviceId')?.selectedOptions[0]?.innerText;
                if(deviceName){
                    this.alias=deviceName;
                }
            }
            if((!document.querySelector('#node-input-deviceNodeId').value) && document.querySelector('#node-input-deviceId')?.selectedOptions[0]){
                document.querySelector('#node-input-deviceNodeId').value=document.querySelector('#node-input-deviceId')?.selectedOptions[0].dataset.deviceNodeId;
            }
        },
        oneditprepare: function () {
            STRefCheck();
            var NODE = this;
            // console.log('deviceNODE init value : ',JSON.stringify(NODE));
            var targetProperty = (NODE.type == ST_COMMAND_DEVICE) ? "commands" : "attributes";
            NODE.target = targetProperty;

            var formObj = {
                deviceId: $("#node-input-deviceId"),
                capabilityId: $("#node-input-capabilityId"),
                attributeId: $("#node-input-attributeId"),
                container: ((NODE.type == ST_COMMAND_DEVICE) ? $("#cmd-list-container") : $("#attr-list-container"))
            }

            DeviceNodeEventHandler(formObj, NODE);
        },
        oneditresize: function (size) {
            var rows;
            var resizeContainer;
            var editorRow;

            if (this.type == ST_COMMAND_DEVICE) {
                rows = $("#dialog-form>div:not('[class$=container-row]')");
                editorRow = $("#dialog-form>div.actuator-container-row");
                resizeContainer = $("#cmd-list-container");
            } else {
                //event, sensor
                rows = $("#dialog-form>div:not('[class$=container-row]')");
                editorRow = $("#dialog-form>div.sensor-container-row");
                resizeContainer = $("#attr-list-container");
            }

            var height = size.height;
            for (var i = 0; i < rows.size(); i++) {
                height -= $(rows[i]).outerHeight(true);
            }

            height -= (parseInt(editorRow.css("marginTop")) + parseInt(editorRow.css("marginBottom")))
            resizeContainer.editableList('height', height - 100)
        }
    });
</script>
